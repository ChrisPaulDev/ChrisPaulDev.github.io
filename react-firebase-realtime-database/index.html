<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="google-site-verification" content="We9gRQmlTIjMkOPPjPWDQTXd15nWA6tBEYlxQ2cMpEg" />

  <title>
    How to use Firebase Realtime Database in React - CPaul
  </title>

  <meta name="author" content="" />

  
    <meta name="description" content="A React with Firebase tutorial on how to work with Firebase&#39;s realtime database in React. Learn about the get, create, update and remove operations, how to enable pagination and how to order your list of data, and how fo associate items with each other ...">
  

  <meta name="theme-color" content="#38bb6c"/>

  <meta name="generator" content="Hugo 0.41" />

  
  <link href="https://cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">

  
  

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

  
  <link href="../css/bootstrap.default.css" rel="stylesheet" id="theme-stylesheet">
  <link href="../css/customizations.css" rel="stylesheet">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="../img/favicon/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="../img/favicon/apple-touch-icon.png" />
  <link rel="manifest" href="../img/favicon/manifest.json">
  <link rel="mask-icon" href="../img/favicon/safari-pinned-tab.svg" color="#5bbad5">

  <link rel="alternate" href="../index.xml" type="application/rss+xml" title="CPaul">

  
  
<meta itemprop="name" content="How to use Firebase Realtime Database in React">
<meta itemprop="description" content="A React with Firebase tutorial on how to work with Firebase&#39;s realtime database in React. Learn about the get, create, update and remove operations, how to enable pagination and how to order your list of data, and how fo associate items with each other ...">



    <meta itemprop="image" content="https://chrispaul.dev/img/posts/react-firebase-realtime-database/banner_640.jpg">



<meta itemprop="keywords" content="angular,apollo,d3,graphql,growth,javascript,machine-learning,mobx,node,react,reason,redux,tooling,vue,web-development,angular,apollo,d3,graphql,growth,javascript,machine-learning,mobx,node,react,reason,redux,tooling,web-development," />


<meta itemprop="wordCount" content="4256">


  
  <meta name="keywords" content="react firebase realtime database, react firebase associate, react firebase data fetching">

  <meta property="og:title" content="How to use Firebase Realtime Database in React - CPaul">


  <meta property="og:description" content="A React with Firebase tutorial on how to work with Firebase&#39;s realtime database in React. Learn about the get, create, update and remove operations, how to enable pagination and how to order your list of data, and how fo associate items with each other ..." />


<meta property="og:type" content="website" />
<meta property="og:url" content="https://chrispaul.dev/react-firebase-realtime-database/" />
<meta property="og:image" content="https://chrispaul.dev/img/posts/react-firebase-realtime-database/banner_640.jpg" />

  

    <meta name="news_keywords" content="react firebase realtime database,react firebase associate,react firebase data fetching" />

  

    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image:src" content="https://chrispaul.dev/img/posts/react-firebase-realtime-database/banner_640.jpg"/>



<meta name="twitter:title" content="How to use Firebase Realtime Database in React"/>
<meta name="twitter:description" content="A React with Firebase tutorial on how to work with Firebase&#39;s realtime database in React. Learn about the get, create, update and remove operations, how to enable pagination and how to order your list of data, and how fo associate items with each other ..."/>
<meta name="twitter:site" content="@rwieruch"/>
<meta name="twitter:domain" content="rwieruch"/>

  

</head>


  <body>

    <div id="all">

        <header>

          <div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="../index.html">
                    <img src="../img/page/logo.svg" alt="How to use Firebase Realtime Database in React logo" class="img-lazy">
                    <span class="sr-only">How to use Firebase Realtime Database in React - go to homepage</span>
                </a>

                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                        <span class="sr-only">Toggle navigation</span>
                        <i class="fa fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                    
                    <li class="dropdown">
                        
                            <a href="../index.html">Blog</a>
                        
                    </li>
                    
                    <li class="dropdown">
                        
                            <a href="../work-with-me/index.html">Work with me</a>
                        
                    </li>
                    
                    <li class="dropdown">
                        
                            <a href="../about/index.html">About</a>
                        
                    </li>
                    
                    <li class="dropdown">
                        
                            <a style="color: #38bb6c" href="https://roadtoreact.com/">Books &amp; Courses</a>
                        
                    </li>
                    
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">

                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>

                </span>
                    </div>
                </form>

            </div>
            

        </div>
    </div>
    

</div>




        </header>

        <div class="post-share post-share-fixed post-share-desktop hidden-xs hidden-sm">
    

<a
    aria-label="icon-facebook"
    class="icon-facebook"
    href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fchrispaul.dev%2freact-firebase-realtime-database%2f"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
    <i class="fa fa-facebook"></i>
</a>


<a
    aria-label="icon-twitter"
    class="icon-twitter"
    href="https://twitter.com/share?text=How%20to%20use%20Firebase%20Realtime%20Database%20in%20React%20by%20%40rwieruch%20%23ReactJs&amp;url=https%3a%2f%2fchrispaul.dev%2freact-firebase-realtime-database%2f"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
    <i class="fa fa-twitter"></i>
</a>





<a
    aria-label="icon-linkedin"
    class="icon-linkedin"
    href="https://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20use%20Firebase%20Realtime%20Database%20in%20React&amp;url=https%3a%2f%2fchrispaul.dev%2freact-firebase-realtime-database%2f">
    <i class="fa fa-linkedin"></i>
</a>

</div>

<div class="visible-xs visible-sm text-center">
    <div class="post-share post-share-fixed post-share-mobile">
        

<a
    aria-label="icon-facebook"
    class="icon-facebook"
    href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fchrispaul.dev%2freact-firebase-realtime-database%2f"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
    <i class="fa fa-facebook"></i>
</a>


<a
    aria-label="icon-twitter"
    class="icon-twitter"
    href="https://twitter.com/share?text=How%20to%20use%20Firebase%20Realtime%20Database%20in%20React%20by%20%40rwieruch%20%23ReactJs&amp;url=https%3a%2f%2fchrispaul.dev%2freact-firebase-realtime-database%2f"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
    <i class="fa fa-twitter"></i>
</a>





<a
    aria-label="icon-linkedin"
    class="icon-linkedin"
    href="https://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20use%20Firebase%20Realtime%20Database%20in%20React&amp;url=https%3a%2f%2fchrispaul.dev%2freact-firebase-realtime-database%2f">
    <i class="fa fa-linkedin"></i>
</a>

    </div>
</div>

        

        <div class="hidden-xs">
            

<section class="bar background-image-fixed-2 no-mb color-white text-center">
    <div class="dark-mask"></div>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h3 class="lead">Never miss an article about web development, JavaScript and self-growth.</h3>
                <h2 class="text-uppercase newsletter">Take Part</h2>
            </div>

            <div class="col-md-12">
                <p class="text-center">
                    



<div id="mc_embed_signup">
    <form
        action="https://www.getrevue.co/profile/rwieruch/add_subscriber"
        method="post"
        id="revue-form"
        name="revue-form"
        target="_blank">
        <div id="mc_embed_signup_scroll">
            <input
                class="email"
                placeholder="email address"
                type="email"
                name="member[email]"
                id="member_email"
            >
            <div>
                <button
                    type="submit"
                    value="Subscribe"
                    name="member[subscribe]"
                    id="member_submit"
                    class="btn btn-template-transparent-black btn-lg"
                >
                    Subscribe
                </button>
            </div>
        </div>
    </form>
</div>

                </p>
            </div>
        </div>
    </div>
</section>



        </div>

        <div id="content">
            <div class="container">

                <div class="row">

                    <article
                        class="col-md-8 col-md-offset-2"
                        id="blog-post"
                        itemprop="blogPosts"
                        itemscope itemtype="http://schema.org/BlogPosting">

                        <div id="post-content" itemprop="articleBody">

                            <header>
                                <h1 itemprop="name headline">How to use Firebase Realtime Database in React</h1>
                            </header>

                            <div class="text-center">
                                
    <a target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/rwieruch" class="facebook-button-follow">
         <i class="fa fa-facebook"></i>Follow
    </a>


                                &nbsp;
                                

                                &nbsp;
                                
  <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/intent/follow?screen_name=rwieruch" class="generic-button-follow">
    <img src="https://img.shields.io/twitter/follow/rwieruch.svg?style=social&amp;logo=twitter&amp;label=Follow" alt="Follow on Twitter">
  </a>


                                &nbsp;
                                
                            </div>

                            <p class="text-muted text-uppercase mb-small text-center">
    <span itemprop="author publisher">
        
    </span>

    
        <time datetime="2019-01-16" itemprop="datePublished">
            January 16, 2019
        </time>
    

    
        <span class="hidden-xs hidden-sm"> - <a
            target="_blank"
            rel="noopener noreferrer"
            href="https://github.com/rwieruch/blog_chriswieruch_content/blob/master/react-firebase-realtime-database.md">
                Edit this Post on GitHub
            </a>
        </span>
    
</p>

                            

<div>
  

</div>

<div class="post-image-primary">
    <div class="pinterest-pinner-wrapper" itemscope itemtype="http://schema.org/ImageObject">
        <div class="pinterest-pinner">
            <a
                data-pin-do="buttonPin"
                data-pin-save="true"
                data-pin-tall="true"
                href="https://www.pinterest.com/pin/create/button/?url=https%3a%2f%2fchrispaul.dev%2freact-firebase-realtime-database%2f&amp;media=https://chrispaul.dev/img%2fposts%2freact-firebase-realtime-database%2fbanner.jpg&amp;description=">
            </a>
        </div>

        <img
            class="img-lazy img-responsive"
            data-lazy-src="/src="/img/posts/react-firebase-realtime-database/banner.jpg"
            data-is-src-set="is-src-set"
            alt="react firebase realtime database"
            itemprop="image"
        />
    </div>
</div>


<p>
  <em>
    Interested in reading this tutorial as one of many chapters in my advanced React with Firebase book? Checkout the entire <a href="https://roadtoreact.com">The Road to React with Firebase</a> book that teaches you to create business web applications without the need to create a backend application with a database yourself.
  </em>
</p>

<div class="read-before">
    <p>This tutorial is part 8 of 8 in this series.</p>
    <div>Part 1: <a href="../complete-firebase-authentication-react-tutorial/index.html" itemprop="url">A Firebase in React Tutorial for Beginners</a></div>
    <div>Part 2: <a href="../react-firebase-authorization-roles-permissions/index.html" itemprop="url">React Firebase Authorization with Roles</a></div>
    <div>Part 3: <a href="../react-firebase-auth-persistence/index.html" itemprop="url">React Firebase Auth Persistence with Local Storage</a></div>
    <div>Part 4: <a href="../react-firebase-social-login/index.html" itemprop="url">React Firebase Social Login: Google, Facebook, Twitter</a></div>
    <div>Part 5: <a href="../react-firebase-link-social-logins/index.html" itemprop="url">React Firebase: Link Social Logins</a></div>
    <div>Part 6: <a href="../react-firebase-email-verification/index.html" itemprop="url">React Firebase: Email Verification</a></div>
    <div>Part 7: <a href="../react-firebase-router/index.html" itemprop="url">How to use React Router with Firebase</a></div>
</div>

<p>Now we&rsquo;ve worked with a list of data and single entities with the Firebase&rsquo;s realtime database to create an admin dashboard in the previous sections. In this section, I want to introduce a new entity to demonstrate a business-related feature for a Firebase in React application, a message entity that lets you create a chat application. We&rsquo;ll cover how to interact with Firebase&rsquo;s realtime database; specifically, how to structure data, work with lists of data, and how to create, update, and remove data. Also, you will see how ordering and pagination works with Firebase. In the end, it&rsquo;s up to you to decide whether your application should become a chat application with a message entity or a book application with a book entity in the database. The message entity is only there as example.</p>

<h2 class="chapter-header" id="firebase-realtime-database-api">Defining a Firebase Realtime Database API</h2>

<p>Our Firebase class is the glue between our React application and the Firebase API. We instantiate it once, and then pass it to our React application via React&rsquo;s Context API. Then, we can define all APIs to connect both worlds in the Firebase class. We completed it earlier for the authentication API and the user management. Next, let&rsquo;s introduce the API for the new message entity.</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">Firebase</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #776e71">// *** User API ***</span>

  <span style="color: #06b6ef">user</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">uid</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">db</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">ref</span><span style="color: #e7e9db">(</span><span style="color: #48b685">`users/</span><span style="color: #f99b15">${</span><span style="color: #06b6ef">uid</span><span style="color: #f99b15">}</span><span style="color: #48b685">`</span><span style="color: #e7e9db">);</span>

  <span style="color: #06b6ef">users</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">db</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">ref</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;users&#39;</span><span style="color: #e7e9db">);</span>

<span style="background-color: #4f424c">  <span style="color: #776e71">// *** Message API ***</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">message</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">uid</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">db</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">ref</span><span style="color: #e7e9db">(</span><span style="color: #48b685">`messages/</span><span style="color: #f99b15">${</span><span style="color: #06b6ef">uid</span><span style="color: #f99b15">}</span><span style="color: #48b685">`</span><span style="color: #e7e9db">);</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">db</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">ref</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;messages&#39;</span><span style="color: #e7e9db">);</span>
</span><span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Messages are readable and writeable on two API endpoints: messages and messages/:messageId. You will retrieve a list of messages and create a message with the <code>messages</code> reference, but you will edit and remove messages with the <code>messages/:messageId</code> reference.</p>

<p>If you want to be more specific, put more informative class methods for the message API in your Firebase class. For instance, there could be one class method for creating, updating, and removing a message. We will keep it general, however, and perform the specifics in the React components.</p>

<h2 class="chapter-header" id="firebase-realtime-database-get-list">Get a List from Firebase Realtime Database</h2>

<p>The HomePage component might be the best place to add the chat feature with messages, which is only accessible by authenticated users due to authorization. Let&rsquo;s add a Message component that has access to the Firebase instance:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withAuthorization</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">withEmailVerification</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Session&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="color: #815ba4">const</span> <span style="color: #06b6ef">HomePage</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
  <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">h1</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Home</span> <span style="color: #06b6ef">Page</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/h1&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">p</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">The</span> <span style="color: #06b6ef">Home</span> <span style="color: #06b6ef">Page</span> <span style="color: #06b6ef">is</span> <span style="color: #06b6ef">accessible</span> <span style="color: #06b6ef">by</span> <span style="color: #06b6ef">every</span> <span style="color: #06b6ef">signed</span> <span style="color: #815ba4">in</span> <span style="color: #06b6ef">user</span><span style="color: #e7e9db">.</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/p&gt;</span>

<span style="background-color: #4f424c">    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Messages</span> <span style="color: #5bc4bf">/&gt;</span>
</span>  <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
<span style="color: #e7e9db">);</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">...</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">}</span>
</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">Messages</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">withFirebase</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">MessagesBase</span><span style="color: #e7e9db">);</span>
</span>
<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
  <span style="color: #06b6ef">withEmailVerification</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">withAuthorization</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">condition</span><span style="color: #e7e9db">),</span>
<span style="color: #e7e9db">)(</span><span style="color: #06b6ef">HomePage</span><span style="color: #e7e9db">);</span>
</code></pre></div>


<p>The Messages component has a local state for a loading indicator and the list of messages. In the lifecycle methods of the component, you can initialize (and remove) listeners to get messages from the Firebase database in realtime. When messages change (create, update, remove), the callback function in the listener is triggered and Firebase provides a snapshot of the data.</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">super</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">);</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">[],</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">};</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">}</span>
</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">true</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">().</span><span style="color: #06b6ef">on</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #776e71">// convert messages list from snapshot</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">}</span>
</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">componentWillUnmount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">().</span><span style="color: #06b6ef">off</span><span style="color: #e7e9db">();</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">}</span>
</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">messages</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">loading</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">loading</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Loading</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;}</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">MessageList</span> <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span>
</span><span style="background-color: #4f424c">      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">);</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">}</span>
</span><span style="color: #e7e9db">}</span>
</code></pre></div>


<p>The new MessageList and MessageItem components only render the message content:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">MessageList</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">({</span> <span style="color: #06b6ef">messages</span> <span style="color: #e7e9db">})</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">  <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">ul</span><span style="color: #5bc4bf">&gt;</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">map</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">message</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">MessageItem</span> <span style="color: #06b6ef">key</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">}</span> <span style="color: #06b6ef">message</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">))}</span>
</span><span style="background-color: #4f424c">  <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/ul&gt;</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">);</span>
</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">MessageItem</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">({</span> <span style="color: #06b6ef">message</span> <span style="color: #e7e9db">})</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">  <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">li</span><span style="color: #5bc4bf">&gt;</span>
</span><span style="background-color: #4f424c">    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">strong</span><span style="color: #5bc4bf">&gt;</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userId</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/strong&gt; {message.text}</span>
</span><span style="background-color: #4f424c">  <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/li&gt;</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">);</span>
</span></code></pre></div>


<p>If you run the application, the loading indicator disappears after a few seconds when the Firebase realtime database listener is called for the first time. Every other time the loading indicator isn&rsquo;t shown, because it is only <code>true</code> when the component mounts and the first message fetching starts.</p>

<p>It could be that there are no messages yet, which is the case for this application since we didn&rsquo;t use the message API to create a message yet. We&rsquo;re only showing the messages for now. To show conditional feedback to users, we need to know if the list of messages is empty (see constructor), if the message API didn&rsquo;t return any messages and the local state is changed from an empty array to null:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">super</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">);</span>

    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
      <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span><span style="color: #e7e9db">,</span>
      <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">[],</span>
    <span style="color: #e7e9db">};</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">true</span> <span style="color: #e7e9db">});</span>

    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">().</span><span style="color: #06b6ef">on</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">      <span style="color: #815ba4">const</span> <span style="color: #06b6ef">messageObject</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">snapshot</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">val</span><span style="color: #e7e9db">();</span>
</span>
<span style="background-color: #4f424c">      <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">messageObject</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">        <span style="color: #776e71">// convert messages list from snapshot</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">      <span style="color: #e7e9db">}</span> <span style="color: #815ba4">else</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">null</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">      <span style="color: #e7e9db">}</span>
</span>    <span style="color: #e7e9db">});</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">messages</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">loading</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>

    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">loading</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Loading</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;}</span>

<span style="background-color: #4f424c">        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">?</span> <span style="color: #e7e9db">(</span>
</span>          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">MessageList</span> <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span>
<span style="background-color: #4f424c">        <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">There</span> <span style="color: #06b6ef">are</span> <span style="color: #06b6ef">no</span> <span style="color: #06b6ef">messages</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">)}</span>
</span>      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Lastly, you need to convert the messages from the snapshot object to a list of items. Since Firebase comes with its own internal representation of data, you need to transform the data as before for the list of users on the admin page:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">true</span> <span style="color: #e7e9db">});</span>

    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">().</span><span style="color: #06b6ef">on</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">const</span> <span style="color: #06b6ef">messageObject</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">snapshot</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">val</span><span style="color: #e7e9db">();</span>

      <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">messageObject</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">        <span style="color: #815ba4">const</span> <span style="color: #06b6ef">messageList</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">Object.</span><span style="color: #06b6ef">keys</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">messageObject</span><span style="color: #e7e9db">).</span><span style="color: #06b6ef">map</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">key</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">          <span style="color: #e7e9db">...</span><span style="color: #06b6ef">messageObject</span><span style="color: #e7e9db">[</span><span style="color: #06b6ef">key</span><span style="color: #e7e9db">],</span>
</span><span style="background-color: #4f424c">          <span style="color: #06b6ef">uid</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">key</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">}));</span>
</span>
        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span>
<span style="background-color: #4f424c">          <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">messageList</span><span style="color: #e7e9db">,</span>
</span>          <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span><span style="color: #e7e9db">,</span>
        <span style="color: #e7e9db">});</span>
      <span style="color: #e7e9db">}</span> <span style="color: #815ba4">else</span> <span style="color: #e7e9db">{</span>
        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">null</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span> <span style="color: #e7e9db">});</span>
      <span style="color: #e7e9db">}</span>
    <span style="color: #e7e9db">});</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Since you have no messages, nothing shows up. Creating chat messages is our next task.</p>

<h2 class="chapter-header" id="firebase-realtime-database-create-item-in-list">Create an Item in a List in Firebase Realtime Database</h2>

<p>We were able to get all messages from the Firebase realtime database. It&rsquo;s even updated for us using the Firebase listener on a reference with the <code>on</code> and not <code>once</code> method. Next, let&rsquo;s implement a React form that lets us create a message entity in the Firebase realtime database:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">text</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">messages</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">loading</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>
</span>
    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">loading</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Loading</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;}</span>

        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">?</span> <span style="color: #e7e9db">(</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">MessageList</span> <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span>
        <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">(</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">There</span> <span style="color: #06b6ef">are</span> <span style="color: #06b6ef">no</span> <span style="color: #06b6ef">messages</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
        <span style="color: #e7e9db">)}</span>

<span style="background-color: #4f424c">        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">form</span> <span style="color: #06b6ef">onSubmit</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onCreateMessage</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span>
</span><span style="background-color: #4f424c">          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">input</span>
</span><span style="background-color: #4f424c">            <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;text&quot;</span>
</span><span style="background-color: #4f424c">            <span style="color: #06b6ef">value</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">text</span><span style="color: #e7e9db">}</span>
</span><span style="background-color: #4f424c">            <span style="color: #06b6ef">onChange</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onChangeText</span><span style="color: #e7e9db">}</span>
</span><span style="background-color: #4f424c">          <span style="color: #5bc4bf">/&gt;</span>
</span><span style="background-color: #4f424c">          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">button</span> <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;submit&quot;</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Send</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/button&gt;</span>
</span><span style="background-color: #4f424c">        <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/form&gt;</span>
</span>      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Next, add the new initial state for the component to keep track of the text property for a new message and its two new class methods to update the text in an input field element and create the actual message with Firebase:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">super</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">);</span>

    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">      <span style="color: #06b6ef">text</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;&#39;</span><span style="color: #e7e9db">,</span>
</span>      <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span><span style="color: #e7e9db">,</span>
      <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">[],</span>
    <span style="color: #e7e9db">};</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">onChangeText</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">event</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">text</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">event</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">target</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">value</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">};</span>
</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">onCreateMessage</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">event</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">().</span><span style="color: #06b6ef">push</span><span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">text</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">text</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">text</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;&#39;</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">event</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">preventDefault</span><span style="color: #e7e9db">();</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">};</span>
</span>
  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>We can use the push method on a Firebase reference to create a new entity in this list of entities, though we don&rsquo;t want to create a message just yet. One piece is missing for associating messages to users, which needs to be implemented before we create messages.</p>

<h2 class="chapter-header" id="firebase-realtime-database-associate-items">Associate Entities in Firebase Realtime Database</h2>

<p>If you look closer at the MessageItem component, you can see that a message not only has a <code>text</code>, but also a <code>userId</code> that can be used to associate the message to a user. Let&rsquo;s use the authenticated user from our React Context to store the user identifier in a new message. First, add the Consumer component and add the identifier for the authenticated user in the class method call that creates the message:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #e7e9db">...</span>

<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">AuthUserContext</span><span style="color: #e7e9db">,</span>
</span>  <span style="color: #06b6ef">withAuthorization</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">withEmailVerification</span><span style="color: #e7e9db">,</span>
<span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Session&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #e7e9db">...</span>

<span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">text</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">messages</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">loading</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>

    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
<span style="background-color: #4f424c">      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">AuthUserContext</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Consumer</span><span style="color: #5bc4bf">&gt;</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
</span>          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
            <span style="color: #e7e9db">{</span><span style="color: #06b6ef">loading</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Loading</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;}</span>

            <span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">?</span> <span style="color: #e7e9db">(</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">MessageList</span> <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span>
            <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">(</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">There</span> <span style="color: #06b6ef">are</span> <span style="color: #06b6ef">no</span> <span style="color: #06b6ef">messages</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
            <span style="color: #e7e9db">)}</span>

<span style="background-color: #4f424c">            <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">form</span> <span style="color: #06b6ef">onSubmit</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">event</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onCreateMessage</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">event</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">)}</span><span style="color: #5bc4bf">&gt;</span>
</span>              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">input</span>
                <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;text&quot;</span>
                <span style="color: #06b6ef">value</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">text</span><span style="color: #e7e9db">}</span>
                <span style="color: #06b6ef">onChange</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onChangeText</span><span style="color: #e7e9db">}</span>
              <span style="color: #5bc4bf">/&gt;</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">button</span> <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;submit&quot;</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Send</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/button&gt;</span>
            <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/form&gt;</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
<span style="background-color: #4f424c">        <span style="color: #e7e9db">)}</span>
</span><span style="background-color: #4f424c">      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/AuthUserContext.Consumer&gt;</span>
</span>    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Next, use the authenticated user to associate the user identifier to the message. It makes sense to use the authenticated user, because this is the person authorized to write messages:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">onCreateMessage</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">event</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span>    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">().</span><span style="color: #06b6ef">push</span><span style="color: #e7e9db">({</span>
      <span style="color: #06b6ef">text</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">text</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">      <span style="color: #06b6ef">userId</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">,</span>
</span>    <span style="color: #e7e9db">});</span>

    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">text</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;&#39;</span> <span style="color: #e7e9db">});</span>

    <span style="color: #06b6ef">event</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">preventDefault</span><span style="color: #e7e9db">();</span>
  <span style="color: #e7e9db">};</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Now go ahead and create a message. Since we only can access this page as an authenticated user due to authorization, we know that each message that is written here will be associated to a user identifier. After you have created a message, the realtime feature of the Firebase database makes sure that the message will show up in our rendered list.</p>

<p>So far, we have chosen to keep the footprint of a user entity within a message as little as possible. There is only an user identifier which associates the message to a user. Generally speaking it&rsquo;s good to structure data in your database this way, because it avoids plenty of pitfalls. For instance, let&rsquo;s imagine you would associate the whole user entity to a message and not only the identifier. Then every time a user entity changes in the database, you would have to change the message entity with the user as well. That&rsquo;s a common problem when not following the principal of the single source of truth when designing your database models. In our case, we are associating entities with each other only by their identifiers instead, whereas each entity in the database is the single source of truth without any duplications.</p>

<p>Another thing we decided earlier is giving the messages their dedicated API reference with <code>messages</code>. In another scenario, it could have been <code>users/:userId/messages</code> to associate users directly with the message via the reference. But doing it this way, we would have to fetch messages from multiple API endpoints in the end to show a nice chatroom as we do it right now.</p>

<h2 class="chapter-header" id="firebase-realtime-database-remove-item-in-list">Remove an Item in a List in Firebase Realtime Database</h2>

<p>We are reading a list of messages and created our first message. What about the other two missing functionalities to remove and edit a message. Let&rsquo;s continue with removing a message. Pass through a new class method that will remove a message eventually:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">onRemoveMessage</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">...</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">};</span>
</span>
  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">text</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">messages</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">loading</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>

    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">AuthUserContext</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Consumer</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
            <span style="color: #e7e9db">...</span>

            <span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">?</span> <span style="color: #e7e9db">(</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">MessageList</span>
                <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">}</span>
<span style="background-color: #4f424c">                <span style="color: #06b6ef">onRemoveMessage</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onRemoveMessage</span><span style="color: #e7e9db">}</span>
</span>              <span style="color: #5bc4bf">/&gt;</span>
            <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">(</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">There</span> <span style="color: #06b6ef">are</span> <span style="color: #06b6ef">no</span> <span style="color: #06b6ef">messages</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
            <span style="color: #e7e9db">)}</span>

            <span style="color: #e7e9db">...</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
        <span style="color: #e7e9db">)}</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/AuthUserContext.Consumer&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>The MessageList component in between just pass the function through to the MessageItem component:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">MessageList</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">({</span> <span style="color: #06b6ef">messages</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">onRemoveMessage</span> <span style="color: #e7e9db">})</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
</span>  <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">ul</span><span style="color: #5bc4bf">&gt;</span>
    <span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">map</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">message</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">MessageItem</span>
        <span style="color: #06b6ef">key</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">}</span>
        <span style="color: #06b6ef">message</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">}</span>
<span style="background-color: #4f424c">        <span style="color: #06b6ef">onRemoveMessage</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">onRemoveMessage</span><span style="color: #e7e9db">}</span>
</span>      <span style="color: #5bc4bf">/&gt;</span>
    <span style="color: #e7e9db">))}</span>
  <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/ul&gt;</span>
<span style="color: #e7e9db">);</span>
</code></pre></div>


<p>Finally it can be used in the MessageItem component. When clicking the button, we will pass the message identifier to the function. Then in our parent component that has access to Firebase we can remove the message associated with the identifier.</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">MessageItem</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">({</span> <span style="color: #06b6ef">message</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">onRemoveMessage</span> <span style="color: #e7e9db">})</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
</span>  <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">li</span><span style="color: #5bc4bf">&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">strong</span><span style="color: #5bc4bf">&gt;</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userId</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/strong&gt; {message.text}</span>
<span style="background-color: #4f424c">    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">button</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;button&quot;</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">onClick</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #06b6ef">onRemoveMessage</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">)}</span>
</span><span style="background-color: #4f424c">    <span style="color: #5bc4bf">&gt;</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">Delete</span>
</span><span style="background-color: #4f424c">    <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/button&gt;</span>
</span>  <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/li&gt;</span>
<span style="color: #e7e9db">);</span>
</code></pre></div>


<p>Last, implement the class method that deletes the item from the list. Since we have access to the identifier of the message, we can use the reference of a single message to remove it.</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">onRemoveMessage</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">uid</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">).</span><span style="color: #06b6ef">remove</span><span style="color: #e7e9db">();</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">};</span>
</span>
  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Deleting a message works, and you can also make Firebase instance available to the MessageItem component and delete the message there right away. The real-time connection to the Firebase database in the Messages component would still be called to remove the message, which keeps the displayed messages in sync. However, aggregating all the business logic in one place, in this case the Messages component, makes sense for a better maintainability and predictability of the application. Only a few components have the more complex logic whereas the other components are just there to render the content.</p>

<h2 class="chapter-header" id="firebase-realtime-database-edit-item-in-list">Edit an Item in a List in Firebase Realtime Database</h2>

<p>It&rsquo;s abnormal to update a message in a chat application, but we&rsquo;ll implement this feature anyway. Eventually, we&rsquo;ll give other users feedback that a message was edited. That way, all statements made in the chat keep their integrity. Again, implement the class method first, which we will fill with details later, and pass it down to the MessageList component:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">onEditMessage</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">...</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">};</span>
</span>
  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">text</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">messages</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">loading</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>

    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">AuthUserContext</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Consumer</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
            <span style="color: #e7e9db">...</span>

            <span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">?</span> <span style="color: #e7e9db">(</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">MessageList</span>
                <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">}</span>
<span style="background-color: #4f424c">                <span style="color: #06b6ef">onEditMessage</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onEditMessage</span><span style="color: #e7e9db">}</span>
</span>                <span style="color: #06b6ef">onRemoveMessage</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onRemoveMessage</span><span style="color: #e7e9db">}</span>
              <span style="color: #5bc4bf">/&gt;</span>
            <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">(</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">There</span> <span style="color: #06b6ef">are</span> <span style="color: #06b6ef">no</span> <span style="color: #06b6ef">messages</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
            <span style="color: #e7e9db">)}</span>

            <span style="color: #e7e9db">...</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
        <span style="color: #e7e9db">)}</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/AuthUserContext.Consumer&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Again, the MessageList component just passes it through to the MessageItem component:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">const</span> <span style="color: #06b6ef">MessageList</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">({</span>
  <span style="color: #06b6ef">messages</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">onEditMessage</span><span style="color: #e7e9db">,</span>
</span>  <span style="color: #06b6ef">onRemoveMessage</span><span style="color: #e7e9db">,</span>
<span style="color: #e7e9db">})</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
  <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">ul</span><span style="color: #5bc4bf">&gt;</span>
    <span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">map</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">message</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">MessageItem</span>
        <span style="color: #06b6ef">key</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">}</span>
        <span style="color: #06b6ef">message</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">}</span>
<span style="background-color: #4f424c">        <span style="color: #06b6ef">onEditMessage</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">onEditMessage</span><span style="color: #e7e9db">}</span>
</span>        <span style="color: #06b6ef">onRemoveMessage</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">onRemoveMessage</span><span style="color: #e7e9db">}</span>
      <span style="color: #5bc4bf">/&gt;</span>
    <span style="color: #e7e9db">))}</span>
  <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/ul&gt;</span>
<span style="color: #e7e9db">);</span>
</code></pre></div>


<p>Editing a message involves a few more rendered elements, business logic, and state in the MessageItem component. That&rsquo;s why we refactor it to a class component:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="background-color: #4f424c"><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessageItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
</span>  <span style="color: #e7e9db">...</span>
<span style="background-color: #4f424c"><span style="color: #e7e9db">}</span>
</span></code></pre></div>


<p>Next, we&rsquo;ll keep track of the mode of the component, which tells us if we&rsquo;re showing the text of a message or editing it. Also, if we are editing a message, we need to track the value of the input field element. As initial state, it receives the text of the message entity which makes sense if we only want to edit a typo in the message:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessageItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">   <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">super</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">);</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">editMode</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">editText</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">text</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">};</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">}</span>
</span>
  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Now, let&rsquo;s implement three class methods, the first of which is a class method for toggling the mode from edit to preview and back. If this mode is toggled, we always fill in the text of the message as a value for the input field element to improve the user experience when the mode is toggled:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessageItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">onToggleEditMode</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">editMode</span><span style="color: #5bc4bf">:</span> <span style="color: #5bc4bf">!</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">editMode</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">editText</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">text</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">}));</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">};</span>
</span>
  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Second, a class method for updating the value in the input field:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessageItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">onChangeEditText</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">event</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">editText</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">event</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">target</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">value</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">};</span>
</span>
  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>And third, a class method to submit the final value to the parent component to edit the message:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessageItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">onSaveEditText</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onEditMessage</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">,</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">editText</span><span style="color: #e7e9db">);</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">editMode</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">};</span>
</span>
  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Later, we will see why we send the message with the edited text. Next, let&rsquo;s implement the render method of the MessageItem component. Make sure that the button to delete a message is not displayed in edit mode:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessageItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">message</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">onRemoveMessage</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">editMode</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">editText</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>
</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
</span>      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">li</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">span</span><span style="color: #5bc4bf">&gt;</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">strong</span><span style="color: #5bc4bf">&gt;</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userId</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/strong&gt; {message.text}</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/span&gt;</span>

<span style="background-color: #4f424c">        <span style="color: #e7e9db">{</span><span style="color: #5bc4bf">!</span><span style="color: #06b6ef">editMode</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #e7e9db">(</span>
</span>          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">button</span>
            <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;button&quot;</span>
            <span style="color: #06b6ef">onClick</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #06b6ef">onRemoveMessage</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">)}</span>
          <span style="color: #5bc4bf">&gt;</span>
            <span style="color: #06b6ef">Delete</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/button&gt;</span>
<span style="background-color: #4f424c">        <span style="color: #e7e9db">)}</span>
</span>      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/li&gt;</span>
<span style="background-color: #4f424c">    <span style="color: #e7e9db">);</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">}</span>
</span><span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Next add &ldquo;Edit&rdquo; and &ldquo;Reset&rdquo; buttons to toggle between preview and edit mode. Depending on the edit mode, the correct button is displayed, and a &ldquo;Save&rdquo; button is shown in edit mode to save the edited text:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessageItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">message</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">onRemoveMessage</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">;</span>
    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">editMode</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">editText</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>

    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">li</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">span</span><span style="color: #5bc4bf">&gt;</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">strong</span><span style="color: #5bc4bf">&gt;</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userId</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/strong&gt; {message.text}</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/span&gt;</span>

<span style="background-color: #4f424c">        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">editMode</span> <span style="color: #5bc4bf">?</span> <span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">span</span><span style="color: #5bc4bf">&gt;</span>
</span><span style="background-color: #4f424c">            <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">button</span> <span style="color: #06b6ef">onClick</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onSaveEditText</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Save</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/button&gt;</span>
</span><span style="background-color: #4f424c">            <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">button</span> <span style="color: #06b6ef">onClick</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onToggleEditMode</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Reset</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/button&gt;</span>
</span><span style="background-color: #4f424c">          <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/span&gt;</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">button</span> <span style="color: #06b6ef">onClick</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onToggleEditMode</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Edit</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/button&gt;</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">)}</span>
</span>
        <span style="color: #e7e9db">...</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/li&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Last, we need the input field element to edit the text. It is only displayed in edit mode. If we are not in edit mode, the actual text of the message is shown:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessageItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">message</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">onRemoveMessage</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">;</span>
    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">editMode</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">editText</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>

    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">li</span><span style="color: #5bc4bf">&gt;</span>
<span style="background-color: #4f424c">        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">editMode</span> <span style="color: #5bc4bf">?</span> <span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">input</span>
</span><span style="background-color: #4f424c">            <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;text&quot;</span>
</span><span style="background-color: #4f424c">            <span style="color: #06b6ef">value</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">editText</span><span style="color: #e7e9db">}</span>
</span><span style="background-color: #4f424c">            <span style="color: #06b6ef">onChange</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onChangeEditText</span><span style="color: #e7e9db">}</span>
</span><span style="background-color: #4f424c">          <span style="color: #5bc4bf">/&gt;</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">(</span>
</span>          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">span</span><span style="color: #5bc4bf">&gt;</span>
            <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">strong</span><span style="color: #5bc4bf">&gt;</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userId</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/strong&gt; {message.text}</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/span&gt;</span>
<span style="background-color: #4f424c">        <span style="color: #e7e9db">)}</span>
</span>
        <span style="color: #e7e9db">...</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/li&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Now we can edit the text in edit mode, and we can also reset the whole thing using a button. If we save the edited text, the text and the message will be sent through the MessageList component to the Messages component, where the message can be identified by id to be edited with the text property. Using the spread operator, all other properties of the message entity are kept as before:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">onEditMessage</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">text</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">uid</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">...</span><span style="color: #06b6ef">messageSnapshot</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">message</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">).</span><span style="color: #06b6ef">set</span><span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">      <span style="color: #e7e9db">...</span><span style="color: #06b6ef">messageSnapshot</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">text</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">};</span>
</span>
  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>If we set only the new text for the message, all other properties (e.g. userId) would be lost. Also we can add <code>createdAt</code> and <code>editedAt</code> dates. The second date gives users feedback that someone changed a chat message:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">onCreateMessage</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">event</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">().</span><span style="color: #06b6ef">push</span><span style="color: #e7e9db">({</span>
      <span style="color: #06b6ef">text</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">text</span><span style="color: #e7e9db">,</span>
      <span style="color: #06b6ef">userId</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">      <span style="color: #06b6ef">createdAt</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">serverValue</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">TIMESTAMP</span><span style="color: #e7e9db">,</span>
</span>    <span style="color: #e7e9db">});</span>

    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">text</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;&#39;</span> <span style="color: #e7e9db">});</span>

    <span style="color: #06b6ef">event</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">preventDefault</span><span style="color: #e7e9db">();</span>
  <span style="color: #e7e9db">};</span>

  <span style="color: #06b6ef">onEditMessage</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">text</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">uid</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">...</span><span style="color: #06b6ef">messageSnapshot</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">message</span><span style="color: #e7e9db">;</span>

    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">).</span><span style="color: #06b6ef">set</span><span style="color: #e7e9db">({</span>
      <span style="color: #e7e9db">...</span><span style="color: #06b6ef">messageSnapshot</span><span style="color: #e7e9db">,</span>
      <span style="color: #06b6ef">text</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">      <span style="color: #06b6ef">editedAt</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">serverValue</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">TIMESTAMP</span><span style="color: #e7e9db">,</span>
</span>    <span style="color: #e7e9db">});</span>
  <span style="color: #e7e9db">};</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>When using Firebase, it&rsquo;s best not to choose the date yourself, but let Firebase choose it depending on their internal mechanics. The server value constants from Firebase can be made available in the Firebase class:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">Firebase</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #06b6ef">app</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">initializeApp</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">config</span><span style="color: #e7e9db">);</span>

    <span style="color: #776e71">/* Helper */</span>

<span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">serverValue</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">app</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">database</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">ServerValue</span><span style="color: #e7e9db">;</span>
</span>    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">emailAuthProvider</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">app</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">auth</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">EmailAuthProvider</span><span style="color: #e7e9db">;</span>

    <span style="color: #e7e9db">...</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>In the MessageItem component, give users feedback that shows when a message was edited:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessageItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">message</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">onRemoveMessage</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">;</span>
    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">editMode</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">editText</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>

    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">li</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">editMode</span> <span style="color: #5bc4bf">?</span> <span style="color: #e7e9db">(</span> <span style="color: #e7e9db">...</span> <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">(</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">span</span><span style="color: #5bc4bf">&gt;</span>
            <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">strong</span><span style="color: #5bc4bf">&gt;</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userId</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/strong&gt; {message.text}</span>
<span style="background-color: #4f424c">            <span style="color: #e7e9db">{</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">editedAt</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">span</span><span style="color: #5bc4bf">&gt;</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">Edited</span><span style="color: #e7e9db">)</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/span&gt;}</span>
</span>          <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/span&gt;</span>
        <span style="color: #e7e9db">)}</span>

        <span style="color: #e7e9db">...</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/li&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>As before, we could have used Firebase directly in the MessageItem component. It&rsquo;s also good to keep the MessageItem component encapsulated with its own business logic. Only the message itself and the other functions to alter the message are passed from above to the component, and only the Messages component speaks to the outside world (e.g. Firebase).</p>

<p>You have implemented the popular CRUD operations: create, read, update, delete, which is everything you need to manage the new message entity in your Firebase database. Also, you have learned how to assign dates to your Firebase entities, and how to listen for real-time updates when a message has been added, edited or removed.</p>

<h2 class="chapter-header" id="firebase-securing-user-interactions">Securing User Interactions</h2>

<p>So far, every user can edit and remove messages. Let&rsquo;s change this by giving only owner of messages the power to perform these operations within the UI. Therefore, we need the authenticated user in the MessageItem component. Since we already have the authenticated user in the Messages component, let&rsquo;s pass it down to the MessageList component:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">text</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">messages</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">loading</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>

    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">AuthUserContext</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Consumer</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
            <span style="color: #e7e9db">...</span>

            <span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">?</span> <span style="color: #e7e9db">(</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">MessageList</span>
<span style="background-color: #4f424c">                <span style="color: #06b6ef">authUser</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">}</span>
</span>                <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">}</span>
                <span style="color: #06b6ef">onEditMessage</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onEditMessage</span><span style="color: #e7e9db">}</span>
                <span style="color: #06b6ef">onRemoveMessage</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onRemoveMessage</span><span style="color: #e7e9db">}</span>
              <span style="color: #5bc4bf">/&gt;</span>
            <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">(</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">There</span> <span style="color: #06b6ef">are</span> <span style="color: #06b6ef">no</span> <span style="color: #06b6ef">messages</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
            <span style="color: #e7e9db">)}</span>

            <span style="color: #e7e9db">...</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
        <span style="color: #e7e9db">)}</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/AuthUserContext.Consumer&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>And from there down to the MessageItem component:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">const</span> <span style="color: #06b6ef">MessageList</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">({</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">,</span>
</span>  <span style="color: #06b6ef">messages</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">onEditMessage</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">onRemoveMessage</span><span style="color: #e7e9db">,</span>
<span style="color: #e7e9db">})</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
  <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">ul</span><span style="color: #5bc4bf">&gt;</span>
    <span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">map</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">message</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">MessageItem</span>
<span style="background-color: #4f424c">        <span style="color: #06b6ef">authUser</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">}</span>
</span>        <span style="color: #06b6ef">key</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">}</span>
        <span style="color: #06b6ef">message</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">}</span>
        <span style="color: #06b6ef">onEditMessage</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">onEditMessage</span><span style="color: #e7e9db">}</span>
        <span style="color: #06b6ef">onRemoveMessage</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">onRemoveMessage</span><span style="color: #e7e9db">}</span>
      <span style="color: #5bc4bf">/&gt;</span>
    <span style="color: #e7e9db">))}</span>
  <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/ul&gt;</span>
<span style="color: #e7e9db">);</span>
</code></pre></div>


<p>Now in your MessageItem component, you can secure the buttons to edit and remove messages by comparing the message&rsquo;s <code>userId</code> with the authenticated user&rsquo;s id:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessageItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">message</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">onRemoveMessage</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">;</span>
</span>    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">editMode</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">editText</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>

    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">li</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c">        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span> <span style="color: #5bc4bf">===</span> <span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userId</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">span</span><span style="color: #5bc4bf">&gt;</span>
</span>            <span style="color: #e7e9db">{</span><span style="color: #06b6ef">editMode</span> <span style="color: #5bc4bf">?</span> <span style="color: #e7e9db">(</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">span</span><span style="color: #5bc4bf">&gt;</span>
                <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">button</span> <span style="color: #06b6ef">onClick</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onSaveEditText</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Save</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/button&gt;</span>
                <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">button</span> <span style="color: #06b6ef">onClick</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onToggleEditMode</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Reset</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/button&gt;</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/span&gt;</span>
            <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">(</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">button</span> <span style="color: #06b6ef">onClick</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onToggleEditMode</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Edit</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/button&gt;</span>
            <span style="color: #e7e9db">)}</span>

            <span style="color: #e7e9db">{</span><span style="color: #5bc4bf">!</span><span style="color: #06b6ef">editMode</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #e7e9db">(</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">button</span>
                <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;button&quot;</span>
                <span style="color: #06b6ef">onClick</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #06b6ef">onRemoveMessage</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">)}</span>
              <span style="color: #5bc4bf">&gt;</span>
                <span style="color: #06b6ef">Delete</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/button&gt;</span>
            <span style="color: #e7e9db">)}</span>
<span style="background-color: #4f424c">          <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/span&gt;</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">)}</span>
</span>      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/li&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>That&rsquo;s it for only enabling users who are owners of a message to edit and delete the message in the UI. You will see later how you can secure the Firebase API endpoint as well to not allow users to edit/delete entities; otherwise it would still be possible to alter the source code in the browser to show the buttons for deleting and editing messages even though the user has no permission to perform it.</p>

<h2 class="chapter-header" id="firebase-realtime-database-ordering">Ordering with Firebase Realtime Database</h2>

<p>Currently, messages are retrieved in no specific order from the Firebase realtime database, which means they would be in the order of their creation. This is appropriate for a chat application, but let&rsquo;s make this behavior more explicit by ordering them by the <code>createdAt</code> date property since we have introduced this earlier:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">true</span> <span style="color: #e7e9db">});</span>

    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">()</span>
<span style="background-color: #4f424c">      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">orderByChild</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;createdAt&#39;</span><span style="color: #e7e9db">)</span>
</span>      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">on</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
        <span style="color: #815ba4">const</span> <span style="color: #06b6ef">messageObject</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">snapshot</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">val</span><span style="color: #e7e9db">();</span>

        <span style="color: #e7e9db">...</span>
      <span style="color: #e7e9db">});</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Pass the property that should be used to retrieved the list as ordered list from the Firebase realtime database. By default Firebase is ordering the items in ascending direction. To reverse the order, add a <code>reverse()</code> after transforming the list of messages from an object to an array.</p>

<p>You might see a warning about indexing data in Firebase&rsquo;s realtime database, because we&rsquo;re fetching data in a specific order, and Firebase uses the property <code>createdAt</code> to fetch it more efficiently. You can index messages using the <code>createdAt</code> property to give Firebase a performance boost when fetching the messages with this ordering. Head over to your project&rsquo;s Firebase dashboard, open the &ldquo;Database&rdquo; tab, and click the &ldquo;Rules&rdquo; tab. You can add the indexing of the data there:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #e7e9db">{</span>
  <span style="color: #48b685">&quot;rules&quot;</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span>
    <span style="color: #48b685">&quot;messages&quot;</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span>
      <span style="color: #48b685">&quot;.indexOn&quot;</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">[</span><span style="color: #48b685">&quot;createdAt&quot;</span><span style="color: #e7e9db">]</span>
    <span style="color: #e7e9db">}</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>The warning should no longer appear, and Firebase became faster at retrieving messages by creation date. Every time you see the warning popping up, head over to your rules and index your Firebase entities. It makes your Firebase database operations faster.</p>

<h2 class="chapter-header" id="firebase-realtime-database-pagination">Pagination with Firebase Realtime Database</h2>

<p>Next is the ordering feature, and we will paginate the list from the Firebase realtime database as well. You can pass the Firebase API a limit method with an integer to specify how many items you are interested in:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">true</span> <span style="color: #e7e9db">});</span>

    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">()</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">orderByChild</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;createdAt&#39;</span><span style="color: #e7e9db">)</span>
<span style="background-color: #4f424c">      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">limitToLast</span><span style="color: #e7e9db">(</span><span style="color: #f99b15">5</span><span style="color: #e7e9db">)</span>
</span>      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">on</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
        <span style="color: #e7e9db">...</span>
      <span style="color: #e7e9db">});</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Limiting the items is half the task for enabling pagination for our chat application. We also need to move the limit to the local state of the component to adjust it later with user interactions to fetch more than five items:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">super</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">);</span>

    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
      <span style="color: #06b6ef">text</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;&#39;</span><span style="color: #e7e9db">,</span>
      <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span><span style="color: #e7e9db">,</span>
      <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">[],</span>
<span style="background-color: #4f424c">      <span style="color: #06b6ef">limit</span><span style="color: #5bc4bf">:</span> <span style="color: #f99b15">5</span><span style="color: #e7e9db">,</span>
</span>    <span style="color: #e7e9db">};</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">true</span> <span style="color: #e7e9db">});</span>

    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">()</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">orderByChild</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;createdAt&#39;</span><span style="color: #e7e9db">)</span>
<span style="background-color: #4f424c">      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">limitToLast</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">limit</span><span style="color: #e7e9db">)</span>
</span>      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">on</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
        <span style="color: #e7e9db">...</span>
      <span style="color: #e7e9db">});</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>

<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Move this functionality outside of the lifecycle method to make it reusable for other user interaction, and to use it outside of when the component mounts:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onListenForMessages</span><span style="color: #e7e9db">();</span>
</span>  <span style="color: #e7e9db">}</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">onListenForMessages</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
</span>    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">true</span> <span style="color: #e7e9db">});</span>

    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">()</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">orderByChild</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;createdAt&#39;</span><span style="color: #e7e9db">)</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">limitToLast</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">limit</span><span style="color: #e7e9db">)</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">on</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
        <span style="color: #e7e9db">...</span>
      <span style="color: #e7e9db">});</span>
<span style="background-color: #4f424c">  <span style="color: #e7e9db">}</span>
</span>
  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Next, let&rsquo;s add a button to indicate that we are interested in more than five items:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessagesBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">onNextPage</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span> <span style="color: #06b6ef">limit</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">limit</span> <span style="color: #5bc4bf">+</span> <span style="color: #f99b15">5</span> <span style="color: #e7e9db">}),</span>
</span><span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onListenForMessages</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">);</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">};</span>
</span>
  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">text</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">messages</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">loading</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>

    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">AuthUserContext</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Consumer</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
<span style="background-color: #4f424c">            <span style="color: #e7e9db">{</span><span style="color: #5bc4bf">!</span><span style="color: #06b6ef">loading</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">button</span> <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;button&quot;</span> <span style="color: #06b6ef">onClick</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onNextPage</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span>
</span><span style="background-color: #4f424c">                <span style="color: #06b6ef">More</span>
</span><span style="background-color: #4f424c">              <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/button&gt;</span>
</span><span style="background-color: #4f424c">            <span style="color: #e7e9db">)}</span>
</span>
            <span style="color: #e7e9db">...</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
        <span style="color: #e7e9db">)}</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/AuthUserContext.Consumer&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>The button uses a new class method that increases the limit by five again. Afterward, using the second argument of React&rsquo;s setState method, we can renew the Firebase listener with the new limit from the local state. We know that the second function in this React-specific method runs when the asynchronous state update happens, at which point the listener can use the correct limit from the local state.</p>

<p>Everything you have learned in this chapter should make you proficient with structured and list data in Firebase&rsquo;s realtime database. You have learned how to get, create, update and remove entities in a Firebase realtime database, and how to keep a synchronized connection to Firebase and always show the latest entities. Finally, we went through the pagination and ordering features offered by Firebase.</p>

<h3 id="exercises">Exercises:</h3>

<ul>
<li>Read more about <a target="_blank" rel="noopener noreferrer" href="https://firebase.google.com/docs/database/web/structure-data">structuring data in Firebase</a></li>
<li>Read more about <a target="_blank" rel="noopener noreferrer" href="https://firebase.google.com/docs/database/web/lists-of-data">working with lists of data in Firebase</a></li>
<li>Read more about <a target="_blank" rel="noopener noreferrer" href="https://firebase.google.com/docs/database/security/indexing-data">indexing your Firebase data</a></li>
<li>Confirm your <a target="_blank" rel="noopener noreferrer" href="http://bit.ly/2Vng1Sc">source code for the last section</a></li>
<li>Refactoring:

<ul>
<li>Move all user related components on the AdminPage to their own folder/file module.</li>
<li>Move all message related components on the HomePage to their own folder/file module.</li>
<li>Confirm your <a target="_blank" rel="noopener noreferrer" href="http://bit.ly/2VplDLI">source code for this refactoring</a></li>
</ul></li>
<li>Prevent fetching more items with the &ldquo;More&rdquo; button when there are no more items available.</li>
</ul>


                            
<div class="feedback-and-share text-center">
    <hr>
    
    <p class="lead">
        I would like to hear your thoughts :-) Find me on <a target="_blank" rel="noopener noreferrer" aria-label="twitter" href="https://twitter.com/rwieruch"><i class="fa fa-twitter"></i>Twitter</a> and <a target="_blank" aria-label="facebook" href="https://www.facebook.com/rwieruch/"><i class="fa fa-facebook"></i>Facebook</a>
    </p>
    
    
        <p class="lead">
            Did the article help you? Share it with your friends on social media <i class="fa fa-arrow-left"></i>, support me as my <a target="_blank" rel="noopener noreferrer" aria-label="patreon" href="https://www.patreon.com/rwieruch"><i class="fa fa-paw"></i>Patron</a>, and become a full-stack developer with my books <i class="fa fa-arrow-down"></i>
        </p>
    
</div>


                            
                                <div class="box-inline col-md-12">
    <div class="col-md-12 text-center">
        <h2 class="newsletter">The Road to learn React</h2>
        
            <div class="col-md-4">
                <img class="img-lazy img-responsive" data-lazy-src="//img/page/cover.png">
            </div>
        
        <p class="lead">
            Build a Hacker News App along the way. No setup configuration. No tooling. No Redux. Plain React in 200+ pages of learning material. Learn React like <strong>50.000+ readers</strong>.
        </p>
        <a
            class="btn btn-template-main"
            href="https://roadtoreact.com"
            target="_blank"
            rel="noopener noreferrer"
        >
            Get the Book for free <i class="fa fa-chevron-right"></i>
        </a>
        
            <div>
                <a
                    href="https://amzn.to/2QY2ONp"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    Get it from Amazon
                </a>
            </div>
        
    </div>
</div>
                            
                        </div>

                        
                        
                        <div id="comments">
                            <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'rwieruch';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                        </div>
                        

                    </article>
                    

                </div>
                

            </div>
            
        </div>
        

        

<section class="bar background-image-fixed-2 no-mb color-white text-center">
    <div class="dark-mask"></div>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h3 class="lead">Never miss an article about web development, JavaScript and self-growth.</h3>
                <h2 class="text-uppercase">Take Part</h2>
            </div>

            <div class="col-md-12 text-center">
                
                    <h3 class="lead"><i class="fa fa-check"></i> Join 30.000&#43; Developers</h3>
                
                    <h3 class="lead"><i class="fa fa-check"></i> Learn Web Development with JavaScript</h3>
                
                    <h3 class="lead"><i class="fa fa-check"></i> Tips and Tricks</h3>
                
                    <h3 class="lead"><i class="fa fa-check"></i> Access Tutorials, eBooks and Courses</h3>
                
                    <h3 class="lead"><i class="fa fa-check"></i> Personal Development as a Software Engineer</h3>
                
            </div>
            <div class="col-md-12">
                <p class="text-center">
                    



<div id="mc_embed_signup">
    <form
        action="https://www.getrevue.co/profile/rwieruch/add_subscriber"
        method="post"
        id="revue-form"
        name="revue-form"
        target="_blank">
        <div id="mc_embed_signup_scroll">
            <input
                class="email"
                placeholder="email address"
                type="email"
                name="member[email]"
                id="member_email"
            >
            <div>
                <button
                    type="submit"
                    value="Subscribe"
                    name="member[subscribe]"
                    id="member_submit"
                    class="btn btn-template-transparent-black btn-lg"
                >
                    Subscribe
                </button>
            </div>
        </div>
    </form>
</div>

                </p>
            </div>
        </div>
    </div>
</section>




        <footer id="subfooter">
    <div class="container">

        <div class="col-md-5 col-sm-6">

            <h4>Recent posts</h4>

            <div class="blog-entries">
                
                <div class="item same-height-row clearfix">
                    <div class="article same-height-always">
                        <a href="../redux-vs-usereducer/index.html">
                          
                            <img
                                data-lazy-src="//img/posts/redux-vs-usereducer/banner.jpg"
                                data-is-thumb="is-thumb"
                                class="img-lazy img-responsive"
                                alt="React&#39;s useReducer vs Redux"
                            >
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="../redux-vs-usereducer/index.html">React&#39;s useReducer vs Redux</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="article same-height-always">
                        <a href="../publish-npm-package-node/index.html">
                          
                            <img
                                data-lazy-src="//img/posts/publish-npm-package-node/banner.jpg"
                                data-is-thumb="is-thumb"
                                class="img-lazy img-responsive"
                                alt="How to publish a npm package?"
                            >
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="../publish-npm-package-node/index.html">How to publish a npm package?</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="article same-height-always">
                        <a href="../react-scroll-to-item/index.html">
                          
                            <img
                                data-lazy-src="//img/posts/react-scroll-to-item/banner.jpg"
                                data-is-thumb="is-thumb"
                                class="img-lazy img-responsive"
                                alt="How to Scroll to Item in React?"
                            >
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="../react-scroll-to-item/index.html">How to Scroll to Item in React?</a></h5>
                    </div>
                </div>
                
            </div>

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        

        
        <div class="col-md-5 col-md-offset-2 col-sm-6">

            <h4>About Me</h4>

            <div class="blog-entries">
                <div class="item same-height-row clearfix">
                    <div class="profile same-height-always">
                        <img
                            class="img-lazy img-responsive"
                            data-lazy-src="//img/page/profile.jpg"
                            alt="profile"
                        >
                    </div>
                    <div class="name same-height-always">
                        <p>
                            Hi, I'm Chris - a German and Remote/Berlin based consulting software engineer. Find out more <a href="../about/index.html">about me</a>, <a href="../work-with-me/index.html">work with me</a>, or have a look at my social media profiles below.
                        </p>
                    </div>
                </div>
            </div>

        </div>
        
        

    </div>
    
</footer>






        <footer id="copyright">
  <div class="container">
    <div class="row">
      <div class="col-md-4">
        <ul class="info list-inline quicklinks pull-left">
          
            <li>© Chris Paul</li>
          
        </ul>
      </div>
      <div class="col-md-4">
        <ul class="list-inline footer-social-buttons text-center">
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.twitter.com/rwieruch"><i class="fa fa-twitter"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.github.com/rwieruch"><i class="fa fa-github"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.linkedin.com/in/chris-wieruch-971933a6"><i class="fa fa-linkedin"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.producthunt.com/@rwieruch"><i class="fa fa-product-hunt"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.patreon.com/rwieruch"><i class="fa fa-paw"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.paypal.me/rwieruch"><i class="fa fa-paypal"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.facebook.com/rwieruch"><i class="fa fa-facebook"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.instagram.com/rwieruch/"><i class="fa fa-instagram"></i></a></li>
          
        </ul>
      </div>
      <div class="col-md-4">
        <ul class="info list-inline quicklinks pull-right">
          
            <li><a aria-label="quicklinks" href="../legal/index.html">Legal Notice</a></li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>


    </div>
    

    
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-65599459-2', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>









<script src="../js/script.js"></script>



  </body>
</html>
