<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">



  <title>
    React Firebase Authorization with Roles - CPaul
  </title>

  <meta name="author" content="" />
  <meta name="description"
    content="A tutorial on how to use authorization with roles and permissions when using Firebase in React. Learn how to protect routes with authorization rules and how to set properties to Firebase user ...">


  <meta name="theme-color" content="#38bb6c" />

  <meta name="generator" content="Hugo 0.41" />
  <link href="https://cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <link href="../css/bootstrap.default.css" rel="stylesheet" id="theme-stylesheet">
  <link href="../css/customizations.css" rel="stylesheet">

  <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  <link rel="shortcut icon" href="../img/favicon/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="../img/favicon/apple-touch-icon.png" />
  <link rel="manifest" href="../img/favicon/manifest.json">
  <link rel="mask-icon" href="../img/favicon/safari-pinned-tab.svg" color="#5bbad5">

  <link rel="alternate" href="../index.xml" type="application/rss+xml" title="CPaul">

  <meta itemprop="name" content="React Firebase Authorization with Roles">
  <meta itemprop="description"
    content="A tutorial on how to use authorization with roles and permissions when using Firebase in React. Learn how to protect routes with authorization rules and how to set properties to Firebase user ...">
  <meta itemprop="image"
    content="https://chrispaul.dev/img/posts/react-firebase-authorization-roles-permissions/banner_640.jpg">
  <meta itemprop="keywords"
    content="angular,apollo,d3,graphql,growth,javascript,machine-learning,mobx,node,react,reason,redux,tooling,vue,web-development,angular,apollo,d3,graphql,growth,javascript,machine-learning,mobx,node,react,reason,redux,tooling,web-development," />


  <meta itemprop="wordCount" content="2227">

  <meta name="keywords"
    content="react firebase authorization, react firebase protected routes, react firebase permissions, firebase set user properties">

  <meta property="og:title" content="React Firebase Authorization with Roles - CPaul">


  <meta property="og:description"
    content="A tutorial on how to use authorization with roles and permissions when using Firebase in React. Learn how to protect routes with authorization rules and how to set properties to Firebase user ..." />


  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://chrispaul.dev/react-firebase-authorization-roles-permissions/" />
  <meta property="og:image"
    content="https://chrispaul.dev/img/posts/react-firebase-authorization-roles-permissions/banner_640.jpg" />



  <meta name="news_keywords"
    content="react firebase authorization,react firebase protected routes,react firebase permissions,firebase set user properties" />



  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image:src"
    content="https://chrispaul.dev/img/posts/react-firebase-authorization-roles-permissions/banner_640.jpg" />
  <meta name="twitter:title" content="React Firebase Authorization with Roles" />
  <meta name="twitter:description"
    content="A tutorial on how to use authorization with roles and permissions when using Firebase in React. Learn how to protect routes with authorization rules and how to set properties to Firebase user ..." />
  <meta name="twitter:site" content="@ChrisPaulDev" />
  



</head>


<body>

  <div id="all">

    <header>

      <div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

        <div class="navbar navbar-default yamm" role="navigation" id="navbar">

          <div class="container">
            <div class="navbar-header">
              

              <div class="navbar-buttons">
                <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse"
                  data-target="#navigation">
                  <span class="sr-only">Toggle navigation</span>
                  <i class="fa fa-align-justify"></i>
                </button>
              </div>
            </div>


            <div class="navbar-collapse collapse" id="navigation">
              <ul class="nav navbar-nav navbar-right">

                <li class="dropdown">

                  <a href="../index.html">Blog</a>

                </li>

                <li class="dropdown">

                  <a href="../work-with-me/index.html">Work with me</a>

                </li>

                <li class="dropdown">

                  <a href="../about/index.html">About</a>

                </li>

                <li class="dropdown">

                  <a style="color: #38bb6c" href="https://roadtoreact.com/">Books &amp; Courses</a>

                </li>

              </ul>
            </div>


            <div class="collapse clearfix" id="search">

              <form class="navbar-form" role="search">
                <div class="input-group">
                  <input type="text" class="form-control" placeholder="Search">
                  <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>

                  </span>
                </div>
              </form>

            </div>


          </div>
        </div>


      </div>
    </header>

    

    



    <div class="hidden-xs">


      <section class="bar background-image-fixed-2 no-mb color-white text-center">
        <div class="dark-mask"></div>
        <div class="container">
          <div class="row">
            <div class="col-md-12">
              <h3 class="lead">Never miss an article about web development, JavaScript and self-growth.</h3>
              <h2 class="text-uppercase newsletter">Take Part</h2>
            </div>

            <div class="col-md-12">
              <p class="text-center">
                <div id="mc_embed_signup">
                  <form action="https://www.getrevue.co/profile/rwieruch/add_subscriber" method="post" id="revue-form"
                    name="revue-form" target="_blank">
                    <div id="mc_embed_signup_scroll">
                      <input class="email" placeholder="email address" type="email" name="member[email]"
                        id="member_email">
                      <div>
                        <button type="submit" value="Subscribe" name="member[subscribe]" id="member_submit"
                          class="btn btn-template-transparent-black btn-lg">
                          Subscribe
                        </button>
                      </div>
                    </div>
                  </form>
                </div>

              </p>
            </div>
          </div>
        </div>
      </section>
    </div>

    <div id="content">
      <div class="container">

        <div class="row">

          <article class="col-md-8 col-md-offset-2" id="blog-post" itemprop="blogPosts" itemscope
            itemtype="http://schema.org/BlogPosting">

            <div id="post-content" itemprop="articleBody">

              <header>
                <h1 itemprop="name headline">React Firebase Authorization with Roles</h1>
              </header>

              

              <p class="text-muted text-uppercase mb-small text-center">
                <span itemprop="author publisher">

                </span>


                <time datetime="2018-11-26" itemprop="datePublished">
                  November 26, 2018
                </time>



              </p>



              <div>


              </div>

              <div class="post-image-primary">
                <div class="pinterest-pinner-wrapper" itemscope itemtype="http://schema.org/ImageObject">
                  <div class="pinterest-pinner">
                    <a data-pin-do="buttonPin" data-pin-save="true" data-pin-tall="true"
                      href="https://www.pinterest.com/pin/create/button/?url=https%3a%2f%2fchrispaul.dev%2freact-firebase-authorization-roles-permissions%2f&amp;media=https://chrispaul.dev/img%2fposts%2freact-firebase-authorization-roles-permissions%2fbanner.jpg&amp;description=">
                    </a>
                  </div>

                  <img class="img-lazy img-responsive"
                    data-lazy-src="/src="/img/posts/react-firebase-authorization-roles-permissions/banner.jpg"
                    data-is-src-set="is-src-set" alt="react firebase authorization" itemprop="image" />
                </div>
              </div>


              <p>
                <em>
                  Interested in reading this tutorial as one of many chapters in my advanced React with Firebase book?
                  Checkout the entire <a href="https://roadtoreact.com">The Road to React with Firebase</a> book that
                  teaches you to create business web applications without the need to create a backend application with
                  a database yourself.
                </em>
              </p>

              <div class="read-before">
                <p>This tutorial is part 2 of 2 in this series.</p>
                <div>Part 1: <a href="../complete-firebase-authentication-react-tutorial/index.html" itemprop="url">A
                    Firebase in React Tutorial for Beginners</a></div>
              </div>

              <p>So far, you&rsquo;ve used broad authorization rules that check user authentication, where the dedicated
                authorization higher-order component redirects them to the login page if the user is not authenticated.
                In this section, you will apply a more specific authorization mechanism. It works with roles (e.g.
                Admin, Author) assigned to a user, but also with permissions (e.g. user is allowed to write an article).
                Again, if the user doesn&rsquo;t fit a role for the authorization condition in your authorization
                higher-order component, the user will be redirected. Let&rsquo;s revisit the
                <em>src/components/Session/withAuthorization.js</em> higher-order component we have implemented thus
                far:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withRouter</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-router-dom&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">import</span> <span style="color: #06b6ef">AuthUserContext</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./context&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">as</span> <span style="color: #06b6ef">ROUTES</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../../constants/routes&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">withAuthorization</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">condition</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #06b6ef">Component</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">class</span> <span style="color: #06b6ef">WithAuthorization</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
    <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">listener</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">auth</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onAuthStateChanged</span><span style="color: #e7e9db">(</span>
        <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
          <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #5bc4bf">!</span><span style="color: #06b6ef">condition</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">))</span> <span style="color: #e7e9db">{</span>
            <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">history</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">push</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">ROUTES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">SIGN_IN</span><span style="color: #e7e9db">);</span>
          <span style="color: #e7e9db">}</span>
        <span style="color: #e7e9db">},</span>
      <span style="color: #e7e9db">);</span>
    <span style="color: #e7e9db">}</span>

    <span style="color: #06b6ef">componentWillUnmount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">listener</span><span style="color: #e7e9db">();</span>
    <span style="color: #e7e9db">}</span>

    <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">AuthUserContext</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Consumer</span><span style="color: #5bc4bf">&gt;</span>
          <span style="color: #e7e9db">{</span><span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span>
            <span style="color: #06b6ef">condition</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">?</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{...</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span> <span style="color: #5bc4bf">:</span> <span style="color: #815ba4">null</span>
          <span style="color: #e7e9db">}</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/AuthUserContext.Consumer&gt;</span>
      <span style="color: #e7e9db">);</span>
    <span style="color: #e7e9db">}</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #815ba4">return</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
    <span style="color: #06b6ef">withRouter</span><span style="color: #e7e9db">,</span>
    <span style="color: #06b6ef">withFirebase</span><span style="color: #e7e9db">,</span>
  <span style="color: #e7e9db">)(</span><span style="color: #06b6ef">WithAuthorization</span><span style="color: #e7e9db">);</span>
<span style="color: #e7e9db">};</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">withAuthorization</span><span style="color: #e7e9db">;</span>
</code></pre>
              </div>


              <p>The Firebase listener always gives us the recent authenticated user. We don&rsquo;t know if the user is
                null though, so we deployed broader authorization rules for a few routes (e.g. <em>/home</em>) of the
                application. If a user is not authenticated, we redirect the user to the login page.</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">const</span> <span style="color: #06b6ef">condition</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #5bc4bf">!!</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">;</span>
</code></pre>
              </div>


              <p>Now we can go a step further and check for a user&rsquo;s role or permission:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">const</span> <span style="color: #06b6ef">condition</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span>
  <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #5bc4bf">!!</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">roles</span><span style="color: #e7e9db">[</span><span style="color: #06b6ef">ROLES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">ADMIN</span><span style="color: #e7e9db">];</span>
</code></pre>
              </div>


              <p>Assigning properties like an object of roles to authenticated users is a straightforward task. However,
                as we learned in previous sections, authenticated users are managed internally by Firebase. We are not
                able to alter user properties, so we manage them in Firebase&rsquo;s realtime database. If you go to
                your Firebase project&rsquo;s dashboard, you can see that users are managed in the Authentication and
                Database tabs. We introduced the latter to keep track of the users and assign them additional properties
                ourselves.</p>

              <p>This section is split up into three parts:</p>

              <ul>
                <li>Assign a user on sign up a roles (e.g. admin role) property.</li>
                <li>Merge the authenticated user and database user so they can be authorized with their roles in the
                  authorization higher-order component.</li>
                <li>Showcase a role authorization for one of our routes (e.g. only allowed for admin users).</li>
              </ul>

              <p>Firebase has an official way to introduce roles to your authenticated user. I am not very comfortable
                with it, though, because it uses lots of Firebase internals and increases the effect of vendor lock-ins.
                Instead, I prefer storing roles directly into the user entities in the Firebase database. This way,
                you&rsquo;ll have an easier time migrating away from Firebase if you decide to roll out a backend
                application with a database.</p>

              <h2 class="chapter-header" id="firebase-database-user-role">Firebase Database Users with Roles</h2>

              <p>We&rsquo;ll use multiple roles because users may have more than one role in the application or system.
                For instance, a user could be an admin, but also an author with access to admin and author areas.
                Let&rsquo;s assign a <code>roles</code> property to our users when they are created in the realtime
                database on sign-up. First, we&rsquo;ll track a checkbox state for this type of role in our component in
                the <em>src/components/SignUp/index.js</em> file:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">const</span> <span style="color: #06b6ef">INITIAL_STATE</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">username</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;&#39;</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">email</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;&#39;</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">passwordOne</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;&#39;</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">passwordTwo</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;&#39;</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">isAdmin</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span><span style="color: #e7e9db">,</span>
</span>  <span style="color: #06b6ef">error</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">null</span><span style="color: #e7e9db">,</span>
<span style="color: #e7e9db">};</span>
</code></pre>
              </div>


              <p>Next, add a checkbox to toggle the user role in the UI:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">SignUpFormBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>

  <span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">onChangeCheckbox</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">event</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #e7e9db">[</span><span style="color: #06b6ef">event</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">target</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">name</span><span style="color: #e7e9db">]</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">event</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">target</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">checked</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">};</span>
</span>
  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span>
      <span style="color: #06b6ef">username</span><span style="color: #e7e9db">,</span>
      <span style="color: #06b6ef">email</span><span style="color: #e7e9db">,</span>
      <span style="color: #06b6ef">passwordOne</span><span style="color: #e7e9db">,</span>
      <span style="color: #06b6ef">passwordTwo</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">      <span style="color: #06b6ef">isAdmin</span><span style="color: #e7e9db">,</span>
</span>      <span style="color: #06b6ef">error</span><span style="color: #e7e9db">,</span>
    <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>

    <span style="color: #e7e9db">...</span>

    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">form</span> <span style="color: #06b6ef">onSubmit</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onSubmit</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #e7e9db">...</span>
<span style="background-color: #4f424c">        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">label</span><span style="color: #5bc4bf">&gt;</span>
</span><span style="background-color: #4f424c">          <span style="color: #06b6ef">Admin</span><span style="color: #5bc4bf">:</span>
</span><span style="background-color: #4f424c">          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">input</span>
</span><span style="background-color: #4f424c">            <span style="color: #06b6ef">name</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;isAdmin&quot;</span>
</span><span style="background-color: #4f424c">            <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;checkbox&quot;</span>
</span><span style="background-color: #4f424c">            <span style="color: #06b6ef">checked</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">isAdmin</span><span style="color: #e7e9db">}</span>
</span><span style="background-color: #4f424c">            <span style="color: #06b6ef">onChange</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onChangeCheckbox</span><span style="color: #e7e9db">}</span>
</span><span style="background-color: #4f424c">          <span style="color: #5bc4bf">/&gt;</span>
</span><span style="background-color: #4f424c">        <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/label&gt;</span>
</span>        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">button</span> <span style="color: #06b6ef">disabled</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">isInvalid</span><span style="color: #e7e9db">}</span> <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;submit&quot;</span><span style="color: #5bc4bf">&gt;</span>
          <span style="color: #06b6ef">Sign</span> <span style="color: #06b6ef">Up</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/button&gt;</span>

        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">error</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">p</span><span style="color: #5bc4bf">&gt;</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">error</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">message</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/p&gt;}</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/form&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>

<span style="color: #e7e9db">...</span>
</code></pre>
              </div>


              <p>We don&rsquo;t want to grant any user the power to sign up as admin, but we&rsquo;ll keep it simple for
                now, and you can decide which circumstances prompt you to assign roles to users later. Next, add the
                roles property to your user when they are created in the database. Since we need an object of roles,
                we&rsquo;ll initialize it as an empty object and add conditional roles to it:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Link</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">withRouter</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-router-dom&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">as</span> <span style="color: #06b6ef">ROUTES</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../../constants/routes&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">as</span> <span style="color: #06b6ef">ROLES</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../../constants/roles&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="color: #e7e9db">...</span>

<span style="color: #815ba4">class</span> <span style="color: #06b6ef">SignUpFormBase</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">onSubmit</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">event</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">username</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">email</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">passwordOne</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">isAdmin</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">const</span> <span style="color: #06b6ef">roles</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{};</span>
</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">isAdmin</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">roles</span><span style="color: #e7e9db">[</span><span style="color: #06b6ef">ROLES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">ADMIN</span><span style="color: #e7e9db">]</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">ROLES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">ADMIN</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">}</span>
</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">doCreateUserWithEmailAndPassword</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">email</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">passwordOne</span><span style="color: #e7e9db">)</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">then</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
        <span style="color: #776e71">// Create a user in your Firebase realtime database</span>
        <span style="color: #815ba4">return</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span>
          <span style="color: #e7e9db">.</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">)</span>
          <span style="color: #e7e9db">.</span><span style="color: #06b6ef">set</span><span style="color: #e7e9db">({</span>
            <span style="color: #06b6ef">username</span><span style="color: #e7e9db">,</span>
            <span style="color: #06b6ef">email</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">            <span style="color: #06b6ef">roles</span><span style="color: #e7e9db">,</span>
</span>          <span style="color: #e7e9db">})</span>
      <span style="color: #e7e9db">})</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">then</span><span style="color: #e7e9db">(()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #e7e9db">...</span><span style="color: #06b6ef">INITIAL_STATE</span> <span style="color: #e7e9db">});</span>
        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">history</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">push</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">ROUTES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">HOME</span><span style="color: #e7e9db">);</span>
      <span style="color: #e7e9db">})</span>
      <span style="color: #e7e9db">.</span><span style="color: #815ba4">catch</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">error</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">error</span> <span style="color: #e7e9db">});</span>
      <span style="color: #e7e9db">});</span>

    <span style="color: #06b6ef">event</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">preventDefault</span><span style="color: #e7e9db">();</span>
  <span style="color: #e7e9db">};</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>

<span style="color: #e7e9db">...</span>
</code></pre>
              </div>


              <p>Next, collect all your roles in the <em>src/constants/roles.js</em> file we just imported in the
                previous step. It can be used to assign roles as you did before, but also to protect routes later on.
              </p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="background-color: #4f424c"><span style="color: #815ba4">export</span> <span style="color: #815ba4">const</span> <span style="color: #06b6ef">ADMIN</span> <span style="color: #5bc4bf">=</span> <span style="color: #48b685">&#39;ADMIN&#39;</span><span style="color: #e7e9db">;</span>
</span></code></pre>
              </div>


              <p>You should be able to create users with admin privileges now. Next we&rsquo;ll cover how to merge this
                user from our database with the authenticated user from the Firebase authentication.</p>

              <h2 class="chapter-header" id="firebase-user-merge">How to merge authenticated user with database user?
              </h2>

              <p>Since we need to check the roles only in the authorization higher-order component, it&rsquo;s best to
                merge the authentication user and database user in this component before checking for its privileges
                (roles, permissions).</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #e7e9db">...</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">withAuthorization</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">condition</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #06b6ef">Component</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">class</span> <span style="color: #06b6ef">WithAuthorization</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
    <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">listener</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">auth</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onAuthStateChanged</span><span style="color: #e7e9db">(</span>
        <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">          <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">            <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span>
</span><span style="background-color: #4f424c">              <span style="color: #e7e9db">.</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">)</span>
</span><span style="background-color: #4f424c">              <span style="color: #e7e9db">.</span><span style="color: #06b6ef">once</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">)</span>
</span><span style="background-color: #4f424c">              <span style="color: #e7e9db">.</span><span style="color: #06b6ef">then</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">                <span style="color: #815ba4">const</span> <span style="color: #06b6ef">dbUser</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">snapshot</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">val</span><span style="color: #e7e9db">();</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">                <span style="color: #776e71">// default empty roles</span>
</span><span style="background-color: #4f424c">                <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #5bc4bf">!</span><span style="color: #06b6ef">dbUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">roles</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">                  <span style="color: #06b6ef">dbUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">roles</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{};</span>
</span><span style="background-color: #4f424c">                <span style="color: #e7e9db">}</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">                <span style="color: #776e71">// merge auth and db user</span>
</span><span style="background-color: #4f424c">                <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">                  <span style="color: #06b6ef">uid</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">                  <span style="color: #06b6ef">email</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">email</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">                  <span style="color: #e7e9db">...</span><span style="color: #06b6ef">dbUser</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">                <span style="color: #e7e9db">};</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">                <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #5bc4bf">!</span><span style="color: #06b6ef">condition</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">))</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">                  <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">history</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">push</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">ROUTES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">SIGN_IN</span><span style="color: #e7e9db">);</span>
</span><span style="background-color: #4f424c">                <span style="color: #e7e9db">}</span>
</span><span style="background-color: #4f424c">              <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">          <span style="color: #e7e9db">}</span> <span style="color: #815ba4">else</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">            <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">history</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">push</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">ROUTES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">SIGN_IN</span><span style="color: #e7e9db">);</span>
</span><span style="background-color: #4f424c">          <span style="color: #e7e9db">}</span>
</span>        <span style="color: #e7e9db">},</span>
      <span style="color: #e7e9db">);</span>
    <span style="color: #e7e9db">}</span>

    <span style="color: #e7e9db">...</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">};</span>

<span style="color: #e7e9db">...</span>
</code></pre>
              </div>


              <p>When the authenticated user changes, the function within the listener is called. If the user is null,
                it redirects. If the user is not null, we will get the database user with the help of the authenticated
                user&rsquo;s unique identifier, and then we merge everything from the database user with the unique
                identifier and email from the authenticated user. You may need more properties from the authenticated
                user later, but at this point the unique identifier and the email are sufficient. As we did before, we
                are running our conditional check to see if the user is authorized or not. However, now we have all the
                properties from the database user (e.g. roles) at our disposal. If the conditions are not met, we
                redirect the user. If the conditions are met, the user stays on the page component enhanced by the
                authorization higher-order component.</p>

              <p>We&rsquo;ve covered merging the user in the authorization higher-order component. Next, we&rsquo;ll
                consider the authentication higher-order component that provides authentication for all our components.
                Maybe we want to show something to the user based on their level of authentication like a link to admin
                page in the navigation. Let&rsquo;s implement the merging in this higher-order component, too:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #e7e9db">...</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">withAuthentication</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">Component</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">class</span> <span style="color: #06b6ef">WithAuthentication</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
    <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">listener</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">auth</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onAuthStateChanged</span><span style="color: #e7e9db">(</span>
        <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">          <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">            <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span>
</span><span style="background-color: #4f424c">              <span style="color: #e7e9db">.</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">)</span>
</span><span style="background-color: #4f424c">              <span style="color: #e7e9db">.</span><span style="color: #06b6ef">once</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">)</span>
</span><span style="background-color: #4f424c">              <span style="color: #e7e9db">.</span><span style="color: #06b6ef">then</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">                <span style="color: #815ba4">const</span> <span style="color: #06b6ef">dbUser</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">snapshot</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">val</span><span style="color: #e7e9db">();</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">                <span style="color: #776e71">// default empty roles</span>
</span><span style="background-color: #4f424c">                <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #5bc4bf">!</span><span style="color: #06b6ef">dbUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">roles</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">                  <span style="color: #06b6ef">dbUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">roles</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{};</span>
</span><span style="background-color: #4f424c">                <span style="color: #e7e9db">}</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">                <span style="color: #776e71">// merge auth and db user</span>
</span><span style="background-color: #4f424c">                <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">                  <span style="color: #06b6ef">uid</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">                  <span style="color: #06b6ef">email</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">email</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">                  <span style="color: #e7e9db">...</span><span style="color: #06b6ef">dbUser</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">                <span style="color: #e7e9db">};</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">                <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">authUser</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">              <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">          <span style="color: #e7e9db">}</span> <span style="color: #815ba4">else</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">            <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">authUser</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">null</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">          <span style="color: #e7e9db">}</span>
</span>        <span style="color: #e7e9db">},</span>
      <span style="color: #e7e9db">);</span>
    <span style="color: #e7e9db">}</span>

    <span style="color: #e7e9db">...</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">};</span>

<span style="color: #e7e9db">...</span>
</code></pre>
              </div>


              <p>Now the authenticated user is provided via React&rsquo;s Context API extended with the database user to
                all our components. As you may have noticed, the implementation was quite repetitive to the
                authorization higher-order component. The only thing we changed was the local state usage instead of the
                redirects. Let&rsquo;s see how we can extract the common implementation to our Firebase class without
                touching the implementation details with the local state (authentication higher-order component) and the
                redirection (authorization higher-order component).</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #e7e9db">...</span>

<span style="color: #815ba4">class</span> <span style="color: #06b6ef">Firebase</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #776e71">// *** Auth API ***</span>

  <span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c">  <span style="color: #776e71">// *** Merge Auth and DB User API *** //</span>
</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">onAuthUserListener</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">next</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">fallback</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">auth</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onAuthStateChanged</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">)</span>
</span><span style="background-color: #4f424c">          <span style="color: #e7e9db">.</span><span style="color: #06b6ef">once</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">)</span>
</span><span style="background-color: #4f424c">          <span style="color: #e7e9db">.</span><span style="color: #06b6ef">then</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">            <span style="color: #815ba4">const</span> <span style="color: #06b6ef">dbUser</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">snapshot</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">val</span><span style="color: #e7e9db">();</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">            <span style="color: #776e71">// default empty roles</span>
</span><span style="background-color: #4f424c">            <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #5bc4bf">!</span><span style="color: #06b6ef">dbUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">roles</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">              <span style="color: #06b6ef">dbUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">roles</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{};</span>
</span><span style="background-color: #4f424c">            <span style="color: #e7e9db">}</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">            <span style="color: #776e71">// merge auth and db user</span>
</span><span style="background-color: #4f424c">            <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">              <span style="color: #06b6ef">uid</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">              <span style="color: #06b6ef">email</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">email</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">              <span style="color: #e7e9db">...</span><span style="color: #06b6ef">dbUser</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">            <span style="color: #e7e9db">};</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">            <span style="color: #06b6ef">next</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">);</span>
</span><span style="background-color: #4f424c">          <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">      <span style="color: #e7e9db">}</span> <span style="color: #815ba4">else</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">        <span style="color: #06b6ef">fallback</span><span style="color: #e7e9db">();</span>
</span><span style="background-color: #4f424c">      <span style="color: #e7e9db">}</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">});</span>
</span>
  <span style="color: #776e71">// *** User API ***</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">Firebase</span><span style="color: #e7e9db">;</span>
</code></pre>
              </div>


              <p>Observe which common implementation details were taken from the two higher-order components. The only
                thing changed in this extracted function are the <code>next()</code> and <code>fallback()</code>
                callback functions. This is where we can implement the specific implementation details of every
                higher-order component (local state for authentication, redirect for authorization) that uses this new
                method. Let&rsquo;s use this function first in the authentication higher-order component and provide
                both callback functions as &ldquo;next&rdquo; and &ldquo;fallback&rdquo;:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #e7e9db">...</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">withAuthentication</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">Component</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">class</span> <span style="color: #06b6ef">WithAuthentication</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
    <span style="color: #e7e9db">...</span>

    <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">listener</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onAuthUserListener</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">        <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">          <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">authUser</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">},</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">          <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">authUser</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">null</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">},</span>
</span><span style="background-color: #4f424c">      <span style="color: #e7e9db">);</span>
</span>    <span style="color: #e7e9db">}</span>

    <span style="color: #e7e9db">...</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">};</span>

<span style="color: #e7e9db">...</span>
</code></pre>
              </div>


              <p>The higher-order component uses this new method from the Firebase instance, providing only two callback
                functions as parameters. The first callback function is used for the merged user; the second is used
                when the authenticated user is null. Let&rsquo;s use the new method in the authorization higher-order
                component as well:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #e7e9db">...</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">withAuthorization</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">condition</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #06b6ef">Component</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">class</span> <span style="color: #06b6ef">WithAuthorization</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
    <span style="color: #e7e9db">...</span>

    <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">listener</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onAuthUserListener</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">        <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">          <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #5bc4bf">!</span><span style="color: #06b6ef">condition</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">))</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">            <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">history</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">push</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">ROUTES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">SIGN_IN</span><span style="color: #e7e9db">);</span>
</span><span style="background-color: #4f424c">          <span style="color: #e7e9db">}</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">},</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">history</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">push</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">ROUTES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">SIGN_IN</span><span style="color: #e7e9db">),</span>
</span><span style="background-color: #4f424c">      <span style="color: #e7e9db">);</span>
</span>    <span style="color: #e7e9db">}</span>

    <span style="color: #e7e9db">...</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">};</span>

<span style="color: #e7e9db">...</span>
</code></pre>
              </div>


              <p>We extracted the business logic that merges authentication user and database user to the Firebase
                class, made it available as method on the class instance, and used it in both higher-order components.
                Since we can provide two callback functions to this new method, which are executed based on whether the
                user is authenticated or not, each higher-order component gains control over what happens afterward. The
                authorization higher-order component cares about redirects, while the authentication higher-order
                component cares about storing the merged user in the local state and distributing it to other components
                via React&rsquo;s Context Provider component.</p>

              <h2 class="chapter-header" id="firebase-user-privilege-authorization">Authorize a Firebase User based on a
                Role</h2>

              <p>Now we need to check whether our role-based authorization is working after all. The admin page is the
                best place to deploy a role-based authorization, because so far it is open for everyone and not secured.
              </p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withAuthorization</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Session&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">as</span> <span style="color: #06b6ef">ROLES</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../../constants/roles&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="color: #815ba4">class</span> <span style="color: #06b6ef">AdminPage</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">users</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">loading</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>

    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">h1</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Admin</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/h1&gt;</span>
<span style="background-color: #4f424c">        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">p</span><span style="color: #5bc4bf">&gt;</span>
</span><span style="background-color: #4f424c">          <span style="color: #06b6ef">The</span> <span style="color: #06b6ef">Admin</span> <span style="color: #06b6ef">Page</span> <span style="color: #06b6ef">is</span> <span style="color: #06b6ef">accessible</span> <span style="color: #06b6ef">by</span> <span style="color: #06b6ef">every</span> <span style="color: #06b6ef">signed</span> <span style="color: #815ba4">in</span> <span style="color: #06b6ef">admin</span> <span style="color: #06b6ef">user</span><span style="color: #e7e9db">.</span>
</span><span style="background-color: #4f424c">        <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/p&gt;</span>
</span>
        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">loading</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Loading</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;}</span>

        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">UserList</span> <span style="color: #06b6ef">users</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>

<span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">condition</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #5bc4bf">!!</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">roles</span><span style="color: #e7e9db">[</span><span style="color: #06b6ef">ROLES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">ADMIN</span><span style="color: #e7e9db">];</span>
</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">withAuthorization</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">condition</span><span style="color: #e7e9db">),</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">withFirebase</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">)(</span><span style="color: #06b6ef">AdminPage</span><span style="color: #e7e9db">);</span>
</span></code></pre>
              </div>


              <p>If you try to access the admin page as non-authenticated user or as non-admin user without the
                necessary role, it redirects you to the login page. If you access it as user with admin privileges, you
                should be able to see the desired content. The authorization higher-order component made this possible.
              </p>

              <p>Next, we&rsquo;ll secure the route to the admin page in the Navigation component. That&rsquo;s where
                the (merged) authenticated user from the authentication higher-order component comes in. Using
                React&rsquo;s Context in this higher-order component, you can access the extended authenticated user:
              </p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #e7e9db">...</span>

<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">AuthUserContext</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Session&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">SignOutButton</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../SignOut&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">as</span> <span style="color: #06b6ef">ROUTES</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../../constants/routes&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">as</span> <span style="color: #06b6ef">ROLES</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../../constants/roles&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="color: #815ba4">const</span> <span style="color: #06b6ef">Navigation</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
  <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">AuthUserContext</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Consumer</span><span style="color: #5bc4bf">&gt;</span>
    <span style="color: #e7e9db">{</span><span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span>
      <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">?</span> <span style="color: #e7e9db">(</span>
<span style="background-color: #4f424c">        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">NavigationAuth</span> <span style="color: #06b6ef">authUser</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span>
</span>      <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">(</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">NavigationNonAuth</span> <span style="color: #5bc4bf">/&gt;</span>
      <span style="color: #e7e9db">)</span>
    <span style="color: #e7e9db">}</span>
  <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/AuthUserContext.Consumer&gt;</span>
<span style="color: #e7e9db">);</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">NavigationAuth</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">({</span> <span style="color: #06b6ef">authUser</span> <span style="color: #e7e9db">})</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
</span>  <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">ul</span><span style="color: #5bc4bf">&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">li</span><span style="color: #5bc4bf">&gt;</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Link</span> <span style="color: #06b6ef">to</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">ROUTES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">LANDING</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Landing</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/Link&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/li&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">li</span><span style="color: #5bc4bf">&gt;</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Link</span> <span style="color: #06b6ef">to</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">ROUTES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">HOME</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Home</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/Link&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/li&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">li</span><span style="color: #5bc4bf">&gt;</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Link</span> <span style="color: #06b6ef">to</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">ROUTES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">ACCOUNT</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Account</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/Link&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/li&gt;</span>
<span style="background-color: #4f424c">    <span style="color: #e7e9db">{</span><span style="color: #5bc4bf">!!</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">roles</span><span style="color: #e7e9db">[</span><span style="color: #06b6ef">ROLES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">ADMIN</span><span style="color: #e7e9db">]</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">li</span><span style="color: #5bc4bf">&gt;</span>
</span><span style="background-color: #4f424c">        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Link</span> <span style="color: #06b6ef">to</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">ROUTES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">ADMIN</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Admin</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/Link&gt;</span>
</span><span style="background-color: #4f424c">      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/li&gt;</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">)}</span>
</span>    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">li</span><span style="color: #5bc4bf">&gt;</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">SignOutButton</span> <span style="color: #5bc4bf">/&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/li&gt;</span>
  <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/ul&gt;</span>
<span style="color: #e7e9db">);</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">NavigationNonAuth</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
  <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">ul</span><span style="color: #5bc4bf">&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">li</span><span style="color: #5bc4bf">&gt;</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Link</span> <span style="color: #06b6ef">to</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">ROUTES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">LANDING</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Landing</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/Link&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/li&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">li</span><span style="color: #5bc4bf">&gt;</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Link</span> <span style="color: #06b6ef">to</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">ROUTES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">SIGN_IN</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Sign</span> <span style="color: #06b6ef">In</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/Link&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/li&gt;</span>
  <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/ul&gt;</span>
<span style="color: #e7e9db">);</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">Navigation</span><span style="color: #e7e9db">;</span>
</code></pre>
              </div>


              <p>You have successfully assigned roles to your users, merged authentication user with the database user
                in your higher-order components, and applied authorization rules with redirects and conditional
                rendering in your application. Everything that is added to the database user will be available when you
                launch your application, and you&rsquo;ve set properties for the Firebase user.</p>

              <h3 id="exercises">Exercises:</h3>

              <ul>
                <li>Walk through a scenario where the role-based authorization could be replaced with a permission-based
                  authorization (e.g. <code>authUser.permissions.canEditUser</code>).</li>
                <li>Confirm your <a target="_blank" rel="noopener noreferrer" href="http://bit.ly/2VneMT2">source code
                    for the last section</a></li>
              </ul>



              



              <div class="box-inline col-md-12">
                <div class="col-md-12 text-center">
                  <h2 class="newsletter">The Road to learn React</h2>

                  <div class="col-md-4">
                    <img class="img-lazy img-responsive" data-lazy-src="//img/page/cover.png">
                  </div>

                  <p class="lead">
                    Build a Hacker News App along the way. No setup configuration. No tooling. No Redux. Plain React in
                    200+ pages of learning material. Learn React like <strong>50.000+ readers</strong>.
                  </p>
                  <a class="btn btn-template-main" href="https://roadtoreact.com" target="_blank"
                    rel="noopener noreferrer">
                    Get the Book for free <i class="fa fa-chevron-right"></i>
                  </a>

                  <div>
                    <a href="https://amzn.to/2QY2ONp" target="_blank" rel="noopener noreferrer">
                      Get it from Amazon
                    </a>
                  </div>

                </div>
              </div>

            </div>



            


          </article>


        </div>


      </div>

    </div>




    <section class="bar background-image-fixed-2 no-mb color-white text-center">
      <div class="dark-mask"></div>
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <h3 class="lead">Never miss an article about web development, JavaScript and self-growth.</h3>
            <h2 class="text-uppercase">Take Part</h2>
          </div>

          <div class="col-md-12 text-center">

            <h3 class="lead"><i class="fa fa-check"></i> Join 30.000&#43; Developers</h3>

            <h3 class="lead"><i class="fa fa-check"></i> Learn Web Development with JavaScript</h3>

            <h3 class="lead"><i class="fa fa-check"></i> Tips and Tricks</h3>

            <h3 class="lead"><i class="fa fa-check"></i> Access Tutorials, eBooks and Courses</h3>

            <h3 class="lead"><i class="fa fa-check"></i> Personal Development as a Software Engineer</h3>

          </div>
          <div class="col-md-12">
            <p class="text-center">
              <div id="mc_embed_signup">
                <form action="https://www.getrevue.co/profile/rwieruch/add_subscriber" method="post" id="revue-form"
                  name="revue-form" target="_blank">
                  <div id="mc_embed_signup_scroll">
                    <input class="email" placeholder="email address" type="email" name="member[email]"
                      id="member_email">
                    <div>
                      <button type="submit" value="Subscribe" name="member[subscribe]" id="member_submit"
                        class="btn btn-template-transparent-black btn-lg">
                        Subscribe
                      </button>
                    </div>
                  </div>
                </form>
              </div>

            </p>
          </div>
        </div>
      </div>
    </section>
    <footer id="subfooter">
      <div class="container">

        <div class="col-md-5 col-sm-6">

          <h4>Recent posts</h4>

          <div class="blog-entries">

            <div class="item same-height-row clearfix">
              <div class="article same-height-always">
                <a href="../redux-vs-usereducer/index.html">

                  <img data-lazy-src="//img/posts/redux-vs-usereducer/banner.jpg" data-is-thumb="is-thumb"
                    class="img-lazy img-responsive" alt="React&#39;s useReducer vs Redux">

                </a>
              </div>
              <div class="name same-height-always">
                <h5><a href="../redux-vs-usereducer/index.html">React&#39;s useReducer vs Redux</a></h5>
              </div>
            </div>

            <div class="item same-height-row clearfix">
              <div class="article same-height-always">
                <a href="../publish-npm-package-node/index.html">

                  <img data-lazy-src="//img/posts/publish-npm-package-node/banner.jpg" data-is-thumb="is-thumb"
                    class="img-lazy img-responsive" alt="How to publish a npm package?">

                </a>
              </div>
              <div class="name same-height-always">
                <h5><a href="../publish-npm-package-node/index.html">How to publish a npm package?</a></h5>
              </div>
            </div>

            <div class="item same-height-row clearfix">
              <div class="article same-height-always">
                <a href="../react-scroll-to-item/index.html">

                  <img data-lazy-src="//img/posts/react-scroll-to-item/banner.jpg" data-is-thumb="is-thumb"
                    class="img-lazy img-responsive" alt="How to Scroll to Item in React?">

                </a>
              </div>
              <div class="name same-height-always">
                <h5><a href="../react-scroll-to-item/index.html">How to Scroll to Item in React?</a></h5>
              </div>
            </div>

          </div>

          <hr class="hidden-md hidden-lg hidden-sm">

        </div>



        <div class="col-md-5 col-md-offset-2 col-sm-6">

          <h4>About Me</h4>

          <div class="blog-entries">
            <div class="item same-height-row clearfix">
              <div class="profile same-height-always">
                <img class="img-lazy img-responsive" data-lazy-src="//img/page/profile.jpg" alt="profile">
              </div>
              <div class="name same-height-always">
                <p>
                  Hi, I'm Chris - a Midvale, Utah-based consulting software developer. Find out more <a
                    href="../about/index.html">about me</a>, <a href="../work-with-me/index.html">work with me</a>, or
                  have a look at my social media profiles below.
                </p>
              </div>
            </div>
          </div>

        </div>



      </div>

    </footer>


    <footer id="copyright">
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <ul class="info list-inline quicklinks pull-left">

              <li>© Chris Paul</li>

            </ul>
          </div>
          <div class="col-md-4">
            
          </div>
          <div class="col-md-4">
            <ul class="info list-inline quicklinks pull-right">

              <li><a aria-label="quicklinks" href="../legal/index.html">Legal Notice</a></li>

            </ul>
          </div>
        </div>
      </div>
    </footer>


  </div>




  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

  <script src="../js/script.js"></script>
</body>

</html>