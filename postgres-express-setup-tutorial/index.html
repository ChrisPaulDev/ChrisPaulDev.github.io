<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="google-site-verification" content="We9gRQmlTIjMkOPPjPWDQTXd15nWA6tBEYlxQ2cMpEg" />

  <title>
    Setup PostgreSQL with Sequelize in Express - CPaul
  </title>

  <meta name="author" content="" />

  
    <meta name="description" content="A tutorial on how to setup PostgreSQL for Express.js in a Node.js application. It comes with the database installation and how to connect it to Express with Sequelize as ORM. You can choose to use another ORM, if you want to ...">
  

  <meta name="theme-color" content="#38bb6c"/>

  <meta name="generator" content="Hugo 0.41" />

  
  <link href="https://cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">

  
  

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

  
  <link href="../css/bootstrap.default.css" rel="stylesheet" id="theme-stylesheet">
  <link href="../css/customizations.css" rel="stylesheet">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="../img/favicon/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="../img/favicon/apple-touch-icon.png" />
  <link rel="manifest" href="../img/favicon/manifest.json">
  <link rel="mask-icon" href="../img/favicon/safari-pinned-tab.svg" color="#5bbad5">

  <link rel="alternate" href="../index.xml" type="application/rss+xml" title="CPaul">

  
  
<meta itemprop="name" content="Setup PostgreSQL with Sequelize in Express">
<meta itemprop="description" content="A tutorial on how to setup PostgreSQL for Express.js in a Node.js application. It comes with the database installation and how to connect it to Express with Sequelize as ORM. You can choose to use another ORM, if you want to ...">



    <meta itemprop="image" content="https://chrispaul.dev/img/posts/postgres-express-setup-tutorial/banner_640.jpg">



<meta itemprop="keywords" content="angular,apollo,d3,graphql,growth,javascript,machine-learning,mobx,node,react,reason,redux,tooling,vue,web-development,angular,apollo,d3,graphql,growth,javascript,machine-learning,mobx,node,react,reason,redux,tooling,web-development," />


<meta itemprop="wordCount" content="2371">


  
  <meta name="keywords" content="postgresql express, postgres express, postgres sequelize, postgresql sequelize, node postgresql, node postgres">

  <meta property="og:title" content="Setup PostgreSQL with Sequelize in Express - CPaul">


  <meta property="og:description" content="A tutorial on how to setup PostgreSQL for Express.js in a Node.js application. It comes with the database installation and how to connect it to Express with Sequelize as ORM. You can choose to use another ORM, if you want to ..." />


<meta property="og:type" content="website" />
<meta property="og:url" content="https://chrispaul.dev/postgres-express-setup-tutorial/" />
<meta property="og:image" content="https://chrispaul.dev/img/posts/postgres-express-setup-tutorial/banner_640.jpg" />

  

    <meta name="news_keywords" content="postgresql express,postgres express,postgres sequelize,postgresql sequelize,node postgresql,node postgres" />

  

    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image:src" content="https://chrispaul.dev/img/posts/postgres-express-setup-tutorial/banner_640.jpg"/>



<meta name="twitter:title" content="Setup PostgreSQL with Sequelize in Express"/>
<meta name="twitter:description" content="A tutorial on how to setup PostgreSQL for Express.js in a Node.js application. It comes with the database installation and how to connect it to Express with Sequelize as ORM. You can choose to use another ORM, if you want to ..."/>
<meta name="twitter:site" content="@rwieruch"/>
<meta name="twitter:domain" content="rwieruch"/>

  

</head>


  <body>

    <div id="all">

        <header>

          <div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="../index.html">
                    <img src="../img/page/logo.svg" alt="Setup PostgreSQL with Sequelize in Express logo" class="img-lazy">
                    <span class="sr-only">Setup PostgreSQL with Sequelize in Express - go to homepage</span>
                </a>

                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                        <span class="sr-only">Toggle navigation</span>
                        <i class="fa fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                    
                    <li class="dropdown">
                        
                            <a href="../index.html">Blog</a>
                        
                    </li>
                    
                    <li class="dropdown">
                        
                            <a href="../work-with-me/index.html">Work with me</a>
                        
                    </li>
                    
                    <li class="dropdown">
                        
                            <a href="../about/index.html">About</a>
                        
                    </li>
                    
                    <li class="dropdown">
                        
                            <a style="color: #38bb6c" href="https://roadtoreact.com/">Books &amp; Courses</a>
                        
                    </li>
                    
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">

                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>

                </span>
                    </div>
                </form>

            </div>
            

        </div>
    </div>
    

</div>




        </header>

        <div class="post-share post-share-fixed post-share-desktop hidden-xs hidden-sm">
    

<a
    aria-label="icon-facebook"
    class="icon-facebook"
    href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fchrispaul.dev%2fpostgres-express-setup-tutorial%2f"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
    <i class="fa fa-facebook"></i>
</a>


<a
    aria-label="icon-twitter"
    class="icon-twitter"
    href="https://twitter.com/share?text=Setup%20PostgreSQL%20with%20Sequelize%20in%20Express%20by%20%40rwieruch%20%23NodeJs&amp;url=https%3a%2f%2fchrispaul.dev%2fpostgres-express-setup-tutorial%2f"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
    <i class="fa fa-twitter"></i>
</a>





<a
    aria-label="icon-linkedin"
    class="icon-linkedin"
    href="https://www.linkedin.com/shareArticle?mini=true&amp;title=Setup%20PostgreSQL%20with%20Sequelize%20in%20Express&amp;url=https%3a%2f%2fchrispaul.dev%2fpostgres-express-setup-tutorial%2f">
    <i class="fa fa-linkedin"></i>
</a>

</div>

<div class="visible-xs visible-sm text-center">
    <div class="post-share post-share-fixed post-share-mobile">
        

<a
    aria-label="icon-facebook"
    class="icon-facebook"
    href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fchrispaul.dev%2fpostgres-express-setup-tutorial%2f"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
    <i class="fa fa-facebook"></i>
</a>


<a
    aria-label="icon-twitter"
    class="icon-twitter"
    href="https://twitter.com/share?text=Setup%20PostgreSQL%20with%20Sequelize%20in%20Express%20by%20%40rwieruch%20%23NodeJs&amp;url=https%3a%2f%2fchrispaul.dev%2fpostgres-express-setup-tutorial%2f"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
    <i class="fa fa-twitter"></i>
</a>





<a
    aria-label="icon-linkedin"
    class="icon-linkedin"
    href="https://www.linkedin.com/shareArticle?mini=true&amp;title=Setup%20PostgreSQL%20with%20Sequelize%20in%20Express&amp;url=https%3a%2f%2fchrispaul.dev%2fpostgres-express-setup-tutorial%2f">
    <i class="fa fa-linkedin"></i>
</a>

    </div>
</div>

        

        <div class="hidden-xs">
            

<section class="bar background-image-fixed-2 no-mb color-white text-center">
    <div class="dark-mask"></div>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h3 class="lead">Never miss an article about web development, JavaScript and self-growth.</h3>
                <h2 class="text-uppercase newsletter">Take Part</h2>
            </div>

            <div class="col-md-12">
                <p class="text-center">
                    



<div id="mc_embed_signup">
    <form
        action="https://www.getrevue.co/profile/rwieruch/add_subscriber"
        method="post"
        id="revue-form"
        name="revue-form"
        target="_blank">
        <div id="mc_embed_signup_scroll">
            <input
                class="email"
                placeholder="email address"
                type="email"
                name="member[email]"
                id="member_email"
            >
            <div>
                <button
                    type="submit"
                    value="Subscribe"
                    name="member[subscribe]"
                    id="member_submit"
                    class="btn btn-template-transparent-black btn-lg"
                >
                    Subscribe
                </button>
            </div>
        </div>
    </form>
</div>

                </p>
            </div>
        </div>
    </div>
</section>



        </div>

        <div id="content">
            <div class="container">

                <div class="row">

                    <article
                        class="col-md-8 col-md-offset-2"
                        id="blog-post"
                        itemprop="blogPosts"
                        itemscope itemtype="http://schema.org/BlogPosting">

                        <div id="post-content" itemprop="articleBody">

                            <header>
                                <h1 itemprop="name headline">Setup PostgreSQL with Sequelize in Express</h1>
                            </header>

                            <div class="text-center">
                                
    <a target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/rwieruch" class="facebook-button-follow">
         <i class="fa fa-facebook"></i>Follow
    </a>


                                &nbsp;
                                

                                &nbsp;
                                
  <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/intent/follow?screen_name=rwieruch" class="generic-button-follow">
    <img src="https://img.shields.io/twitter/follow/rwieruch.svg?style=social&amp;logo=twitter&amp;label=Follow" alt="Follow on Twitter">
  </a>


                                &nbsp;
                                
                            </div>

                            <p class="text-muted text-uppercase mb-small text-center">
    <span itemprop="author publisher">
        
    </span>

    
        <time datetime="2019-02-10" itemprop="datePublished">
            February 10, 2019
        </time>
    

    
        <span class="hidden-xs hidden-sm"> - <a
            target="_blank"
            rel="noopener noreferrer"
            href="https://github.com/rwieruch/blog_chriswieruch_content/blob/master/postgres-express-setup-tutorial.md">
                Edit this Post on GitHub
            </a>
        </span>
    
</p>

                            

<div>
  

</div>

<div class="post-image-primary">
    <div class="pinterest-pinner-wrapper" itemscope itemtype="http://schema.org/ImageObject">
        <div class="pinterest-pinner">
            <a
                data-pin-do="buttonPin"
                data-pin-save="true"
                data-pin-tall="true"
                href="https://www.pinterest.com/pin/create/button/?url=https%3a%2f%2fchrispaul.dev%2fpostgres-express-setup-tutorial%2f&amp;media=https://chrispaul.dev/img%2fposts%2fpostgres-express-setup-tutorial%2fbanner.jpg&amp;description=">
            </a>
        </div>

        <img
            class="img-lazy img-responsive"
            data-lazy-src="/src="/img/posts/postgres-express-setup-tutorial/banner.jpg"
            data-is-src-set="is-src-set"
            alt="postgres express"
            itemprop="image"
        />
    </div>
</div>


<div class="read-before">
    <p>This tutorial is part 4 of 4 in this series.</p>
    <div>Part 1: <a href="../minimal-node-js-babel-setup/index.html" itemprop="url">The minimal Node.js with Babel Setup</a></div>
    <div>Part 2: <a href="../node-js-express-tutorial/index.html" itemprop="url">How to setup Express.js in Node.js</a></div>
    <div>Part 3: <a href="../node-express-server-rest-api/index.html" itemprop="url">How to create a REST API with Express.js in Node.js</a></div>
</div>

<p>Eventually every Node.js project running with Express.js as web application will need a database. Since most server applications are stateless, in order to scale them horizontally with multiple server instances, there is no way to persist data without another third-party (e.g. database). That&rsquo;s why it is fine to develop an initial application with sample data, where it is possible to read and write data without a database, but at some point you want to introduce a database to manage the data. The database would keep the data persistence across servers or even though one of your servers is not running.</p>

<p>The following sections will show you how to connect your Express application to a PostgreSQL database with Sequelize as ORM. If you haven&rsquo;t installed PostgreSQL on your machine yet, head over to this <a href="../postgres-sql-macos-setup/index.html">guide on how to install PostgreSQL for your machine</a>. It comes with a MacOS and a Windows setup guide. Afterward come back to the next section of this guide to learn more about using PostgreSQL in Express.</p>

<h2 class="chapter-header" id="postgres-sequelize-express-installation">PostgreSQL with Sequelize in Express Installation</h2>

<p>To connect PostgreSQL to your Express application, we will use an <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Object-relational_mapping">ORM</a> to convert information from the database to a JavaScript application without SQL statements. ORM is short for Object Related Mapping, a technique that programmers use to convert data among incompatible types. More specifically, ORMs mimic the actual database so a developer can operate within a programming language (e.g. JavaScript) without using a database query language (e.g. SQL) to interact with the database. The downside is the extra code abstraction, that&rsquo;s why there are developers who advocate against an ORM, but this shouldn&rsquo;t be a problem for many JavaScript applications without complex database queries.</p>

<p>For this application, we&rsquo;ll use <a target="_blank" rel="noopener noreferrer" href="https://github.com/sequelize/sequelize">Sequelize</a> as ORM, as it supports multiple dialects, one of which is PostgreSQL. Sequelize provides a comfortable API to work with PostgreSQL databases from setup to execution, but there are many ORMs (e.g. TypeORM, Objection.js) to choose from for a Node.js application if you want to expand your toolbelt.</p>

<p>Before you can implement database usage in your Node.js application, install sequelize and pg, which is the postgres client for Node.js, on the command line for your Node.js application:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #06b6ef">npm</span> <span style="color: #06b6ef">install</span> <span style="color: #06b6ef">pg</span> <span style="color: #06b6ef">sequelize</span> <span style="color: #5bc4bf">--</span><span style="color: #06b6ef">save</span>
</code></pre></div>


<p>After you have installed both libraries as node packages, we&rsquo;ll plan and implement our database entities with models and schemas.</p>

<h2 class="chapter-header" id="database-schema-model-entity">Database Models, Schemas and Entities</h2>

<p>The following case implements a database for your application with two database entities: User and Message. Often a database entity is called database schema or database model as well. You can distinguish them the following way:</p>

<ul>
<li><p>Database Schema: A database schema is close to the implementation details and tells the database (and developer) how an entity (e.g. user entity) looks like in a database table whereas every instance of an entity is represented by a table row. For instance, the schema defines fields (e.g. username) and relationships (e.g. a user has messages) of an entity. Each field is represented as a column in the database. Basically a schema is the blueprint for an entity.</p></li>

<li><p>Database Model: A database model is a more abstract perspective on the schema. It offers the developer a conceptual framework on what models are available and how to use models as interfaces to connect an application to a database to interact with the entities. Often models are implemented with ORMs.</p></li>

<li><p>Database Entity: A database entity is actual instance of a stored item in the database that is created with a database schema. Each database entity uses a row in the database table whereas each field of the entity is defined by a column. A relationship to another entity is often described with an identifier of the other entity and ends up as field in the database as well.</p></li>
</ul>

<p>Before diving into the code for your application, it&rsquo;s always a good idea to map the relationships between entities and how to handle the data that must pass between them. A <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Unified_Modeling_Language">UML (Unified Modeling Language)</a> diagram is a straightforward way to express relationships between entities in a way that can be referenced quickly as you type them out. This is useful for the person laying the groundwork for an application as well as anyone who wants to additional information in the database schema to it. An UML diagram could appear as such:</p>

<div class="row">
  <div class="col-xs-8 col-centered">
    <div class="post-image-primary">
    <div class="pinterest-pinner-wrapper" itemscope itemtype="http://schema.org/ImageObject">
        <div class="pinterest-pinner">
            <a
                data-pin-do="buttonPin"
                data-pin-save="true"
                data-pin-tall="true"
                href="https://www.pinterest.com/pin/create/button/?url=https%3a%2f%2fchrispaul.dev%2fpostgres-express-setup-tutorial%2f&amp;media=https://chrispaul.dev/img%2fposts%2fpostgres-express-setup-tutorial%2fuml.png&amp;description=">
            </a>
        </div>

        <img
            class="img-lazy img-responsive"
            data-lazy-src="/src="/img/posts/postgres-express-setup-tutorial/uml.png"
            data-is-src-set="is-src-set"
            alt="uml diagram"
            itemprop="image"
        />
    </div>
</div>

  </div>
</div>

<p>The User and Message entities have fields that define both their identity within the construct and their relationships to each other. Let&rsquo;s get back to our Express application. Usually, there is a folder in your Node.js application called <em>src/models/</em> that contains files for each model in your database (e.g. <em>src/models/user.js</em> and <em>src/models/message.js</em>). Each model is implemented as a schema that defines the fields and relationships. There is often also a file (e.g. <em>src/models/index.js</em>) that combines all models and exports all them as database interface to the Express application. We can start with the two models in the <em>src/models/[modelname].js</em> files, which could be expressed like the following without covering all the fields from the UML diagram for the sake of keeping it simple. First, the user model in the <em>src/models/user.js</em> file:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">const</span> <span style="color: #06b6ef">user</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">sequelize</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">DataTypes</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">const</span> <span style="color: #06b6ef">User</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">sequelize</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">define</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;user&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span>
    <span style="color: #06b6ef">username</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span>
      <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">DataTypes</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">STRING</span><span style="color: #e7e9db">,</span>
      <span style="color: #06b6ef">unique</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">true</span><span style="color: #e7e9db">,</span>
    <span style="color: #e7e9db">},</span>
  <span style="color: #e7e9db">});</span>

  <span style="color: #815ba4">return</span> <span style="color: #06b6ef">User</span><span style="color: #e7e9db">;</span>
<span style="color: #e7e9db">};</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">user</span><span style="color: #e7e9db">;</span>
</code></pre></div>


<p>As you can see, the user has a username field which is represented as string type. Also we don&rsquo;t want to have duplicated usernames in our database, hence we add the unique attribute to the field. Next, we may want to associate the user with messages. Since a user can have many messages, we use a 1 to N association:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">const</span> <span style="color: #06b6ef">user</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">sequelize</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">DataTypes</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">const</span> <span style="color: #06b6ef">User</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">sequelize</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">define</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;user&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span>
    <span style="color: #06b6ef">username</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span>
      <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">DataTypes</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">STRING</span><span style="color: #e7e9db">,</span>
      <span style="color: #06b6ef">unique</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">true</span><span style="color: #e7e9db">,</span>
    <span style="color: #e7e9db">},</span>
  <span style="color: #e7e9db">});</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">User</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">associate</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">models</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">User</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">hasMany</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">models</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Message</span><span style="color: #e7e9db">);</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">};</span>
</span>
  <span style="color: #815ba4">return</span> <span style="color: #06b6ef">User</span><span style="color: #e7e9db">;</span>
<span style="color: #e7e9db">};</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">user</span><span style="color: #e7e9db">;</span>
</code></pre></div>


<p>We can also implement additional methods on our model. Let&rsquo;s assume our user entity ends up with an email field in the future. Then we could add a method that finds a user by their an abstract &ldquo;login&rdquo; term, which is the username or email in the end, in the database. That&rsquo;s helpful when users are able to login to your application via username <em>or</em> email adress. You can implement it as method for your model. After, this method would be available next to all the other build-in methods that come from your chosen ORM:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">const</span> <span style="color: #06b6ef">user</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">sequelize</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">DataTypes</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">const</span> <span style="color: #06b6ef">User</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">sequelize</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">define</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;user&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span>
    <span style="color: #06b6ef">username</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span>
      <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">DataTypes</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">STRING</span><span style="color: #e7e9db">,</span>
      <span style="color: #06b6ef">unique</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">true</span><span style="color: #e7e9db">,</span>
    <span style="color: #e7e9db">},</span>
  <span style="color: #e7e9db">});</span>

  <span style="color: #06b6ef">User</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">associate</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">models</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
    <span style="color: #06b6ef">User</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">hasMany</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">models</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Message</span><span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">};</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">User</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">findByLogin</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">async</span> <span style="color: #06b6ef">login</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">let</span> <span style="color: #06b6ef">user</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">await</span> <span style="color: #06b6ef">User</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">findOne</span><span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">where</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">username</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">login</span> <span style="color: #e7e9db">},</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #5bc4bf">!</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">user</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">await</span> <span style="color: #06b6ef">User</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">findOne</span><span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">        <span style="color: #06b6ef">where</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">email</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">login</span> <span style="color: #e7e9db">},</span>
</span><span style="background-color: #4f424c">      <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">}</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">return</span> <span style="color: #06b6ef">user</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">};</span>
</span>
  <span style="color: #815ba4">return</span> <span style="color: #06b6ef">User</span><span style="color: #e7e9db">;</span>
<span style="color: #e7e9db">};</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">user</span><span style="color: #e7e9db">;</span>
</code></pre></div>


<p>The message model looks quite similar, even though we don&rsquo;t add any custom methods to it and the fields are pretty straightforward with only a text field and another message to user association:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">const</span> <span style="color: #06b6ef">message</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">sequelize</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">DataTypes</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">const</span> <span style="color: #06b6ef">Message</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">sequelize</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">define</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;message&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span>
    <span style="color: #06b6ef">text</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">DataTypes</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">STRING</span><span style="color: #e7e9db">,</span>
  <span style="color: #e7e9db">});</span>

  <span style="color: #06b6ef">Message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">associate</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">models</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
    <span style="color: #06b6ef">Message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">belongsTo</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">models</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">User</span><span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">};</span>

  <span style="color: #815ba4">return</span> <span style="color: #06b6ef">Message</span><span style="color: #e7e9db">;</span>
<span style="color: #e7e9db">};</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">message</span><span style="color: #e7e9db">;</span>
</code></pre></div>


<p>Now, in case a user is deleted, we may want to perform a so called cascade delete for all messages in relation to the user. That&rsquo;s why you can extend schemas with a CASCADE flag. In this case, we add the flag to our user schema to remove all messages of this user on its deletion:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">const</span> <span style="color: #06b6ef">user</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">sequelize</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">DataTypes</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">const</span> <span style="color: #06b6ef">User</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">sequelize</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">define</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;user&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span>
    <span style="color: #06b6ef">username</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span>
      <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">DataTypes</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">STRING</span><span style="color: #e7e9db">,</span>
      <span style="color: #06b6ef">unique</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">true</span><span style="color: #e7e9db">,</span>
    <span style="color: #e7e9db">},</span>
  <span style="color: #e7e9db">});</span>

  <span style="color: #06b6ef">User</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">associate</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">models</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #06b6ef">User</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">hasMany</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">models</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Message</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">onDelete</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;CASCADE&#39;</span> <span style="color: #e7e9db">});</span>
</span>  <span style="color: #e7e9db">};</span>

  <span style="color: #06b6ef">User</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">findByLogin</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">async</span> <span style="color: #06b6ef">login</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">let</span> <span style="color: #06b6ef">user</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">await</span> <span style="color: #06b6ef">User</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">findOne</span><span style="color: #e7e9db">({</span>
      <span style="color: #06b6ef">where</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">username</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">login</span> <span style="color: #e7e9db">},</span>
    <span style="color: #e7e9db">});</span>

    <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #5bc4bf">!</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
      <span style="color: #06b6ef">user</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">await</span> <span style="color: #06b6ef">User</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">findOne</span><span style="color: #e7e9db">({</span>
        <span style="color: #06b6ef">where</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">email</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">login</span> <span style="color: #e7e9db">},</span>
      <span style="color: #e7e9db">});</span>
    <span style="color: #e7e9db">}</span>

    <span style="color: #815ba4">return</span> <span style="color: #06b6ef">user</span><span style="color: #e7e9db">;</span>
  <span style="color: #e7e9db">};</span>

  <span style="color: #815ba4">return</span> <span style="color: #06b6ef">User</span><span style="color: #e7e9db">;</span>
<span style="color: #e7e9db">};</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">user</span><span style="color: #e7e9db">;</span>
</code></pre></div>


<p>Sequelize is used to define the model with its content (composed of <code>DataTypes</code> and optional configuration). Furthermore, additional methods can be added to shape the database interface and the associate property is used to create relations between models. An user can have multiple messages, but a Message belongs to only one user. You can dive deeper into these concepts in the <a target="_blank" rel="noopener noreferrer" href="http://docs.sequelizejs.com/">Sequelize documentation</a>. Next, in your <em>src/models/index.js</em> file, import and combine those models and resolve their associations using the Sequelize API:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">Sequelize</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;sequelize&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">sequelize</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">new</span> <span style="color: #06b6ef">Sequelize</span><span style="color: #e7e9db">(</span>
  <span style="color: #06b6ef">process</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">env</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">DATABASE</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">process</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">env</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">DATABASE_USER</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">process</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">env</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">DATABASE_PASSWORD</span><span style="color: #e7e9db">,</span>
  <span style="color: #e7e9db">{</span>
    <span style="color: #06b6ef">dialect</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;postgres&#39;</span><span style="color: #e7e9db">,</span>
  <span style="color: #e7e9db">},</span>
<span style="color: #e7e9db">);</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">models</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">User</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">sequelize</span><span style="color: #e7e9db">.</span><span style="color: #815ba4">import</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;./user&#39;</span><span style="color: #e7e9db">),</span>
  <span style="color: #06b6ef">Message</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">sequelize</span><span style="color: #e7e9db">.</span><span style="color: #815ba4">import</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;./message&#39;</span><span style="color: #e7e9db">),</span>
<span style="color: #e7e9db">};</span>

<span style="color: #e7e9db">Object.</span><span style="color: #06b6ef">keys</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">models</span><span style="color: #e7e9db">).</span><span style="color: #06b6ef">forEach</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">key</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;associate&#39;</span> <span style="color: #815ba4">in</span> <span style="color: #06b6ef">models</span><span style="color: #e7e9db">[</span><span style="color: #06b6ef">key</span><span style="color: #e7e9db">])</span> <span style="color: #e7e9db">{</span>
    <span style="color: #06b6ef">models</span><span style="color: #e7e9db">[</span><span style="color: #06b6ef">key</span><span style="color: #e7e9db">].</span><span style="color: #06b6ef">associate</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">models</span><span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">});</span>

<span style="color: #815ba4">export</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">sequelize</span> <span style="color: #e7e9db">};</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">models</span><span style="color: #e7e9db">;</span>
</code></pre></div>


<p>At the top of the file, you create a Sequelize instance by passing mandatory arguments (database name, database superuser, database superuser&rsquo;s password and additional configuration) to the constructor. For instance, you need to tell Sequelize the dialect of your database, which is postgres rather than mysql or sqlite. In our case, we are using environment variables, but you can pass these arguments as strings in the source code too. For example, the environment variables could look like the following in an <em>.env</em> file:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #06b6ef">DATABASE</span><span style="color: #5bc4bf">=</span><span style="color: #06b6ef">mydatabase</span>
<span style="color: #06b6ef">DATABASE_USER</span><span style="color: #5bc4bf">=</span><span style="color: #06b6ef">postgres</span>
<span style="color: #06b6ef">DATABASE_PASSWORD</span><span style="color: #5bc4bf">=</span><span style="color: #06b6ef">postgres</span>
</code></pre></div>


<p>Note: If you don&rsquo;t have a super user or dedicated database for your application yet, head over to the PostgreSQL setup guide to create them. You only have to create a superuser once, but every of your applications should have its own database.</p>

<p>Lastly, use the created Sequelize instance in your Express application. It connects to the database asynchronously and once this is done you can start your Express application.</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">express</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;express&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #776e71">// Express related imports</span>
<span style="color: #776e71">// other node package imports</span>
<span style="color: #e7e9db">...</span>

<span style="color: #815ba4">import</span> <span style="color: #06b6ef">models</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">sequelize</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./models&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">app</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">express</span><span style="color: #e7e9db">();</span>

<span style="color: #776e71">// additional Express stuff: middleware, routes, ...</span>
<span style="color: #e7e9db">...</span>

<span style="color: #06b6ef">sequelize</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">sync</span><span style="color: #e7e9db">().</span><span style="color: #06b6ef">then</span><span style="color: #e7e9db">(()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">app</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">listen</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">process</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">env</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">PORT</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
    <span style="color: #06b6ef">console</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">log</span><span style="color: #e7e9db">(</span><span style="color: #48b685">`Example app listening on port </span><span style="color: #f99b15">${</span><span style="color: #06b6ef">process</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">env</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">PORT</span><span style="color: #f99b15">}</span><span style="color: #48b685">!`</span><span style="color: #e7e9db">),</span>
  <span style="color: #e7e9db">});</span>
<span style="color: #e7e9db">});</span>
</code></pre></div>


<p>If you want to re-initialize your database on every Express server start, you can add a condition to your sync method:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">eraseDatabaseOnSync</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">true</span><span style="color: #e7e9db">;</span>
</span>
<span style="background-color: #4f424c"><span style="color: #06b6ef">sequelize</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">sync</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">force</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">eraseDatabaseOnSync</span> <span style="color: #e7e9db">}).</span><span style="color: #06b6ef">then</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">async</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span>  <span style="color: #06b6ef">app</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">listen</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">process</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">env</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">PORT</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span>
    <span style="color: #06b6ef">console</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">log</span><span style="color: #e7e9db">(</span><span style="color: #48b685">`Example app listening on port </span><span style="color: #f99b15">${</span><span style="color: #06b6ef">process</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">env</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">PORT</span><span style="color: #f99b15">}</span><span style="color: #48b685">!`</span><span style="color: #e7e9db">),</span>
  <span style="color: #e7e9db">);</span>
<span style="color: #e7e9db">});</span>
</code></pre></div>


<p>That&rsquo;s it for defining your database models for your Express application and for connecting everything to the database once you start your application. Once you start your application again, the command line results will show how the tables in your database were created.</p>

<h2 class="chapter-header" id="postgresql-seeding-database">How to seed a PostgreSQL Database?</h2>

<p>Last but not least, you may want to seed your PostgreSQL database with initial data to start with. Otherwise, you will always start with a blank slate when purging your database (e.g. eraseDatabaseOnSync) with every application start.</p>

<p>In our case, we have user and message entities in our database. Each message is associated to a user. Now, every time you start your application, your database is connected to your physical database. That&rsquo;s where you decided to purge all your data with a boolean flag in your source code. Also this could be the place for seeding your database with initial data.</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #e7e9db">...</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">eraseDatabaseOnSync</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">true</span><span style="color: #e7e9db">;</span>

<span style="color: #06b6ef">sequelize</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">sync</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">force</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">eraseDatabaseOnSync</span> <span style="color: #e7e9db">}).</span><span style="color: #06b6ef">then</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">async</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">  <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">eraseDatabaseOnSync</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">createUsersWithMessages</span><span style="color: #e7e9db">();</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">}</span>
</span>
  <span style="color: #06b6ef">app</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">listen</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">process</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">env</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">PORT</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span>
    <span style="color: #06b6ef">console</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">log</span><span style="color: #e7e9db">(</span><span style="color: #48b685">`Example app listening on port </span><span style="color: #f99b15">${</span><span style="color: #06b6ef">process</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">env</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">PORT</span><span style="color: #f99b15">}</span><span style="color: #48b685">!`</span><span style="color: #e7e9db">),</span>
  <span style="color: #e7e9db">);</span>
<span style="color: #e7e9db">});</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">createUsersWithMessages</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">async</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">...</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">};</span>
</span></code></pre></div>


<p>The <code>createUsersWithMessages()</code> function will be used to seed our database. The seeding happens asynchronously, because creating data in the database is not a synchronous task. Let&rsquo;s see how we can create our first user in PostgreSQL with Sequelize:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #e7e9db">...</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">createUsersWithMessages</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">async</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">await</span> <span style="color: #06b6ef">models</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">User</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">create</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">username</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;rwieruch&#39;</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">},</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">);</span>
</span><span style="color: #e7e9db">};</span>
</code></pre></div>


<p>Each of our user entities has only a username as property. But what about the message(s) for this user? We can create them in one function with the user:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #e7e9db">...</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">createUsersWithMessages</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">async</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">await</span> <span style="color: #06b6ef">models</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">User</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">create</span><span style="color: #e7e9db">(</span>
    <span style="color: #e7e9db">{</span>
      <span style="color: #06b6ef">username</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;rwieruch&#39;</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">      <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">[</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">          <span style="color: #06b6ef">text</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;Published the Road to learn React&#39;</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">},</span>
</span><span style="background-color: #4f424c">      <span style="color: #e7e9db">],</span>
</span>    <span style="color: #e7e9db">},</span>
<span style="background-color: #4f424c">    <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">include</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">[</span><span style="color: #06b6ef">models</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Message</span><span style="color: #e7e9db">],</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">},</span>
</span>  <span style="color: #e7e9db">);</span>
<span style="color: #e7e9db">};</span>
</code></pre></div>


<p>We can say that our user entity should be created with message entities. Since a message has only a text, we can pass these texts as array to the user creation. Each message entity will then be associated to a user with a user identifier. Let&rsquo;s create a second user, but this time with two messages:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #e7e9db">...</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">createUsersWithMessages</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">async</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">await</span> <span style="color: #06b6ef">models</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">User</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">create</span><span style="color: #e7e9db">(</span>
    <span style="color: #e7e9db">{</span>
      <span style="color: #06b6ef">username</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;rwieruch&#39;</span><span style="color: #e7e9db">,</span>
      <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">[</span>
        <span style="color: #e7e9db">{</span>
          <span style="color: #06b6ef">text</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;Published the Road to learn React&#39;</span><span style="color: #e7e9db">,</span>
        <span style="color: #e7e9db">},</span>
      <span style="color: #e7e9db">],</span>
    <span style="color: #e7e9db">},</span>
    <span style="color: #e7e9db">{</span>
      <span style="color: #06b6ef">include</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">[</span><span style="color: #06b6ef">models</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Message</span><span style="color: #e7e9db">],</span>
    <span style="color: #e7e9db">},</span>
  <span style="color: #e7e9db">);</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">await</span> <span style="color: #06b6ef">models</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">User</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">create</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">username</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;ddavids&#39;</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">[</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">          <span style="color: #06b6ef">text</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;Happy to release ...&#39;</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">},</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">          <span style="color: #06b6ef">text</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;Published a complete ...&#39;</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">},</span>
</span><span style="background-color: #4f424c">      <span style="color: #e7e9db">],</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">},</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">include</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">[</span><span style="color: #06b6ef">models</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Message</span><span style="color: #e7e9db">],</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">},</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">);</span>
</span><span style="color: #e7e9db">};</span>
</code></pre></div>


<p>That&rsquo;s it. In our case, we have used our models to create users with associated messages. It happens when the application starts and we want to start with a clean slate; it&rsquo;s called database seeding. However, the API of our models is used the same way later in our application to create users and messages. In the end, we have set up PostgreSQL in a Node.js with Express application. What&rsquo;s missing is connecting the database to Express for enabling users to operate on the database with the API rather than operating on sample data.</p>

<h3 id="exercises">Exercises:</h3>

<ul>
<li>Confirm your <a target="_blank" rel="noopener noreferrer" href="https://github.com/rwieruch/node-express-postgresql-server">source code</a>, but keep in mind that we didn&rsquo;t connect the API to PostgreSQL in this section yet.</li>
<li>Explore:

<ul>
<li>What else could be used instead of Sequelize as ORM alternative?</li>
<li>What else could be used instead of PostgreSQL as database alternative?</li>
<li>Compare your source code with the source code from the <a target="_blank" rel="noopener noreferrer" href="https://github.com/rwieruch/node-express-mongodb-server">MongoDB + Mongoose alternative</a>.</li>
</ul></li>
<li>Ask yourself:

<ul>
<li>When would you seed an application in a production ready environment?</li>
<li>Are ORMs like Sequelize essential to connect your application to a database?</li>
</ul></li>
</ul>

<div class="read-before">
    <p>This tutorial is part 4 of 5 in this series.</p>
    <div>Part 1: <a href="../minimal-node-js-babel-setup/index.html" itemprop="url">The minimal Node.js with Babel Setup</a></div>
    <div>Part 2: <a href="../node-js-express-tutorial/index.html" itemprop="url">How to setup Express.js in Node.js</a></div>
    <div>Part 3: <a href="../node-express-server-rest-api/index.html" itemprop="url">How to create a REST API with Express.js in Node.js</a></div>
    <div>Part 5: <a href="../postgresql-express-node-rest-api/index.html" itemprop="url">Creating a REST API with Express.js and PostgreSQL</a></div>
</div>


                            
<div class="feedback-and-share text-center">
    <hr>
    
    <p class="lead">
        I would like to hear your thoughts :-) Find me on <a target="_blank" rel="noopener noreferrer" aria-label="twitter" href="https://twitter.com/rwieruch"><i class="fa fa-twitter"></i>Twitter</a> and <a target="_blank" aria-label="facebook" href="https://www.facebook.com/rwieruch/"><i class="fa fa-facebook"></i>Facebook</a>
    </p>
    
    
        <p class="lead">
            Did the article help you? Share it with your friends on social media <i class="fa fa-arrow-left"></i>, support me as my <a target="_blank" rel="noopener noreferrer" aria-label="patreon" href="https://www.patreon.com/rwieruch"><i class="fa fa-paw"></i>Patron</a>, and become a full-stack developer with my books <i class="fa fa-arrow-down"></i>
        </p>
    
</div>


                            
                                <div class="box-inline col-md-12">
    <div class="col-md-12 text-center">
        <h2 class="newsletter">The Road to learn React</h2>
        
            <div class="col-md-4">
                <img class="img-lazy img-responsive" data-lazy-src="//img/page/cover.png">
            </div>
        
        <p class="lead">
            Build a Hacker News App along the way. No setup configuration. No tooling. No Redux. Plain React in 200+ pages of learning material. Learn React like <strong>50.000+ readers</strong>.
        </p>
        <a
            class="btn btn-template-main"
            href="https://roadtoreact.com"
            target="_blank"
            rel="noopener noreferrer"
        >
            Get the Book for free <i class="fa fa-chevron-right"></i>
        </a>
        
            <div>
                <a
                    href="https://amzn.to/2QY2ONp"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    Get it from Amazon
                </a>
            </div>
        
    </div>
</div>
                            
                        </div>

                        
                        
                        <div id="comments">
                            <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'rwieruch';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                        </div>
                        

                    </article>
                    

                </div>
                

            </div>
            
        </div>
        

        

<section class="bar background-image-fixed-2 no-mb color-white text-center">
    <div class="dark-mask"></div>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h3 class="lead">Never miss an article about web development, JavaScript and self-growth.</h3>
                <h2 class="text-uppercase">Take Part</h2>
            </div>

            <div class="col-md-12 text-center">
                
                    <h3 class="lead"><i class="fa fa-check"></i> Join 30.000&#43; Developers</h3>
                
                    <h3 class="lead"><i class="fa fa-check"></i> Learn Web Development with JavaScript</h3>
                
                    <h3 class="lead"><i class="fa fa-check"></i> Tips and Tricks</h3>
                
                    <h3 class="lead"><i class="fa fa-check"></i> Access Tutorials, eBooks and Courses</h3>
                
                    <h3 class="lead"><i class="fa fa-check"></i> Personal Development as a Software Engineer</h3>
                
            </div>
            <div class="col-md-12">
                <p class="text-center">
                    



<div id="mc_embed_signup">
    <form
        action="https://www.getrevue.co/profile/rwieruch/add_subscriber"
        method="post"
        id="revue-form"
        name="revue-form"
        target="_blank">
        <div id="mc_embed_signup_scroll">
            <input
                class="email"
                placeholder="email address"
                type="email"
                name="member[email]"
                id="member_email"
            >
            <div>
                <button
                    type="submit"
                    value="Subscribe"
                    name="member[subscribe]"
                    id="member_submit"
                    class="btn btn-template-transparent-black btn-lg"
                >
                    Subscribe
                </button>
            </div>
        </div>
    </form>
</div>

                </p>
            </div>
        </div>
    </div>
</section>




        <footer id="subfooter">
    <div class="container">

        <div class="col-md-5 col-sm-6">

            <h4>Recent posts</h4>

            <div class="blog-entries">
                
                <div class="item same-height-row clearfix">
                    <div class="article same-height-always">
                        <a href="../redux-vs-usereducer/index.html">
                          
                            <img
                                data-lazy-src="//img/posts/redux-vs-usereducer/banner.jpg"
                                data-is-thumb="is-thumb"
                                class="img-lazy img-responsive"
                                alt="React&#39;s useReducer vs Redux"
                            >
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="../redux-vs-usereducer/index.html">React&#39;s useReducer vs Redux</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="article same-height-always">
                        <a href="../publish-npm-package-node/index.html">
                          
                            <img
                                data-lazy-src="//img/posts/publish-npm-package-node/banner.jpg"
                                data-is-thumb="is-thumb"
                                class="img-lazy img-responsive"
                                alt="How to publish a npm package?"
                            >
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="../publish-npm-package-node/index.html">How to publish a npm package?</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="article same-height-always">
                        <a href="../react-scroll-to-item/index.html">
                          
                            <img
                                data-lazy-src="//img/posts/react-scroll-to-item/banner.jpg"
                                data-is-thumb="is-thumb"
                                class="img-lazy img-responsive"
                                alt="How to Scroll to Item in React?"
                            >
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="../react-scroll-to-item/index.html">How to Scroll to Item in React?</a></h5>
                    </div>
                </div>
                
            </div>

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        

        
        <div class="col-md-5 col-md-offset-2 col-sm-6">

            <h4>About Me</h4>

            <div class="blog-entries">
                <div class="item same-height-row clearfix">
                    <div class="profile same-height-always">
                        <img
                            class="img-lazy img-responsive"
                            data-lazy-src="//img/page/profile.jpg"
                            alt="profile"
                        >
                    </div>
                    <div class="name same-height-always">
                        <p>
                            Hi, I'm Chris - a German and Remote/Berlin based consulting software engineer. Find out more <a href="../about/index.html">about me</a>, <a href="../work-with-me/index.html">work with me</a>, or have a look at my social media profiles below.
                        </p>
                    </div>
                </div>
            </div>

        </div>
        
        

    </div>
    
</footer>






        <footer id="copyright">
  <div class="container">
    <div class="row">
      <div class="col-md-4">
        <ul class="info list-inline quicklinks pull-left">
          
            <li>© Chris Paul</li>
          
        </ul>
      </div>
      <div class="col-md-4">
        <ul class="list-inline footer-social-buttons text-center">
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.twitter.com/rwieruch"><i class="fa fa-twitter"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.github.com/rwieruch"><i class="fa fa-github"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.linkedin.com/in/chris-wieruch-971933a6"><i class="fa fa-linkedin"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.producthunt.com/@rwieruch"><i class="fa fa-product-hunt"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.patreon.com/rwieruch"><i class="fa fa-paw"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.paypal.me/rwieruch"><i class="fa fa-paypal"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.facebook.com/rwieruch"><i class="fa fa-facebook"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.instagram.com/rwieruch/"><i class="fa fa-instagram"></i></a></li>
          
        </ul>
      </div>
      <div class="col-md-4">
        <ul class="info list-inline quicklinks pull-right">
          
            <li><a aria-label="quicklinks" href="../legal/index.html">Legal Notice</a></li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>


    </div>
    

    
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-65599459-2', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>









<script src="../js/script.js"></script>



  </body>
</html>
