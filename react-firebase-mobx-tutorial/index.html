<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <title>
    How to use MobX in React Firebase - CPaul
  </title>

  <meta name="author" content="" />

  
    <meta name="description" content="The tutorial shows you how to migrate a React with Firebase application, which uses only React&#39;s local state, to MobX for its state management. Also React&#39;s Context API is replaced with MobX ...">
  

  <meta name="theme-color" content="#38bb6c"/>

  <meta name="generator" content="Hugo 0.41" />

  
  <link href="https://cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">

  
  

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

  
  <link href="../css/bootstrap.default.css" rel="stylesheet" id="theme-stylesheet">
  <link href="../css/customizations.css" rel="stylesheet">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="../img/favicon/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="../img/favicon/apple-touch-icon.png" />
  <link rel="manifest" href="../img/favicon/manifest.json">
  <link rel="mask-icon" href="../img/favicon/safari-pinned-tab.svg" color="#5bbad5">

  <link rel="alternate" href="../index.xml" type="application/rss+xml" title="CPaul">

  
  
<meta itemprop="name" content="How to use MobX in React Firebase">
<meta itemprop="description" content="The tutorial shows you how to migrate a React with Firebase application, which uses only React&#39;s local state, to MobX for its state management. Also React&#39;s Context API is replaced with MobX ...">



    <meta itemprop="image" content="https://chrispaul.dev/img/posts/react-firebase-mobx-tutorial/banner_640.jpg">



<meta itemprop="keywords" content="angular,apollo,d3,graphql,growth,javascript,machine-learning,mobx,node,react,reason,redux,tooling,vue,web-development,angular,apollo,d3,graphql,growth,javascript,machine-learning,mobx,node,react,reason,redux,tooling,web-development," />


<meta itemprop="wordCount" content="3273">


  
  <meta name="keywords" content="react firebase mobx tutorial">

  <meta property="og:title" content="How to use MobX in React Firebase - CPaul">


  <meta property="og:description" content="The tutorial shows you how to migrate a React with Firebase application, which uses only React&#39;s local state, to MobX for its state management. Also React&#39;s Context API is replaced with MobX ..." />


<meta property="og:type" content="website" />
<meta property="og:url" content="https://chrispaul.dev/react-firebase-mobx-tutorial/" />
<meta property="og:image" content="https://chrispaul.dev/img/posts/react-firebase-mobx-tutorial/banner_640.jpg" />

  

    <meta name="news_keywords" content="react firebase mobx tutorial" />

  

    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image:src" content="https://chrispaul.dev/img/posts/react-firebase-mobx-tutorial/banner_640.jpg"/>



<meta name="twitter:title" content="How to use MobX in React Firebase"/>
<meta name="twitter:description" content="The tutorial shows you how to migrate a React with Firebase application, which uses only React&#39;s local state, to MobX for its state management. Also React&#39;s Context API is replaced with MobX ..."/>
<meta name="twitter:site" content="@rwieruch"/>
<meta name="twitter:domain" content="rwieruch"/>

  

</head>


  <body>

    <div id="all">

        <header>

          <div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="../index.html">
                    <img src="../img/page/logo.svg" alt="How to use MobX in React Firebase logo" class="img-lazy">
                    <span class="sr-only">How to use MobX in React Firebase - go to homepage</span>
                </a>

                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                        <span class="sr-only">Toggle navigation</span>
                        <i class="fa fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                    
                    <li class="dropdown">
                        
                            <a href="../index.html">Blog</a>
                        
                    </li>
                    
                    <li class="dropdown">
                        
                            <a href="../work-with-me/index.html">Work with me</a>
                        
                    </li>
                    
                    <li class="dropdown">
                        
                            <a href="../about/index.html">About</a>
                        
                    </li>
                    
                    <li class="dropdown">
                        
                            <a style="color: #38bb6c" href="https://roadtoreact.com/">Books &amp; Courses</a>
                        
                    </li>
                    
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">

                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>

                </span>
                    </div>
                </form>

            </div>
            

        </div>
    </div>
    

</div>




        </header>

        <div class="post-share post-share-fixed post-share-desktop hidden-xs hidden-sm">
    

<a
    aria-label="icon-facebook"
    class="icon-facebook"
    href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fchrispaul.dev%2freact-firebase-mobx-tutorial%2f"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
    <i class="fa fa-facebook"></i>
</a>


<a
    aria-label="icon-twitter"
    class="icon-twitter"
    href="https://twitter.com/share?text=How%20to%20use%20MobX%20in%20React%20Firebase%20by%20%40rwieruch%20%23ReactJs&amp;url=https%3a%2f%2fchrispaul.dev%2freact-firebase-mobx-tutorial%2f"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
    <i class="fa fa-twitter"></i>
</a>





<a
    aria-label="icon-linkedin"
    class="icon-linkedin"
    href="https://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20use%20MobX%20in%20React%20Firebase&amp;url=https%3a%2f%2fchrispaul.dev%2freact-firebase-mobx-tutorial%2f">
    <i class="fa fa-linkedin"></i>
</a>

</div>

<div class="visible-xs visible-sm text-center">
    <div class="post-share post-share-fixed post-share-mobile">
        

<a
    aria-label="icon-facebook"
    class="icon-facebook"
    href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fchrispaul.dev%2freact-firebase-mobx-tutorial%2f"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
    <i class="fa fa-facebook"></i>
</a>


<a
    aria-label="icon-twitter"
    class="icon-twitter"
    href="https://twitter.com/share?text=How%20to%20use%20MobX%20in%20React%20Firebase%20by%20%40rwieruch%20%23ReactJs&amp;url=https%3a%2f%2fchrispaul.dev%2freact-firebase-mobx-tutorial%2f"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
    <i class="fa fa-twitter"></i>
</a>





<a
    aria-label="icon-linkedin"
    class="icon-linkedin"
    href="https://www.linkedin.com/shareArticle?mini=true&amp;title=How%20to%20use%20MobX%20in%20React%20Firebase&amp;url=https%3a%2f%2fchrispaul.dev%2freact-firebase-mobx-tutorial%2f">
    <i class="fa fa-linkedin"></i>
</a>

    </div>
</div>

        

        <div class="hidden-xs">
            

<section class="bar background-image-fixed-2 no-mb color-white text-center">
    <div class="dark-mask"></div>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h3 class="lead">Never miss an article about web development, JavaScript and self-growth.</h3>
                <h2 class="text-uppercase newsletter">Take Part</h2>
            </div>

            <div class="col-md-12">
                <p class="text-center">
                    



<div id="mc_embed_signup">
    <form
        action="https://www.getrevue.co/profile/rwieruch/add_subscriber"
        method="post"
        id="revue-form"
        name="revue-form"
        target="_blank">
        <div id="mc_embed_signup_scroll">
            <input
                class="email"
                placeholder="email address"
                type="email"
                name="member[email]"
                id="member_email"
            >
            <div>
                <button
                    type="submit"
                    value="Subscribe"
                    name="member[subscribe]"
                    id="member_submit"
                    class="btn btn-template-transparent-black btn-lg"
                >
                    Subscribe
                </button>
            </div>
        </div>
    </form>
</div>

                </p>
            </div>
        </div>
    </div>
</section>



        </div>

        <div id="content">
            <div class="container">

                <div class="row">

                    <article
                        class="col-md-8 col-md-offset-2"
                        id="blog-post"
                        itemprop="blogPosts"
                        itemscope itemtype="http://schema.org/BlogPosting">

                        <div id="post-content" itemprop="articleBody">

                            <header>
                                <h1 itemprop="name headline">How to use MobX in React Firebase</h1>
                            </header>

                            <div class="text-center">
                                
    <a target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/rwieruch" class="facebook-button-follow">
         <i class="fa fa-facebook"></i>Follow
    </a>


                                &nbsp;
                                

                                &nbsp;
                                
  <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/intent/follow?screen_name=rwieruch" class="generic-button-follow">
    <img src="https://img.shields.io/twitter/follow/rwieruch.svg?style=social&amp;logo=twitter&amp;label=Follow" alt="Follow on Twitter">
  </a>


                                &nbsp;
                                
                            </div>

                            <p class="text-muted text-uppercase mb-small text-center">
    <span itemprop="author publisher">
        
    </span>

    
        <time datetime="2019-02-10" itemprop="datePublished">
            February 10, 2019
        </time>
    

    
        <span class="hidden-xs hidden-sm"> - <a
            target="_blank"
            rel="noopener noreferrer"
            href="https://github.com/rwieruch/blog_chriswieruch_content/blob/master/react-firebase-mobx-tutorial.md">
                Edit this Post on GitHub
            </a>
        </span>
    
</p>

                            

<div>
  

</div>

<div class="post-image-primary">
    <div class="pinterest-pinner-wrapper" itemscope itemtype="http://schema.org/ImageObject">
        <div class="pinterest-pinner">
            <a
                data-pin-do="buttonPin"
                data-pin-save="true"
                data-pin-tall="true"
                href="https://www.pinterest.com/pin/create/button/?url=https%3a%2f%2fchrispaul.dev%2freact-firebase-mobx-tutorial%2f&amp;media=https://chrispaul.dev/img%2fposts%2freact-firebase-mobx-tutorial%2fbanner.jpg&amp;description=">
            </a>
        </div>

        <img
            class="img-lazy img-responsive"
            data-lazy-src="/src="/img/posts/react-firebase-mobx-tutorial/banner.jpg"
            data-is-src-set="is-src-set"
            alt="react firebase mobx tutorial"
            itemprop="image"
        />
    </div>
</div>


<p>
  <em>
    Interested in reading this tutorial as one of many chapters in my advanced React with Firebase book? Checkout the entire <a href="https://roadtoreact.com">The Road to React with Firebase</a> book that teaches you to create business web applications without the need to create a backend application with a database yourself.
  </em>
</p>

<div class="read-before">
    <p>This tutorial is part 10 of 10 in this series.</p>
    <div>Part 1: <a href="../complete-firebase-authentication-react-tutorial/index.html" itemprop="url">A Firebase in React Tutorial for Beginners</a></div>
    <div>Part 2: <a href="../react-firebase-authorization-roles-permissions/index.html" itemprop="url">React Firebase Authorization with Roles</a></div>
    <div>Part 3: <a href="../react-firebase-auth-persistence/index.html" itemprop="url">React Firebase Auth Persistence with Local Storage</a></div>
    <div>Part 4: <a href="../react-firebase-social-login/index.html" itemprop="url">React Firebase Social Login: Google, Facebook, Twitter</a></div>
    <div>Part 5: <a href="../react-firebase-link-social-logins/index.html" itemprop="url">React Firebase: Link Social Logins</a></div>
    <div>Part 6: <a href="../react-firebase-email-verification/index.html" itemprop="url">React Firebase: Email Verification</a></div>
    <div>Part 7: <a href="../react-firebase-router/index.html" itemprop="url">How to use React Router with Firebase</a></div>
    <div>Part 8: <a href="../react-firebase-realtime-database/index.html" itemprop="url">How to use Firebase Realtime Database in React</a></div>
    <div>Part 9: <a href="../firebase-deploy-react-js/index.html" itemprop="url">How to deploy a React application to Firebase</a></div>
</div>

<p>So far, it was fine to rely only on React&rsquo;s local state and React&rsquo;s Context API. This tutorial dives into using MobX on top of React and Firebase for the state management. We&rsquo;ll exchange React&rsquo;s local state (e.g. users on admin page, messages on home page) and React&rsquo;s context (e.g. session management for authenticated user) with MobX. It will how you how to accomplish the same thing with MobX, so you can integrate it in your tech stack.</p>

<p>The first section will setup MobX, where we&rsquo;ll add a state layer separately from the view layer and connect MobX with React by providing the MobX stores React&rsquo;s Context API to the React components. The second part exchanges the current React state layer with the MobX state layer:</p>

<ul>
<li>Users in React Local State -&gt; Users in MobX User Store</li>
<li>Messages in React Local State -&gt; Messages in MobX Message Store</li>
<li>Authenticated User in React Local State + React Context -&gt; Authenticated User in MobX Session Store</li>
</ul>

<p>If you are not familiar with MobX, I recommend <a target="_blank" rel="noopener noreferrer" href="http://roadtoreact.com">Taming the State in React</a>. Most of the MobX knowledge is required for the migration from only using React to MobX.</p>

<h2 class="chapter-header" id="react-firebase-mobx-setup">MobX Setup in React Firebase Application</h2>

<p>First, follow this <a href="../create-react-app-mobx-decorators/index.html">short guide to enable decorators in create-react-app</a>. You can also take the alternative way of not using decorators, to avoid the eject process, but this tutorial only reflects the usage <strong>with decorators</strong>. After you went through the MobX setup tutorial, you should have installed <a target="_blank" rel="noopener noreferrer" href="https://mobx.js.org/">mobx</a> and <a target="_blank" rel="noopener noreferrer" href="https://github.com/mobxjs/mobx-react">mobx-react</a>.</p>

<p>For this run through, we focus on the MobX setup without worrying about Firebase or React. First, you need the MobX stores, so we create a folder with files. From your <em>src/</em> folder type:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #06b6ef">mkdir</span> <span style="color: #06b6ef">stores</span>
<span style="color: #06b6ef">cd</span> <span style="color: #06b6ef">stores</span>
<span style="color: #06b6ef">touch</span> <span style="color: #06b6ef">index</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">js</span> <span style="color: #06b6ef">sessionStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">js</span> <span style="color: #06b6ef">userStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">js</span> <span style="color: #06b6ef">messageStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">js</span>
</code></pre></div>


<p>There&rsquo;s a store for the session state (e.g. authenticated user), a store for the user state (e.g. list of users from the database), and a store for the message state (e.g. list of messages from the database). There is also an entry point file to the module to combine those stores as root store, the session store which manages the authenticated user. The authenticated user represents the session in the application.</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">observable</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">action</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;mobx&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">class</span> <span style="color: #06b6ef">SessionStore</span> <span style="color: #e7e9db">{</span>
  <span style="color: #ef6155">@</span><span style="color: #06b6ef">observable</span> <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">null</span><span style="color: #e7e9db">;</span>

  <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">rootStore</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">rootStore</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">rootStore</span><span style="color: #e7e9db">;</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #ef6155">@</span><span style="color: #06b6ef">action</span> <span style="color: #06b6ef">setAuthUser</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">;</span>
  <span style="color: #e7e9db">};</span>
<span style="color: #e7e9db">}</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">SessionStore</span><span style="color: #e7e9db">;</span>
</code></pre></div>


<p>Next is the user store that deals with the list of users from the Firebase realtime database. It sets either the object of users as a dictionary or a single user identified by a unique identifier. It also has a <code>userList</code> property to retrieve the user object as a transformed list of users:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">observable</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">computed</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;mobx&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">class</span> <span style="color: #06b6ef">UserStore</span> <span style="color: #e7e9db">{</span>
  <span style="color: #ef6155">@</span><span style="color: #06b6ef">observable</span> <span style="color: #06b6ef">users</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">null</span><span style="color: #e7e9db">;</span>

  <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">rootStore</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">rootStore</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">rootStore</span><span style="color: #e7e9db">;</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #ef6155">@</span><span style="color: #06b6ef">action</span> <span style="color: #06b6ef">setUsers</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">users</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">users</span><span style="color: #e7e9db">;</span>
  <span style="color: #e7e9db">};</span>

  <span style="color: #ef6155">@</span><span style="color: #06b6ef">action</span> <span style="color: #06b6ef">setUser</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">uid</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #5bc4bf">!</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{};</span>
    <span style="color: #e7e9db">}</span>

    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">[</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">]</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">user</span><span style="color: #e7e9db">;</span>
  <span style="color: #e7e9db">};</span>

  <span style="color: #ef6155">@</span><span style="color: #06b6ef">computed</span> <span style="color: #06b6ef">get</span> <span style="color: #06b6ef">userList</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">Object.</span><span style="color: #06b6ef">keys</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span> <span style="color: #5bc4bf">||</span> <span style="color: #e7e9db">{}).</span><span style="color: #06b6ef">map</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">key</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
      <span style="color: #e7e9db">...</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">[</span><span style="color: #06b6ef">key</span><span style="color: #e7e9db">],</span>
      <span style="color: #06b6ef">uid</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">key</span><span style="color: #e7e9db">,</span>
    <span style="color: #e7e9db">}));</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">UserStore</span><span style="color: #e7e9db">;</span>
</code></pre></div>


<p>Third, the message store that is similar to the user store. It manages one more property for the pagination feature:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">observable</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">computed</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;mobx&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">class</span> <span style="color: #06b6ef">MessageStore</span> <span style="color: #e7e9db">{</span>
  <span style="color: #ef6155">@</span><span style="color: #06b6ef">observable</span> <span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">null</span><span style="color: #e7e9db">;</span>
  <span style="color: #ef6155">@</span><span style="color: #06b6ef">observable</span> <span style="color: #06b6ef">limit</span> <span style="color: #5bc4bf">=</span> <span style="color: #f99b15">5</span><span style="color: #e7e9db">;</span>

  <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">rootStore</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">rootStore</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">rootStore</span><span style="color: #e7e9db">;</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #ef6155">@</span><span style="color: #06b6ef">action</span> <span style="color: #06b6ef">setMessages</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">messages</span><span style="color: #e7e9db">;</span>
  <span style="color: #e7e9db">};</span>

  <span style="color: #ef6155">@</span><span style="color: #06b6ef">action</span> <span style="color: #06b6ef">setLimit</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">limit</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">limit</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">limit</span><span style="color: #e7e9db">;</span>
  <span style="color: #e7e9db">};</span>

  <span style="color: #ef6155">@</span><span style="color: #06b6ef">computed</span> <span style="color: #06b6ef">get</span> <span style="color: #06b6ef">messageList</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">Object.</span><span style="color: #06b6ef">keys</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">||</span> <span style="color: #e7e9db">{}).</span><span style="color: #06b6ef">map</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">key</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
      <span style="color: #e7e9db">...</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">[</span><span style="color: #06b6ef">key</span><span style="color: #e7e9db">],</span>
      <span style="color: #06b6ef">uid</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">key</span><span style="color: #e7e9db">,</span>
    <span style="color: #e7e9db">}));</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">MessageStore</span><span style="color: #e7e9db">;</span>
</code></pre></div>


<p>Finally, combine all three stores in a root store. This can be used to make the stores communicate with each other, but also to provide a way to import only one store (root store) to have access to all of its combined stores later. In <em>src/stores/index.js</em> file:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">SessionStore</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./sessionStore&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">UserStore</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./userStore&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">MessageStore</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./messageStore&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">class</span> <span style="color: #06b6ef">RootStore</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">sessionStore</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">new</span> <span style="color: #06b6ef">SessionStore</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">);</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userStore</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">new</span> <span style="color: #06b6ef">UserStore</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">);</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messageStore</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">new</span> <span style="color: #06b6ef">MessageStore</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">rootStore</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">new</span> <span style="color: #06b6ef">RootStore</span><span style="color: #e7e9db">();</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">rootStore</span><span style="color: #e7e9db">;</span>
</code></pre></div>


<p>The MobX setup is done. Now, you can connect your state layer with your view layer. The MobX stores can be provided to the component hierarchy using MobX&rsquo;s Provider component. This time, the Provider component from the MobX library passes down the all stores instead of only the authenticated user. In <em>src/index.js</em> file:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">ReactDOM</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-dom&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Provider</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;mobx-react&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #06b6ef">store</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./stores&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">App</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./components/App&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">Firebase</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">FirebaseContext</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./components/Firebase&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #06b6ef">ReactDOM</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">render</span><span style="color: #e7e9db">(</span>
<span style="background-color: #4f424c">  <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Provider</span> <span style="color: #e7e9db">{...</span><span style="color: #06b6ef">store</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span>
</span>    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">FirebaseContext</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Provider</span> <span style="color: #06b6ef">value</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">new</span> <span style="color: #06b6ef">Firebase</span><span style="color: #e7e9db">()}</span><span style="color: #5bc4bf">&gt;</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">App</span> <span style="color: #5bc4bf">/&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/FirebaseContext.Provider&gt;</span>
<span style="background-color: #4f424c">  <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/Provider&gt;,</span>
</span>  <span style="color: #e7e9db">document.</span><span style="color: #06b6ef">getElementById</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;root&#39;</span><span style="color: #e7e9db">),</span>
<span style="color: #e7e9db">);</span>
</code></pre></div>


<p>That&rsquo;s it for connecting both worlds. Next, we&rsquo;ll refactor almost everything from React&rsquo;s local state to MobX. We want to have everything in the MobX stores that should be persisted when we navigate from route to route. This includes users, messages, and the authenticated user, but maybe not the loading states.</p>

<h3 id="exercises">Exercises:</h3>

<ul>
<li>Confirm your <a target="_blank" rel="noopener noreferrer" href="http://bit.ly/2VnDt1v">source code for the last section</a></li>
</ul>

<h2 class="chapter-header" id="firebase-authenticated-user-mobx-store">Manage Firebase&#39;s authenticated User in MobX&#39;s Session Store</h2>

<p>So far, we have managed the authenticated user with React&rsquo;s Context API. We provided the authenticated user in a Provider component and consumed with a Consumer component. Let&rsquo;s change this by storing the authenticated user in MobX&rsquo;s session store instead, and injecting the store to all components who are interested in it.</p>

<p>In the authentication higher-order component, we make the session store in the props of the component:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">inject</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;mobx-react&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">withAuthentication</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">Component</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">class</span> <span style="color: #06b6ef">WithAuthentication</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
    <span style="color: #e7e9db">...</span>
  <span style="color: #e7e9db">}</span>

<span style="background-color: #4f424c">  <span style="color: #815ba4">return</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
</span>    <span style="color: #06b6ef">withFirebase</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">    <span style="color: #06b6ef">inject</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;sessionStore&#39;</span><span style="color: #e7e9db">),</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">)(</span><span style="color: #06b6ef">WithAuthentication</span><span style="color: #e7e9db">);</span>
</span><span style="color: #e7e9db">};</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">withAuthentication</span><span style="color: #e7e9db">;</span>
</code></pre></div>


<p>Then, we use the store to persist the authenticated user like before, by setting it to React&rsquo;s local state. We don&rsquo;t need to provide the authenticated user with React&rsquo;s Context Provider component, because it will be available for every component that connects to the store:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">const</span> <span style="color: #06b6ef">withAuthentication</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">Component</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">class</span> <span style="color: #06b6ef">WithAuthentication</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
    <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">super</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">);</span>

<span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">sessionStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setAuthUser</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">        <span style="color: #06b6ef">JSON</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">parse</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">localStorage</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">getItem</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;authUser&#39;</span><span style="color: #e7e9db">)),</span>
</span><span style="background-color: #4f424c">      <span style="color: #e7e9db">);</span>
</span>    <span style="color: #e7e9db">}</span>

    <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">listener</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onAuthUserListener</span><span style="color: #e7e9db">(</span>
        <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
          <span style="color: #06b6ef">localStorage</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setItem</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;authUser&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">JSON</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">stringify</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">));</span>
<span style="background-color: #4f424c">          <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">sessionStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setAuthUser</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">);</span>
</span>        <span style="color: #e7e9db">},</span>
        <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
          <span style="color: #06b6ef">localStorage</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">removeItem</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;authUser&#39;</span><span style="color: #e7e9db">);</span>
<span style="background-color: #4f424c">          <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">sessionStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setAuthUser</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">null</span><span style="color: #e7e9db">);</span>
</span>        <span style="color: #e7e9db">},</span>
      <span style="color: #e7e9db">);</span>
    <span style="color: #e7e9db">}</span>

    <span style="color: #06b6ef">componentWillUnmount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">listener</span><span style="color: #e7e9db">();</span>
    <span style="color: #e7e9db">}</span>

    <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">      <span style="color: #815ba4">return</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{...</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span><span style="color: #e7e9db">;</span>
</span>    <span style="color: #e7e9db">}</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">};</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">withAuthentication</span><span style="color: #e7e9db">;</span>
</code></pre></div>


<p>We&rsquo;ve stored and provided the authenticated user to the MobX session store. Let&rsquo;s see how we can consume it in the Navigation component for the conditional rendering of the routes without React&rsquo;s Context:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Link</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-router-dom&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">inject</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">observer</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;mobx-react&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">SignOutButton</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../SignOut&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">as</span> <span style="color: #06b6ef">ROUTES</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../../constants/routes&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">as</span> <span style="color: #06b6ef">ROLES</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../../constants/roles&#39;</span><span style="color: #e7e9db">;</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">Navigation</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">({</span> <span style="color: #06b6ef">sessionStore</span> <span style="color: #e7e9db">})</span> <span style="color: #5bc4bf">=&gt;</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">sessionStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">?</span> <span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">NavigationAuth</span> <span style="color: #06b6ef">authUser</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">sessionStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span>
</span>  <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">(</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">NavigationNonAuth</span> <span style="color: #5bc4bf">/&gt;</span>
  <span style="color: #e7e9db">);</span>

<span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">inject</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;sessionStore&#39;</span><span style="color: #e7e9db">),</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">observer</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">)(</span><span style="color: #06b6ef">Navigation</span><span style="color: #e7e9db">);</span>
</span></code></pre></div>


<p>MobX injects the store in the Navigation component with the inject higher-order component to make a decision for the conditional rendering, but also to pass the authenticated user to the child components. In addition, the observer higher-order component makes sure that the component updates when something in the session store has changed. We can do the same in our other components that are interested in the authenticated user. For instance, the authorization higher-order component can rely on the MobX session store as well:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withRouter</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-router-dom&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">inject</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">observer</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;mobx-react&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">as</span> <span style="color: #06b6ef">ROUTES</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../../constants/routes&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">withAuthorization</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">condition</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #06b6ef">Component</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">class</span> <span style="color: #06b6ef">WithAuthorization</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
    <span style="color: #e7e9db">...</span>

    <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">      <span style="color: #815ba4">return</span> <span style="color: #06b6ef">condition</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">sessionStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">?</span> <span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{...</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span>
</span><span style="background-color: #4f424c">      <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">:</span> <span style="color: #815ba4">null</span><span style="color: #e7e9db">;</span>
</span>    <span style="color: #e7e9db">}</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #815ba4">return</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
    <span style="color: #06b6ef">withRouter</span><span style="color: #e7e9db">,</span>
    <span style="color: #06b6ef">withFirebase</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">    <span style="color: #06b6ef">inject</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;sessionStore&#39;</span><span style="color: #e7e9db">),</span>
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">observer</span><span style="color: #e7e9db">,</span>
</span>  <span style="color: #e7e9db">)(</span><span style="color: #06b6ef">WithAuthorization</span><span style="color: #e7e9db">);</span>
<span style="color: #e7e9db">};</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">withAuthorization</span><span style="color: #e7e9db">;</span>
</code></pre></div>


<p>Also, our other authorization component for the email verification can make use of it:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">inject</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">observer</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;mobx-react&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #e7e9db">...</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">withEmailVerification</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">Component</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">class</span> <span style="color: #06b6ef">WithEmailVerification</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
    <span style="color: #e7e9db">...</span>

    <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">return</span> <span style="color: #06b6ef">needsEmailVerification</span><span style="color: #e7e9db">(</span>
<span style="background-color: #4f424c">        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">sessionStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">,</span>
</span>      <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">?</span> <span style="color: #e7e9db">(</span> <span style="color: #e7e9db">...</span> <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">(</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{...</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span>
      <span style="color: #e7e9db">);</span>
    <span style="color: #e7e9db">}</span>
  <span style="color: #e7e9db">}</span>

<span style="background-color: #4f424c">  <span style="color: #815ba4">return</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
</span>    <span style="color: #06b6ef">withFirebase</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">    <span style="color: #06b6ef">inject</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;sessionStore&#39;</span><span style="color: #e7e9db">),</span>
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">observer</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">)(</span><span style="color: #06b6ef">WithEmailVerification</span><span style="color: #e7e9db">);</span>
</span><span style="color: #e7e9db">};</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">withEmailVerification</span><span style="color: #e7e9db">;</span>
</code></pre></div>


<p>The AccountPage component displays the authenticated user, but also renders the component that manages sign in methods for the user:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">inject</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">observer</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;mobx-react&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withAuthorization</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">withEmailVerification</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Session&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">PasswordForgetForm</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../PasswordForget&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">PasswordChangeForm</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../PasswordChange&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">AccountPage</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">({</span> <span style="color: #06b6ef">sessionStore</span> <span style="color: #e7e9db">})</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
</span>  <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
<span style="background-color: #4f424c">    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">h1</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Account</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span><span style="color: #06b6ef">sessionStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">email</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/h1&gt;</span>
</span>    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">PasswordForgetForm</span> <span style="color: #5bc4bf">/&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">PasswordChangeForm</span> <span style="color: #5bc4bf">/&gt;</span>
<span style="background-color: #4f424c">    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">LoginManagement</span> <span style="color: #06b6ef">authUser</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">sessionStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span>
</span>  <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
<span style="color: #e7e9db">);</span>

<span style="color: #e7e9db">...</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">condition</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #5bc4bf">!!</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">inject</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;sessionStore&#39;</span><span style="color: #e7e9db">),</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">observer</span><span style="color: #e7e9db">,</span>
</span>  <span style="color: #06b6ef">withEmailVerification</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">withAuthorization</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">condition</span><span style="color: #e7e9db">),</span>
<span style="color: #e7e9db">)(</span><span style="color: #06b6ef">AccountPage</span><span style="color: #e7e9db">);</span>
</code></pre></div>


<p>You can remove the React Context we used for providing and consuming the authenticated user in the <em>src/components/Session/context.js</em> and <em>src/components/Session/index.js</em> files:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">withAuthentication</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./withAuthentication&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">withAuthorization</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./withAuthorization&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">withEmailVerification</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./withEmailVerification&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">export</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">withAuthentication</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">withAuthorization</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">withEmailVerification</span><span style="color: #e7e9db">,</span>
<span style="color: #e7e9db">};</span>
</code></pre></div>


<p>That&rsquo;s it for storing the authenticated user in our MobX session store which takes place in the authentication higher-order component and for consuming the authenticated user in every component which is interested in it by injecting the session store to it.</p>

<h3 id="exercises-1">Exercises:</h3>

<ul>
<li>Confirm your <a target="_blank" rel="noopener noreferrer" href="http://bit.ly/2VmStNa">source code for the last section</a></li>
</ul>

<h2 class="chapter-header" id="firebase-users-mobx-store">Manage Firebase&#39;s Users in MobX&#39;s User Store</h2>

<p>We have implemented the session management with the authenticated user with MobX instead of React&rsquo;s local state and context API. Next, we will migrate the user management over to MobX. The users are mainly used in the AdminPage component&rsquo;s UserList and UserItem components. Our goal here is to navigate from UserList to UserItem with React Router without loosing the state of the users. The UserList component fetches and shows a list of users, the UserItem component fetches and shows a single user entity. If the data is already available in the MobX user store, we only need to keep track of new data with the realtime feature of the Firebase database. We begin with the UserList component:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Link</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-router-dom&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">inject</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">observer</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;mobx-react&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">as</span> <span style="color: #06b6ef">ROUTES</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../../constants/routes&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">class</span> <span style="color: #06b6ef">UserList</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
</span>  <span style="color: #06b6ef">withFirebase</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">inject</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;userStore&#39;</span><span style="color: #e7e9db">),</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">observer</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">)(</span><span style="color: #06b6ef">UserList</span><span style="color: #e7e9db">);</span>
</span></code></pre></div>


<p>React MobX&rsquo;s inject higher-order component is used to marry React with MobX and the observer higher-order component makes sure to update the component if the store has changed. Next, make sure users are fetched from Firebase&rsquo;s real-time database and persisted in the MobX store:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">UserList</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">().</span><span style="color: #06b6ef">on</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setUsers</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">snapshot</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">val</span><span style="color: #e7e9db">());</span>
</span>    <span style="color: #e7e9db">});</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #06b6ef">componentWillUnmount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">().</span><span style="color: #06b6ef">off</span><span style="color: #e7e9db">();</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Now every time the Firebase listener is called or because a user was added, edited, or removed from the list, the most recent user object with users from Firebase is stored to the MobX user store.</p>

<p>Another user experience improvement is adding a loading indicator when there are no users in the store. Every other time, when there are users in the store but the Firebase listener is updating the MobX store with a new user object, we don&rsquo;t show any loading indicator:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">UserList</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">super</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">);</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">};</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">}</span>
</span>
  <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #5bc4bf">!</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">length</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">true</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">}</span>
</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">().</span><span style="color: #06b6ef">on</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setUsers</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">snapshot</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">val</span><span style="color: #e7e9db">());</span>

<span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span> <span style="color: #e7e9db">});</span>
</span>    <span style="color: #e7e9db">});</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>The users are not managed in the local state of the component anymore, but in MobX instead. The users and loading indicator are rendered like before, but only the loading state comes from the local state. The Link component only navigates to the UserItem component, but it doesn&rsquo;t send any user objects. We wanted the user at our disposal before via the Link component, we want to let MobX handle it this time.</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">UserList</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">const</span> <span style="color: #06b6ef">users</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userList</span><span style="color: #e7e9db">;</span>
</span>    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">loading</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>

    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">h2</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Users</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/h2&gt;</span>
        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">loading</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Loading</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;}</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">ul</span><span style="color: #5bc4bf">&gt;</span>
          <span style="color: #e7e9db">{</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">map</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">user</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
            <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">li</span> <span style="color: #06b6ef">key</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">span</span><span style="color: #5bc4bf">&gt;</span>
                <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">strong</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">ID</span><span style="color: #5bc4bf">:&lt;</span><span style="color: #ef6155">/strong&gt; {user.uid}</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/span&gt;</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">span</span><span style="color: #5bc4bf">&gt;</span>
                <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">strong</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">E</span><span style="color: #5bc4bf">-</span><span style="color: #06b6ef">Mail</span><span style="color: #5bc4bf">:&lt;</span><span style="color: #ef6155">/strong&gt; {user.email}</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/span&gt;</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">span</span><span style="color: #5bc4bf">&gt;</span>
                <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">strong</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Username</span><span style="color: #5bc4bf">:&lt;</span><span style="color: #ef6155">/strong&gt; {user.username}</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/span&gt;</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">span</span><span style="color: #5bc4bf">&gt;</span>
<span style="background-color: #4f424c">                <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Link</span> <span style="color: #06b6ef">to</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #48b685">`</span><span style="color: #f99b15">${</span><span style="color: #06b6ef">ROUTES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">ADMIN</span><span style="color: #f99b15">}</span><span style="color: #48b685">/</span><span style="color: #f99b15">${</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #f99b15">}</span><span style="color: #48b685">`</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span>
</span>                  <span style="color: #06b6ef">Details</span>
                <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/Link&gt;</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/span&gt;</span>
            <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/li&gt;</span>
          <span style="color: #e7e9db">))}</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/ul&gt;</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>That&rsquo;s it for the UserList component. It renders a list of users as before, fetches the recent user object with all users from Firebase with a realtime connection, except it stores the result into the MobX user store instead of React&rsquo;s local state. Let&rsquo;s continue with the UserItem component that will also connect to the MobX user store:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">inject</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">observer</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;mobx-react&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">class</span> <span style="color: #06b6ef">UserItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
</span>  <span style="color: #06b6ef">withFirebase</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">inject</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;userStore&#39;</span><span style="color: #e7e9db">),</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">observer</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">)(</span><span style="color: #06b6ef">UserItem</span><span style="color: #e7e9db">);</span>
</span></code></pre></div>


<p>Similar to the UserList component, the UserItem component receives the MobX user store. Check again your user store to see what&rsquo;s happening when setting users or a single user or when retrieving users with the computed methods. Next, let&rsquo;s make sure the user is fetched from Firebase&rsquo;s realtime database and persisted in the MobX store:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">UserItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">match</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">params</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">id</span><span style="color: #e7e9db">)</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">on</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setUser</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">          <span style="color: #06b6ef">snapshot</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">val</span><span style="color: #e7e9db">(),</span>
</span><span style="background-color: #4f424c">          <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">match</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">params</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">id</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">);</span>
</span>      <span style="color: #e7e9db">});</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>When the component mounts, we register Firebase&rsquo;s listener to the real-time database. When the user changes, we update it in the MobX user store. If there is already a user, we don&rsquo;t show a loading indicator. If there is no user, we show it:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">UserItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">super</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">);</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">};</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">}</span>
</span>
  <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">      <span style="color: #5bc4bf">!</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span> <span style="color: #5bc4bf">&amp;&amp;</span>
</span><span style="background-color: #4f424c">        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">[</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">match</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">params</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">id</span><span style="color: #e7e9db">]</span>
</span><span style="background-color: #4f424c">      <span style="color: #e7e9db">)</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">true</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">}</span>
</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">match</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">params</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">id</span><span style="color: #e7e9db">)</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">on</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setUser</span><span style="color: #e7e9db">(</span>
          <span style="color: #06b6ef">snapshot</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">val</span><span style="color: #e7e9db">(),</span>
          <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">match</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">params</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">id</span><span style="color: #e7e9db">,</span>
        <span style="color: #e7e9db">);</span>

<span style="background-color: #4f424c">        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span> <span style="color: #e7e9db">});</span>
</span>      <span style="color: #e7e9db">});</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>We can render user and loading state as before, except the user comes from the user store which comes from the props:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">UserItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">onSendPasswordResetEmail</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">doPasswordReset</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">[</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">match</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">params</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">id</span><span style="color: #e7e9db">].</span><span style="color: #06b6ef">email</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">);</span>
</span>  <span style="color: #e7e9db">};</span>

  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">const</span> <span style="color: #06b6ef">user</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span> <span style="color: #5bc4bf">||</span> <span style="color: #e7e9db">{})[</span>
</span><span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">match</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">params</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">id</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">];</span>
</span>    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">loading</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>

    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">h2</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">User</span> <span style="color: #e7e9db">({</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">match</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">params</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">id</span><span style="color: #e7e9db">})</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/h2&gt;</span>
        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">loading</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Loading</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;}</span>

        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">user</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #e7e9db">(</span> <span style="color: #e7e9db">...</span> <span style="color: #e7e9db">)}</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>That&rsquo;s it for the UserItem component. It renders a user, fetches the recent user from Firebase with a realtime connection, only it stores the result into the MobX store. The advantage in using MobX instead of React&rsquo;s local state is that user states persist between routes. This means you won&rsquo;t need to fetch them when you navigate from UserItem to UserList or a different route, since they remain in MobX&rsquo;s global state.</p>

<h3 id="exercises-2">Exercises:</h3>

<ul>
<li>Confirm your <a target="_blank" rel="noopener noreferrer" href="http://bit.ly/2VpWTTs">source code for the last section</a>.</li>
</ul>

<h2 class="chapter-header" id="message-entities-mobx-store">Manage Message Entities in MobX&#39;s Message Store</h2>

<p>We migrated the users and session management from React&rsquo;s local state and React&rsquo;s Context API over to MobX. Finally, we&rsquo;ll migrate the message entities from the Firebase database. It uses the authenticated user as well, which is why we have refactored the session management earlier. What&rsquo;s missing is a connected Messages component to the MobX message store to store and get messages:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">inject</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">observer</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;mobx-react&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">MessageList</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./MessageList&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">class</span> <span style="color: #06b6ef">Messages</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
</span>  <span style="color: #06b6ef">withFirebase</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">inject</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;messageStore&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #48b685">&#39;sessionStore&#39;</span><span style="color: #e7e9db">),</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">observer</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">)(</span><span style="color: #06b6ef">Messages</span><span style="color: #e7e9db">);</span>
</span></code></pre></div>


<p>The Messages component has access to the session store, too, which is later used for associating the user to the written message. Because we are using the MobX stores, only a couple of properties are left in the local state of the component:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">Messages</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">super</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">);</span>

    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
      <span style="color: #06b6ef">text</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;&#39;</span><span style="color: #e7e9db">,</span>
      <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span><span style="color: #e7e9db">,</span>
    <span style="color: #e7e9db">};</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>The Messages component only deals with the loading indicator and the text for the message written from within the component as local state. Everything else will be managed with MobX.</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">Messages</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #5bc4bf">!</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messageStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messageList</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">length</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">true</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">}</span>
</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onListenForMessages</span><span style="color: #e7e9db">();</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #06b6ef">onListenForMessages</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">()</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">orderByChild</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;createdAt&#39;</span><span style="color: #e7e9db">)</span>
<span style="background-color: #4f424c">      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">limitToLast</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messageStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">limit</span><span style="color: #e7e9db">)</span>
</span>      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">on</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messageStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setMessages</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">snapshot</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">val</span><span style="color: #e7e9db">());</span>
</span>
<span style="background-color: #4f424c">        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span> <span style="color: #e7e9db">});</span>
</span>      <span style="color: #e7e9db">});</span>
  <span style="color: #e7e9db">};</span>

  <span style="color: #06b6ef">componentWillUnmount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">().</span><span style="color: #06b6ef">off</span><span style="color: #e7e9db">();</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>The other logic for creating, updating, and removing a message stays the same, because it only uses the Firebase API. The listener of the Firebase database makes sure to update all messages in the MobX message store. Only the class method to update the limit uses the method provided by the MobX message store:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">Messages</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">onNextPage</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messageStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setLimit</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messageStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">limit</span> <span style="color: #5bc4bf">+</span> <span style="color: #f99b15">5</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">);</span>
</span>  <span style="color: #e7e9db">};</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Every time this state in the MobX message store changes, we receive the new limit in the Messages component as props due to the connected higher-order component. If the limit changes, we register a new Firebase listener with the new limit:</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">Messages</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">componentDidUpdate</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messageStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">limit</span> <span style="color: #5bc4bf">!==</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messageStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">limit</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onListenForMessages</span><span style="color: #e7e9db">();</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">}</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">}</span>
</span>
  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>Rendering the component didn&rsquo;t change much, except now it receives the messages from the message store from the props instead of the local state.</p>

<div class="highlight" style="background: #2f1e2e"><pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">Messages</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">messageStore</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">sessionStore</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">text</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">loading</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">const</span> <span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">messageStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messageList</span><span style="color: #e7e9db">;</span>
</span>
    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #e7e9db">{</span><span style="color: #5bc4bf">!</span><span style="color: #06b6ef">loading</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #e7e9db">(</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">button</span> <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;button&quot;</span> <span style="color: #06b6ef">onClick</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onNextPage</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span>
            <span style="color: #06b6ef">More</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/button&gt;</span>
        <span style="color: #e7e9db">)}</span>

        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">loading</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Loading</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;}</span>

        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #e7e9db">(</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">MessageList</span> <span style="color: #e7e9db">...</span> <span style="color: #5bc4bf">/&gt;</span>
        <span style="color: #e7e9db">)}</span>

        <span style="color: #e7e9db">{</span><span style="color: #5bc4bf">!</span><span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">There</span> <span style="color: #06b6ef">are</span> <span style="color: #06b6ef">no</span> <span style="color: #06b6ef">messages</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;}</span>

        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">form</span>
          <span style="color: #06b6ef">onSubmit</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">event</span> <span style="color: #5bc4bf">=&gt;</span>
<span style="background-color: #4f424c">            <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onCreateMessage</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">event</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">sessionStore</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">)</span>
</span>          <span style="color: #e7e9db">}</span>
        <span style="color: #5bc4bf">&gt;</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">input</span>
            <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;text&quot;</span>
            <span style="color: #06b6ef">value</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">text</span><span style="color: #e7e9db">}</span>
            <span style="color: #06b6ef">onChange</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onChangeText</span><span style="color: #e7e9db">}</span>
          <span style="color: #5bc4bf">/&gt;</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">button</span> <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;submit&quot;</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Send</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/button&gt;</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/form&gt;</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre></div>


<p>The MessageList and MessageItem components didn&rsquo;t change at all, only the HomePage and the Messages inject the MobX stores and observe their changes. Every time a Firebase listener that receives the latest entities from the Firebase database is called, it stores the result in on of the MobX stores. It happens as well when a user creates, edits or deletes a message. If the limit for the pagination feature changes, the listener is registered with this new limit again. Everything else, including the text of the new message or the loading indicator, is still managed in React&rsquo;s local state.</p>

<h3 id="exercises-3">Exercises:</h3>

<ul>
<li>Confirm your <a target="_blank" rel="noopener noreferrer" href="http://bit.ly/2VkthqM">source code for the last section</a></li>
</ul>

<hr class="section-divider">

<p>You&rsquo;ve introduced MobX as state management library to manage your session, user, and message state. Instead of relying on React&rsquo;s context API for the authenticated user object and React&rsquo;s local state for the list of users and messages from the Firebase database, these objects are kept in the MobX stores. The project is found in <a target="_blank" rel="noopener noreferrer" href="https://github.com/the-road-to-react-with-firebase/react-mobx-firebase-authentication">GitHub repository</a>.</p>


                            
<div class="feedback-and-share text-center">
    <hr>
    
    <p class="lead">
        I would like to hear your thoughts :-) Find me on <a target="_blank" rel="noopener noreferrer" aria-label="twitter" href="https://twitter.com/rwieruch"><i class="fa fa-twitter"></i>Twitter</a> and <a target="_blank" aria-label="facebook" href="https://www.facebook.com/rwieruch/"><i class="fa fa-facebook"></i>Facebook</a>
    </p>
    
    
        <p class="lead">
            Did the article help you? Share it with your friends on social media <i class="fa fa-arrow-left"></i>, support me as my <a target="_blank" rel="noopener noreferrer" aria-label="patreon" href="https://www.patreon.com/rwieruch"><i class="fa fa-paw"></i>Patron</a>, and become a full-stack developer with my books <i class="fa fa-arrow-down"></i>
        </p>
    
</div>


                            
                                <div class="box-inline col-md-12">
    <div class="col-md-12 text-center">
        <h2 class="newsletter">The Road to learn React</h2>
        
            <div class="col-md-4">
                <img class="img-lazy img-responsive" data-lazy-src="//img/page/cover.png">
            </div>
        
        <p class="lead">
            Build a Hacker News App along the way. No setup configuration. No tooling. No Redux. Plain React in 200+ pages of learning material. Learn React like <strong>50.000+ readers</strong>.
        </p>
        <a
            class="btn btn-template-main"
            href="https://roadtoreact.com"
            target="_blank"
            rel="noopener noreferrer"
        >
            Get the Book for free <i class="fa fa-chevron-right"></i>
        </a>
        
            <div>
                <a
                    href="https://amzn.to/2QY2ONp"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    Get it from Amazon
                </a>
            </div>
        
    </div>
</div>
                            
                        </div>

                        
                        
                        <div id="comments">
                            <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'rwieruch';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                        </div>
                        

                    </article>
                    

                </div>
                

            </div>
            
        </div>
        

        

<section class="bar background-image-fixed-2 no-mb color-white text-center">
    <div class="dark-mask"></div>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h3 class="lead">Never miss an article about web development, JavaScript and self-growth.</h3>
                <h2 class="text-uppercase">Take Part</h2>
            </div>

            <div class="col-md-12 text-center">
                
                    <h3 class="lead"><i class="fa fa-check"></i> Join 30.000&#43; Developers</h3>
                
                    <h3 class="lead"><i class="fa fa-check"></i> Learn Web Development with JavaScript</h3>
                
                    <h3 class="lead"><i class="fa fa-check"></i> Tips and Tricks</h3>
                
                    <h3 class="lead"><i class="fa fa-check"></i> Access Tutorials, eBooks and Courses</h3>
                
                    <h3 class="lead"><i class="fa fa-check"></i> Personal Development as a Software Engineer</h3>
                
            </div>
            <div class="col-md-12">
                <p class="text-center">
                    



<div id="mc_embed_signup">
    <form
        action="https://www.getrevue.co/profile/rwieruch/add_subscriber"
        method="post"
        id="revue-form"
        name="revue-form"
        target="_blank">
        <div id="mc_embed_signup_scroll">
            <input
                class="email"
                placeholder="email address"
                type="email"
                name="member[email]"
                id="member_email"
            >
            <div>
                <button
                    type="submit"
                    value="Subscribe"
                    name="member[subscribe]"
                    id="member_submit"
                    class="btn btn-template-transparent-black btn-lg"
                >
                    Subscribe
                </button>
            </div>
        </div>
    </form>
</div>

                </p>
            </div>
        </div>
    </div>
</section>




        <footer id="subfooter">
    <div class="container">

        <div class="col-md-5 col-sm-6">

            <h4>Recent posts</h4>

            <div class="blog-entries">
                
                <div class="item same-height-row clearfix">
                    <div class="article same-height-always">
                        <a href="../redux-vs-usereducer/index.html">
                          
                            <img
                                data-lazy-src="//img/posts/redux-vs-usereducer/banner.jpg"
                                data-is-thumb="is-thumb"
                                class="img-lazy img-responsive"
                                alt="React&#39;s useReducer vs Redux"
                            >
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="../redux-vs-usereducer/index.html">React&#39;s useReducer vs Redux</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="article same-height-always">
                        <a href="../publish-npm-package-node/index.html">
                          
                            <img
                                data-lazy-src="//img/posts/publish-npm-package-node/banner.jpg"
                                data-is-thumb="is-thumb"
                                class="img-lazy img-responsive"
                                alt="How to publish a npm package?"
                            >
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="../publish-npm-package-node/index.html">How to publish a npm package?</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="article same-height-always">
                        <a href="../react-scroll-to-item/index.html">
                          
                            <img
                                data-lazy-src="//img/posts/react-scroll-to-item/banner.jpg"
                                data-is-thumb="is-thumb"
                                class="img-lazy img-responsive"
                                alt="How to Scroll to Item in React?"
                            >
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="../react-scroll-to-item/index.html">How to Scroll to Item in React?</a></h5>
                    </div>
                </div>
                
            </div>

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        

        
        <div class="col-md-5 col-md-offset-2 col-sm-6">

            <h4>About Me</h4>

            <div class="blog-entries">
                <div class="item same-height-row clearfix">
                    <div class="profile same-height-always">
                        <img
                            class="img-lazy img-responsive"
                            data-lazy-src="//img/page/profile.jpg"
                            alt="profile"
                        >
                    </div>
                    <div class="name same-height-always">
                        <p>
                            Hi, I'm Chris - a German and Remote/Berlin based consulting software engineer. Find out more <a href="../about/index.html">about me</a>, <a href="../work-with-me/index.html">work with me</a>, or have a look at my social media profiles below.
                        </p>
                    </div>
                </div>
            </div>

        </div>
        
        

    </div>
    
</footer>






        <footer id="copyright">
  <div class="container">
    <div class="row">
      <div class="col-md-4">
        <ul class="info list-inline quicklinks pull-left">
          
            <li> Chris Paul</li>
          
        </ul>
      </div>
      <div class="col-md-4">
        <ul class="list-inline footer-social-buttons text-center">
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.twitter.com/rwieruch"><i class="fa fa-twitter"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.github.com/rwieruch"><i class="fa fa-github"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.linkedin.com/in/chris-wieruch-971933a6"><i class="fa fa-linkedin"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.producthunt.com/@rwieruch"><i class="fa fa-product-hunt"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.patreon.com/rwieruch"><i class="fa fa-paw"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.paypal.me/rwieruch"><i class="fa fa-paypal"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.facebook.com/rwieruch"><i class="fa fa-facebook"></i></a></li>
          
            <li><a target="_blank" rel="noopener noreferrer" aria-label="social-media" href="https://www.instagram.com/rwieruch/"><i class="fa fa-instagram"></i></a></li>
          
        </ul>
      </div>
      <div class="col-md-4">
        <ul class="info list-inline quicklinks pull-right">
          
            <li><a aria-label="quicklinks" href="../legal/index.html">Legal Notice</a></li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>


    </div>
    

    

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>









<script src="../js/script.js"></script>



  </body>
</html>
