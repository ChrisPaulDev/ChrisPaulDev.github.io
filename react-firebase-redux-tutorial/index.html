<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">



  <title>
    How to use Redux in React Firebase - CPaul
  </title>

  <meta name="author" content="" />
  <meta name="description"
    content="The tutorial shows you how to migrate a React with Firebase application, which uses only React&#39;s local state, to Redux for its state management. Also React&#39;s Context API is replaced with Redux ...">


  <meta name="theme-color" content="#38bb6c" />

  <meta name="generator" content="Hugo 0.41" />
  <link href="https://cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <link href="../css/bootstrap.default.css" rel="stylesheet" id="theme-stylesheet">
  <link href="../css/customizations.css" rel="stylesheet">

  <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  <link rel="shortcut icon" href="../img/favicon/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="../img/favicon/apple-touch-icon.png" />
  <link rel="manifest" href="../img/favicon/manifest.json">
  <link rel="mask-icon" href="../img/favicon/safari-pinned-tab.svg" color="#5bbad5">

  <link rel="alternate" href="../index.xml" type="application/rss+xml" title="CPaul">

  <meta itemprop="name" content="How to use Redux in React Firebase">
  <meta itemprop="description"
    content="The tutorial shows you how to migrate a React with Firebase application, which uses only React&#39;s local state, to Redux for its state management. Also React&#39;s Context API is replaced with Redux ...">
  <meta itemprop="image" content="https://chrispaul.dev/img/posts/react-firebase-redux-tutorial/banner_640.jpg">
  <meta itemprop="keywords"
    content="angular,apollo,d3,graphql,growth,javascript,machine-learning,mobx,node,react,reason,redux,tooling,vue,web-development,angular,apollo,d3,graphql,growth,javascript,machine-learning,mobx,node,react,reason,redux,tooling,web-development," />


  <meta itemprop="wordCount" content="3685">

  <meta name="keywords" content="react firebase redux tutorial">

  <meta property="og:title" content="How to use Redux in React Firebase - CPaul">


  <meta property="og:description"
    content="The tutorial shows you how to migrate a React with Firebase application, which uses only React&#39;s local state, to Redux for its state management. Also React&#39;s Context API is replaced with Redux ..." />


  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://chrispaul.dev/react-firebase-redux-tutorial/" />
  <meta property="og:image" content="https://chrispaul.dev/img/posts/react-firebase-redux-tutorial/banner_640.jpg" />



  <meta name="news_keywords" content="react firebase redux tutorial" />



  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image:src"
    content="https://chrispaul.dev/img/posts/react-firebase-redux-tutorial/banner_640.jpg" />
  <meta name="twitter:title" content="How to use Redux in React Firebase" />
  <meta name="twitter:description"
    content="The tutorial shows you how to migrate a React with Firebase application, which uses only React&#39;s local state, to Redux for its state management. Also React&#39;s Context API is replaced with Redux ..." />
  <meta name="twitter:site" content="@rwieruch" />
  <meta name="twitter:domain" content="rwieruch" />



</head>


<body>

  <div id="all">

    <header>

      <div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

        <div class="navbar navbar-default yamm" role="navigation" id="navbar">

          <div class="container">
            <div class="navbar-header">
              <a class="navbar-brand home" href="../index.html">
                <img src="../img/page/logo.svg" alt="How to use Redux in React Firebase logo" class="img-lazy">
                <span class="sr-only">How to use Redux in React Firebase - go to homepage</span>
              </a>

              <div class="navbar-buttons">
                <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse"
                  data-target="#navigation">
                  <span class="sr-only">Toggle navigation</span>
                  <i class="fa fa-align-justify"></i>
                </button>
              </div>
            </div>


            <div class="navbar-collapse collapse" id="navigation">
              <ul class="nav navbar-nav navbar-right">

                <li class="dropdown">

                  <a href="../index.html">Blog</a>

                </li>

                <li class="dropdown">

                  <a href="../work-with-me/index.html">Work with me</a>

                </li>

                <li class="dropdown">

                  <a href="../about/index.html">About</a>

                </li>

                <li class="dropdown">

                  <a style="color: #38bb6c" href="https://roadtoreact.com/">Books &amp; Courses</a>

                </li>

              </ul>
            </div>


            <div class="collapse clearfix" id="search">

              <form class="navbar-form" role="search">
                <div class="input-group">
                  <input type="text" class="form-control" placeholder="Search">
                  <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>

                  </span>
                </div>
              </form>

            </div>


          </div>
        </div>


      </div>
    </header>

    

    



    <div class="hidden-xs">


      <section class="bar background-image-fixed-2 no-mb color-white text-center">
        <div class="dark-mask"></div>
        <div class="container">
          <div class="row">
            <div class="col-md-12">
              <h3 class="lead">Never miss an article about web development, JavaScript and self-growth.</h3>
              <h2 class="text-uppercase newsletter">Take Part</h2>
            </div>

            <div class="col-md-12">
              <p class="text-center">
                <div id="mc_embed_signup">
                  <form action="https://www.getrevue.co/profile/rwieruch/add_subscriber" method="post" id="revue-form"
                    name="revue-form" target="_blank">
                    <div id="mc_embed_signup_scroll">
                      <input class="email" placeholder="email address" type="email" name="member[email]"
                        id="member_email">
                      <div>
                        <button type="submit" value="Subscribe" name="member[subscribe]" id="member_submit"
                          class="btn btn-template-transparent-black btn-lg">
                          Subscribe
                        </button>
                      </div>
                    </div>
                  </form>
                </div>

              </p>
            </div>
          </div>
        </div>
      </section>
    </div>

    <div id="content">
      <div class="container">

        <div class="row">

          <article class="col-md-8 col-md-offset-2" id="blog-post" itemprop="blogPosts" itemscope
            itemtype="http://schema.org/BlogPosting">

            <div id="post-content" itemprop="articleBody">

              <header>
                <h1 itemprop="name headline">How to use Redux in React Firebase</h1>
              </header>

              

              <p class="text-muted text-uppercase mb-small text-center">
                <span itemprop="author publisher">

                </span>


                <time datetime="2019-02-10" itemprop="datePublished">
                  February 10, 2019
                </time>



                <span class="hidden-xs hidden-sm"> - <a target="_blank" rel="noopener noreferrer"
                    href="https://github.com/rwieruch/blog_chriswieruch_content/blob/master/react-firebase-redux-tutorial.md">
                    Edit this Post on GitHub
                  </a>
                </span>

              </p>



              <div>


              </div>

              <div class="post-image-primary">
                <div class="pinterest-pinner-wrapper" itemscope itemtype="http://schema.org/ImageObject">
                  <div class="pinterest-pinner">
                    <a data-pin-do="buttonPin" data-pin-save="true" data-pin-tall="true"
                      href="https://www.pinterest.com/pin/create/button/?url=https%3a%2f%2fchrispaul.dev%2freact-firebase-redux-tutorial%2f&amp;media=https://chrispaul.dev/img%2fposts%2freact-firebase-redux-tutorial%2fbanner.jpg&amp;description=">
                    </a>
                  </div>

                  <img class="img-lazy img-responsive"
                    data-lazy-src="/src="/img/posts/react-firebase-redux-tutorial/banner.jpg"
                    data-is-src-set="is-src-set" alt="react firebase redux tutorial" itemprop="image" />
                </div>
              </div>


              <p>
                <em>
                  Interested in reading this tutorial as one of many chapters in my advanced React with Firebase book?
                  Checkout the entire <a href="https://roadtoreact.com">The Road to React with Firebase</a> book that
                  teaches you to create business web applications without the need to create a backend application with
                  a database yourself.
                </em>
              </p>

              <div class="read-before">
                <p>This tutorial is part 10 of 10 in this series.</p>
                <div>Part 1: <a href="../complete-firebase-authentication-react-tutorial/index.html" itemprop="url">A
                    Firebase in React Tutorial for Beginners</a></div>
                <div>Part 2: <a href="../react-firebase-authorization-roles-permissions/index.html" itemprop="url">React
                    Firebase Authorization with Roles</a></div>
                <div>Part 3: <a href="../react-firebase-auth-persistence/index.html" itemprop="url">React Firebase Auth
                    Persistence with Local Storage</a></div>
                <div>Part 4: <a href="../react-firebase-social-login/index.html" itemprop="url">React Firebase Social
                    Login: Google, Facebook, Twitter</a></div>
                <div>Part 5: <a href="../react-firebase-link-social-logins/index.html" itemprop="url">React Firebase:
                    Link Social Logins</a></div>
                <div>Part 6: <a href="../react-firebase-email-verification/index.html" itemprop="url">React Firebase:
                    Email Verification</a></div>
                <div>Part 7: <a href="../react-firebase-router/index.html" itemprop="url">How to use React Router with
                    Firebase</a></div>
                <div>Part 8: <a href="../react-firebase-realtime-database/index.html" itemprop="url">How to use Firebase
                    Realtime Database in React</a></div>
                <div>Part 9: <a href="../firebase-deploy-react-js/index.html" itemprop="url">How to deploy a React
                    application to Firebase</a></div>
              </div>

              <p>The previous tutorial series covered a lot of ground for Firebase in React. So far, it was fine to rely
                only on React&rsquo;s local state and React&rsquo;s Context API. This tutorial dives into using Redux on
                top of React and Firebase for state management. You will exchange React&rsquo;s local state (e.g. users
                on admin page, messages on home page) and React&rsquo;s context (e.g. session management for
                authenticated user) with Redux. It will show you how to accomplish the same thing with Redux in case you
                want to integrate it into a tech stack.</p>

              <p>This section is divided into two parts, the first of which will set up Redux. You will add the state
                layer separately from the view layer. Afterward, you will connect Redux with React by providing the
                Redux store with React&rsquo;s Context API to your React components. The second part exchanges the
                current React state layer with the Redux state layer:</p>

              <ul>
                <li>Authenticated User in React Local State + React Context -&gt; Authenticated User in Redux Store.
                </li>
                <li>Users in React Local State -&gt; Users in Redux Store.</li>
                <li>Messages in React Local State -&gt; Messages in Redux Store.</li>
              </ul>

              <p>If you are not familiar with Redux, I recommend to check out <a target="_blank"
                  rel="noopener noreferrer" href="http://roadtoreact.com">Taming the State in React</a>. Most of the
                Redux knowledge about Actions, Reducers, and the Store are required for the following migration from
                only using React to Redux.</p>

              <h2 class="chapter-header" id="react-firebase-redux-setup">Redux Setup in React Firebase Application</h2>

              <p>Let&rsquo;s get started by installing <a target="_blank" rel="noopener noreferrer"
                  href="https://redux.js.org/">redux</a> and <a target="_blank" rel="noopener noreferrer"
                  href="https://github.com/reactjs/react-redux">react-redux</a> on the command line:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #06b6ef">npm</span> <span style="color: #06b6ef">install</span> <span style="color: #06b6ef">redux</span> <span style="color: #06b6ef">react</span><span style="color: #5bc4bf">-</span><span style="color: #06b6ef">redux</span>
</code></pre>
              </div>


              <p>We focus on the Redux setup without worrying about Firebase or React. First is the Redux store
                implementation. Create a folder and file for it using the <em>src/</em> folder type:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #06b6ef">mkdir</span> <span style="color: #06b6ef">store</span>
<span style="color: #06b6ef">cd</span> <span style="color: #06b6ef">store</span>
<span style="color: #06b6ef">touch</span> <span style="color: #06b6ef">index</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">js</span>
</code></pre>
              </div>


              <p>Second, add the store in the new file as singleton instance, because there should be only one Redux
                store. The store creation takes a root reducer which isn&rsquo;t defined.</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">createStore</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;redux&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">rootReducer</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../reducers&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">store</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">createStore</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">rootReducer</span><span style="color: #e7e9db">);</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">store</span><span style="color: #e7e9db">;</span>
</code></pre>
              </div>


              <p>Third, create a dedicated module for the reducers. There&rsquo;s a reducer for the session state (e.g.
                authenticated user) and reducers for the user and message states (e.g. list of users and messages from
                the Firebase realtime database). There&rsquo;s an entry point file to the module to combine those
                reducers as root reducer to pass it to the Redux store, like the previous step. Again, from your
                <em>src/</em> folder type:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #06b6ef">mkdir</span> <span style="color: #06b6ef">reducers</span>
<span style="color: #06b6ef">cd</span> <span style="color: #06b6ef">reducers</span>
<span style="color: #06b6ef">touch</span> <span style="color: #06b6ef">index</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">js</span> <span style="color: #06b6ef">session</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">js</span> <span style="color: #06b6ef">user</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">js</span> <span style="color: #06b6ef">message</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">js</span>
</code></pre>
              </div>


              <p>First, add the session reducer which manages the <code>authUser</code> object. The authenticated user
                represents the session in the application. The reducer deals only with one incoming action which either
                sets the <code>authUser</code> to the actual authenticated user or <code>null</code>:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">const</span> <span style="color: #06b6ef">INITIAL_STATE</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">authUser</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">null</span><span style="color: #e7e9db">,</span>
<span style="color: #e7e9db">};</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">applySetAuthUser</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
  <span style="color: #e7e9db">...</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">authUser</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">,</span>
<span style="color: #e7e9db">});</span>

<span style="color: #815ba4">function</span> <span style="color: #06b6ef">sessionReducer</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">INITIAL_STATE</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">switch</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">action</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">type</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">case</span> <span style="color: #48b685">&#39;AUTH_USER_SET&#39;</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">return</span> <span style="color: #06b6ef">applySetAuthUser</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">);</span>
    <span style="color: #e7e9db">}</span>
    <span style="color: #815ba4">default</span><span style="color: #5bc4bf">:</span>
      <span style="color: #815ba4">return</span> <span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">sessionReducer</span><span style="color: #e7e9db">;</span>
</code></pre>
              </div>


              <p>The user reducer deals with the list of users from the Firebase realtime database. It sets either the
                whole object of users as dictionary, or a single user identified by a unique identifier:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">const</span> <span style="color: #06b6ef">INITIAL_STATE</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">users</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">null</span><span style="color: #e7e9db">,</span>
<span style="color: #e7e9db">};</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">applySetUsers</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
  <span style="color: #e7e9db">...</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">users</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">,</span>
<span style="color: #e7e9db">});</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">applySetUser</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
  <span style="color: #e7e9db">...</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">users</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span>
    <span style="color: #e7e9db">...</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">,</span>
    <span style="color: #e7e9db">[</span><span style="color: #06b6ef">action</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">]</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">,</span>
  <span style="color: #e7e9db">},</span>
<span style="color: #e7e9db">});</span>

<span style="color: #815ba4">function</span> <span style="color: #06b6ef">userReducer</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">INITIAL_STATE</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">switch</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">action</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">type</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">case</span> <span style="color: #48b685">&#39;USERS_SET&#39;</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">return</span> <span style="color: #06b6ef">applySetUsers</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">);</span>
    <span style="color: #e7e9db">}</span>
    <span style="color: #815ba4">case</span> <span style="color: #48b685">&#39;USER_SET&#39;</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">return</span> <span style="color: #06b6ef">applySetUser</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">);</span>
    <span style="color: #e7e9db">}</span>
    <span style="color: #815ba4">default</span><span style="color: #5bc4bf">:</span>
      <span style="color: #815ba4">return</span> <span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">userReducer</span><span style="color: #e7e9db">;</span>
</code></pre>
              </div>


              <p>The message reducer deals with the list of messages from the Firebase realtime database. Again, it sets
                the whole object of messages as dictionary, but also a limit for the pagination feature we implemented
                earlier:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">const</span> <span style="color: #06b6ef">INITIAL_STATE</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">null</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">limit</span><span style="color: #5bc4bf">:</span> <span style="color: #f99b15">5</span><span style="color: #e7e9db">,</span>
<span style="color: #e7e9db">};</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">applySetMessages</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
  <span style="color: #e7e9db">...</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">,</span>
<span style="color: #e7e9db">});</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">applySetMessagesLimit</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
  <span style="color: #e7e9db">...</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">limit</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">limit</span><span style="color: #e7e9db">,</span>
<span style="color: #e7e9db">});</span>

<span style="color: #815ba4">function</span> <span style="color: #06b6ef">messageReducer</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">INITIAL_STATE</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">switch</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">action</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">type</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">case</span> <span style="color: #48b685">&#39;MESSAGES_SET&#39;</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">return</span> <span style="color: #06b6ef">applySetMessages</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">);</span>
    <span style="color: #e7e9db">}</span>
    <span style="color: #815ba4">case</span> <span style="color: #48b685">&#39;MESSAGES_LIMIT_SET&#39;</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">return</span> <span style="color: #06b6ef">applySetMessagesLimit</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">action</span><span style="color: #e7e9db">);</span>
    <span style="color: #e7e9db">}</span>
    <span style="color: #815ba4">default</span><span style="color: #5bc4bf">:</span>
      <span style="color: #815ba4">return</span> <span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">messageReducer</span><span style="color: #e7e9db">;</span>
</code></pre>
              </div>


              <p>Finally, combine all reducers into a root reducer in the <em>src/reducers/index.js</em> file to make it
                accessible for the store creation:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">combineReducers</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;redux&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">sessionReducer</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./session&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">userReducer</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./user&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">messageReducer</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./message&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">rootReducer</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">combineReducers</span><span style="color: #e7e9db">({</span>
  <span style="color: #06b6ef">sessionState</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">sessionReducer</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">userState</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">userReducer</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">messageState</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">messageReducer</span><span style="color: #e7e9db">,</span>
<span style="color: #e7e9db">});</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">rootReducer</span><span style="color: #e7e9db">;</span>
</code></pre>
              </div>


              <p>You have passed the root reducer with all its reducers to the Redux store creation, so the Redux setup
                is done. Now you can connect your state layer with your view layer. The Redux store can be provided for
                the component hierarchy using Redux&rsquo;s Provider component. This time, the Provider component from
                the Redux library passes down the whole store instead of only the authenticated user. In
                <em>src/index.js</em> file:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">ReactDOM</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-dom&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Provider</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-redux&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #06b6ef">store</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./store&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">App</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./components/App&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">Firebase</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">FirebaseContext</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./components/Firebase&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #06b6ef">ReactDOM</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">render</span><span style="color: #e7e9db">(</span>
<span style="background-color: #4f424c">  <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Provider</span> <span style="color: #06b6ef">store</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">store</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span>
</span>    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">FirebaseContext</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Provider</span> <span style="color: #06b6ef">value</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">new</span> <span style="color: #06b6ef">Firebase</span><span style="color: #e7e9db">()}</span><span style="color: #5bc4bf">&gt;</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">App</span> <span style="color: #5bc4bf">/&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/FirebaseContext.Provider&gt;</span>
<span style="background-color: #4f424c">  <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/Provider&gt;,</span>
</span>  <span style="color: #e7e9db">document.</span><span style="color: #06b6ef">getElementById</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;root&#39;</span><span style="color: #e7e9db">),</span>
<span style="color: #e7e9db">);</span>
</code></pre>
              </div>


              <p>That&rsquo;s it for connecting both worlds, so we&rsquo;ll refactor almost everything from
                React&rsquo;s local state to Redux. We want to have everything in the Redux store that should be
                persisted when we navigate from route to route. This includes users, messages, and the authenticated
                user, but maybe not the loading states.</p>

              <h3 id="exercises">Exercises:</h3>

              <ul>
                <li>Confirm your <a target="_blank" rel="noopener noreferrer" href="http://bit.ly/2VplHuW">source code
                    for the last section</a>.</li>
              </ul>

              <h2 class="chapter-header" id="firebase-authenticated-user-redux-store">Manage Firebase&#39;s
                authenticated User in Redux Store</h2>

              <p>We are managing the authenticated user with React&rsquo;s Context API. We provide the authenticated
                user in a Provider component and consume it wherever we want with a Consumer component. Let&rsquo;s
                change this by storing the authenticated user in the Redux store instead and connecting all components
                that are interested in it to the Redux store. In the authentication higher-order component, we make the
                dispatchable action that stores the authenticated user in the Redux store, which is available as
                function in the props of the connected component:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">connect</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-redux&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">withAuthentication</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">Component</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">class</span> <span style="color: #06b6ef">WithAuthentication</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
    <span style="color: #e7e9db">...</span>
  <span style="color: #e7e9db">}</span>

<span style="background-color: #4f424c">  <span style="color: #815ba4">const</span> <span style="color: #06b6ef">mapDispatchToProps</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">dispatch</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">onSetAuthUser</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">dispatch</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;AUTH_USER_SET&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">authUser</span> <span style="color: #e7e9db">}),</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">});</span>
</span>
<span style="background-color: #4f424c">  <span style="color: #815ba4">return</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
</span>    <span style="color: #06b6ef">withFirebase</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">    <span style="color: #06b6ef">connect</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">      <span style="color: #815ba4">null</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">mapDispatchToProps</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">),</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">)(</span><span style="color: #06b6ef">WithAuthentication</span><span style="color: #e7e9db">);</span>
</span><span style="color: #e7e9db">};</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">withAuthentication</span><span style="color: #e7e9db">;</span>
</code></pre>
              </div>


              <p>Next, use the function to set the authenticated user in the Redux store by setting it to React&rsquo;s
                local state like before. We don&rsquo;t need to provide the authenticated user anymore with
                React&rsquo;s Context Provider component, because it will be available for every component that connects
                to the store:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">const</span> <span style="color: #06b6ef">withAuthentication</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">Component</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">class</span> <span style="color: #06b6ef">WithAuthentication</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
    <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">super</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">);</span>

<span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onSetAuthUser</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">        <span style="color: #06b6ef">JSON</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">parse</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">localStorage</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">getItem</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;authUser&#39;</span><span style="color: #e7e9db">)),</span>
</span><span style="background-color: #4f424c">      <span style="color: #e7e9db">);</span>
</span>    <span style="color: #e7e9db">}</span>

    <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">listener</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onAuthUserListener</span><span style="color: #e7e9db">(</span>
        <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
          <span style="color: #06b6ef">localStorage</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setItem</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;authUser&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">JSON</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">stringify</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">));</span>
<span style="background-color: #4f424c">          <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onSetAuthUser</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">);</span>
</span>        <span style="color: #e7e9db">},</span>
        <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
          <span style="color: #06b6ef">localStorage</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">removeItem</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;authUser&#39;</span><span style="color: #e7e9db">);</span>
<span style="background-color: #4f424c">          <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onSetAuthUser</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">null</span><span style="color: #e7e9db">);</span>
</span>        <span style="color: #e7e9db">},</span>
      <span style="color: #e7e9db">);</span>
    <span style="color: #e7e9db">}</span>

    <span style="color: #06b6ef">componentWillUnmount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">listener</span><span style="color: #e7e9db">();</span>
    <span style="color: #e7e9db">}</span>

    <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">      <span style="color: #815ba4">return</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{...</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span><span style="color: #e7e9db">;</span>
</span>    <span style="color: #e7e9db">}</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">};</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">withAuthentication</span><span style="color: #e7e9db">;</span>
</code></pre>
              </div>


              <p>That&rsquo;s it for storing and providing the authenticated user for the Redux store. Let&rsquo;s see
                how we can consume it in the Navigation component for the conditional rendering of the routes without
                React&rsquo;s Context, and with the Redux store instead:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Link</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-router-dom&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">connect</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-redux&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">SignOutButton</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../SignOut&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">as</span> <span style="color: #06b6ef">ROUTES</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../../constants/routes&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">as</span> <span style="color: #06b6ef">ROLES</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../../constants/roles&#39;</span><span style="color: #e7e9db">;</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">Navigation</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">({</span> <span style="color: #06b6ef">authUser</span> <span style="color: #e7e9db">})</span> <span style="color: #5bc4bf">=&gt;</span>
</span>  <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">?</span> <span style="color: #e7e9db">(</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">NavigationAuth</span> <span style="color: #06b6ef">authUser</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span>
  <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">(</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">NavigationNonAuth</span> <span style="color: #5bc4bf">/&gt;</span>
  <span style="color: #e7e9db">);</span>

<span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">mapStateToProps</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">authUser</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">sessionState</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">});</span>
</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">connect</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">mapStateToProps</span><span style="color: #e7e9db">)(</span><span style="color: #06b6ef">Navigation</span><span style="color: #e7e9db">);</span>
</span></code></pre>
              </div>


              <p>We can do the same in our other components that are interested in the authenticated user. For instance,
                the authorization higher-order component can rely on the Redux store as well:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withRouter</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-router-dom&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">connect</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-redux&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">as</span> <span style="color: #06b6ef">ROUTES</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../../constants/routes&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">withAuthorization</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">condition</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #06b6ef">Component</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">class</span> <span style="color: #06b6ef">WithAuthorization</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
    <span style="color: #e7e9db">...</span>

    <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">      <span style="color: #815ba4">return</span> <span style="color: #06b6ef">condition</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">?</span> <span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{...</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span>
</span><span style="background-color: #4f424c">      <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">:</span> <span style="color: #815ba4">null</span><span style="color: #e7e9db">;</span>
</span>    <span style="color: #e7e9db">}</span>
  <span style="color: #e7e9db">}</span>

<span style="background-color: #4f424c">  <span style="color: #815ba4">const</span> <span style="color: #06b6ef">mapStateToProps</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">authUser</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">sessionState</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">});</span>
</span>
  <span style="color: #815ba4">return</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
    <span style="color: #06b6ef">withRouter</span><span style="color: #e7e9db">,</span>
    <span style="color: #06b6ef">withFirebase</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">    <span style="color: #06b6ef">connect</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">mapStateToProps</span><span style="color: #e7e9db">),</span>
</span>  <span style="color: #e7e9db">)(</span><span style="color: #06b6ef">WithAuthorization</span><span style="color: #e7e9db">);</span>
<span style="color: #e7e9db">};</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">withAuthorization</span><span style="color: #e7e9db">;</span>
</code></pre>
              </div>


              <p>Also, our other authorization component for the email verification can make use of it:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">connect</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-redux&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #e7e9db">...</span>

<span style="color: #815ba4">const</span> <span style="color: #06b6ef">withEmailVerification</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">Component</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
  <span style="color: #815ba4">class</span> <span style="color: #06b6ef">WithEmailVerification</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
    <span style="color: #e7e9db">...</span>

    <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">      <span style="color: #815ba4">return</span> <span style="color: #06b6ef">needsEmailVerification</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">?</span> <span style="color: #e7e9db">(</span> <span style="color: #e7e9db">...</span> <span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{...</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span>
</span><span style="background-color: #4f424c">      <span style="color: #e7e9db">);</span>
</span>    <span style="color: #e7e9db">}</span>
  <span style="color: #e7e9db">}</span>

<span style="background-color: #4f424c">  <span style="color: #815ba4">const</span> <span style="color: #06b6ef">mapStateToProps</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">authUser</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">sessionState</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">});</span>
</span>
<span style="background-color: #4f424c">  <span style="color: #815ba4">return</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
</span>    <span style="color: #06b6ef">withFirebase</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">    <span style="color: #06b6ef">connect</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">mapStateToProps</span><span style="color: #e7e9db">),</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">)(</span><span style="color: #06b6ef">WithEmailVerification</span><span style="color: #e7e9db">);</span>
</span><span style="color: #e7e9db">};</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">withEmailVerification</span><span style="color: #e7e9db">;</span>
</code></pre>
              </div>


              <p>And last but not least, the AccountPage component which displays the authenticated user but also
                renders the component that manages all the sign in methods for the user:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">connect</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-redux&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withAuthorization</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">withEmailVerification</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Session&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">PasswordForgetForm</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../PasswordForget&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">PasswordChangeForm</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../PasswordChange&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">AccountPage</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">({</span> <span style="color: #06b6ef">authUser</span> <span style="color: #e7e9db">})</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
</span>  <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">h1</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Account</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">{</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">email</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/h1&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">PasswordForgetForm</span> <span style="color: #5bc4bf">/&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">PasswordChangeForm</span> <span style="color: #5bc4bf">/&gt;</span>
    <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">LoginManagement</span> <span style="color: #06b6ef">authUser</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">/&gt;</span>
  <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
<span style="color: #e7e9db">);</span>

<span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">mapStateToProps</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">authUser</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">sessionState</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">});</span>
</span>
<span style="color: #815ba4">const</span> <span style="color: #06b6ef">condition</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">authUser</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #5bc4bf">!!</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">connect</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">mapStateToProps</span><span style="color: #e7e9db">),</span>
</span>  <span style="color: #06b6ef">withEmailVerification</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">withAuthorization</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">condition</span><span style="color: #e7e9db">),</span>
<span style="color: #e7e9db">)(</span><span style="color: #06b6ef">AccountPage</span><span style="color: #e7e9db">);</span>
</code></pre>
              </div>


              <p>Now you can remove the React Context for providing and consuming the authenticated user in the
                <em>src/components/Session/context.js</em> and <em>src/components/Session/index.js</em> files:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">withAuthentication</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./withAuthentication&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">withAuthorization</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./withAuthorization&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">withEmailVerification</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./withEmailVerification&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">export</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">withAuthentication</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">withAuthorization</span><span style="color: #e7e9db">,</span>
  <span style="color: #06b6ef">withEmailVerification</span><span style="color: #e7e9db">,</span>
<span style="color: #e7e9db">};</span>
</code></pre>
              </div>


              <p>That&rsquo;s it for storing the authenticated user in the Redux store, which takes place in the
                authentication higher-order component and for consuming the authenticated user in every component which
                is interested in it by connecting the Redux store.</p>

              <h3 id="exercises-1">Exercises:</h3>

              <ul>
                <li>Confirm your <a target="_blank" rel="noopener noreferrer" href="http://bit.ly/2VpQLL8">source code
                    for the last section</a>.</li>
              </ul>

              <h2 class="chapter-header" id="firebase-users-redux-store">Manage Firebase&#39;s Users in Redux Store</h2>

              <p>We implemented the session management with the authenticated user with Redux instead of React&rsquo;s
                local state and context API. Next, we will migrate the user management over to Redux. The users are
                mainly used in the AdminPage component&rsquo;s UserList and UserItem components. Our goal here is to
                navigate from UserList to UserItem and back with React Router without losing the state of the users. The
                UserList component fetches and shows a list of users, while the UserItem component fetches and shows a
                single user entity. If the data is already available in the Redux store, we only keep track of new data
                with the realtime feature of the Firebase database, starting with the UserList component:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Link</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-router-dom&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">connect</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-redux&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #5bc4bf">*</span> <span style="color: #06b6ef">as</span> <span style="color: #06b6ef">ROUTES</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../../constants/routes&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">class</span> <span style="color: #06b6ef">UserList</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">mapStateToProps</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">users</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">Object.</span><span style="color: #06b6ef">keys</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userState</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span> <span style="color: #5bc4bf">||</span> <span style="color: #e7e9db">{}).</span><span style="color: #06b6ef">map</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">key</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">...</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userState</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">[</span><span style="color: #06b6ef">key</span><span style="color: #e7e9db">],</span>
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">uid</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">key</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">})),</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">});</span>
</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">mapDispatchToProps</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">dispatch</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">onSetUsers</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">users</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #06b6ef">dispatch</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;USERS_SET&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">users</span> <span style="color: #e7e9db">}),</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">});</span>
</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
</span>  <span style="color: #06b6ef">withFirebase</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">connect</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">mapStateToProps</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">mapDispatchToProps</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">),</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">)(</span><span style="color: #06b6ef">UserList</span><span style="color: #e7e9db">);</span>
</span></code></pre>
              </div>


              <p>React Redux&rsquo;s connect higher-order component is used to marry React with Redux. We can tell what
                state of Redux should be mapped to props for the React component in the <code>mapStateToProps</code>
                function, and we can pass dispatchable Redux actions as functions to the React component as props with
                the <code>mapDispatchToProps</code> function. In our case, we are interested in a user object that
                encapsulates all users in the Redux store. We transform this user object&ndash;which is the Firebase
                representation of all users&ndash;into an array, to make it easier for us to render them. The point is
                to dispatch an action that sets the user object as state in the Redux store. Check t he
                <em>src/reducers/user.js</em> to see how our reducer deals with this action. Both <code>users</code> and
                <code>onSetUsers</code> are received as props in the UserList component.</p>

              <p>Next, make sure the users are fetched from Firebase&rsquo;s realtime database and persisted in the
                Redux store with our new dispatchable action:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">UserList</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">().</span><span style="color: #06b6ef">on</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onSetUsers</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">snapshot</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">val</span><span style="color: #e7e9db">());</span>
</span>    <span style="color: #e7e9db">});</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #06b6ef">componentWillUnmount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">().</span><span style="color: #06b6ef">off</span><span style="color: #e7e9db">();</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre>
              </div>


              <p>Each time the Firebase listener is called, or when a user was added, edited, or removed from the list,
                the most recent user object that has all users from Firebase is stored with the
                <code>onSetUsers()</code> function to the Redux store. Another UX improvement is the loading indicator
                when there are no users in the Redux store. Every other time, when there are users in the store but the
                Firebase listener is updating the Redux store with a new user object, no loading indicator is shown:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">UserList</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">super</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">);</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">};</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">}</span>
</span>
  <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #5bc4bf">!</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">length</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">true</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">}</span>
</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">().</span><span style="color: #06b6ef">on</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onSetUsers</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">snapshot</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">val</span><span style="color: #e7e9db">());</span>

<span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span> <span style="color: #e7e9db">});</span>
</span>    <span style="color: #e7e9db">});</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre>
              </div>


              <p>The users are no longer managed in the local state of the component, but are now handled in Redux. You
                set the users with a dispatchable action from <code>mapDispatchToProps</code> and access them again in
                <code>mapStateToProps</code>. Both state and actions are passed as props to your component.</p>

              <p>The users and loading indicator are rendered as before, but only the loading state comes from the local
                state. The Link component only navigates to the UserItem component, but it doesn&rsquo;t send any user
                objects. We wanted the user at our disposal via the Link component, and we want to let Redux handle it.
              </p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">UserList</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">users</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">;</span>
</span>    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">loading</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>

    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">h2</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Users</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/h2&gt;</span>
        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">loading</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Loading</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;}</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">ul</span><span style="color: #5bc4bf">&gt;</span>
          <span style="color: #e7e9db">{</span><span style="color: #06b6ef">users</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">map</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">user</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">(</span>
            <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">li</span> <span style="color: #06b6ef">key</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">span</span><span style="color: #5bc4bf">&gt;</span>
                <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">strong</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">ID</span><span style="color: #5bc4bf">:&lt;</span><span style="color: #ef6155">/strong&gt; {user.uid}</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/span&gt;</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">span</span><span style="color: #5bc4bf">&gt;</span>
                <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">strong</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">E</span><span style="color: #5bc4bf">-</span><span style="color: #06b6ef">Mail</span><span style="color: #5bc4bf">:&lt;</span><span style="color: #ef6155">/strong&gt; {user.email}</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/span&gt;</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">span</span><span style="color: #5bc4bf">&gt;</span>
                <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">strong</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Username</span><span style="color: #5bc4bf">:&lt;</span><span style="color: #ef6155">/strong&gt; {user.username}</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/span&gt;</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">span</span><span style="color: #5bc4bf">&gt;</span>
<span style="background-color: #4f424c">                <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">Link</span> <span style="color: #06b6ef">to</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #48b685">`</span><span style="color: #f99b15">${</span><span style="color: #06b6ef">ROUTES</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">ADMIN</span><span style="color: #f99b15">}</span><span style="color: #48b685">/</span><span style="color: #f99b15">${</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">uid</span><span style="color: #f99b15">}</span><span style="color: #48b685">`</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span>
</span>                  <span style="color: #06b6ef">Details</span>
                <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/Link&gt;</span>
              <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/span&gt;</span>
            <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/li&gt;</span>
          <span style="color: #e7e9db">))}</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/ul&gt;</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre>
              </div>


              <p>The UserList component renders a list of users as before, fetches the recent user object, which has all
                users, from Firebase with a realtime connection, but stores the result into the Redux store this time
                instead of React&rsquo;s local state. Let&rsquo;s continue with the UserItem component that shall be
                connected to the Redux store too:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">connect</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-redux&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">class</span> <span style="color: #06b6ef">UserItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">mapStateToProps</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">props</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">user</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">userState</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">users</span> <span style="color: #5bc4bf">||</span> <span style="color: #e7e9db">{})[</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">match</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">params</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">id</span><span style="color: #e7e9db">],</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">});</span>
</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">mapDispatchToProps</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">dispatch</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">onSetUser</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">uid</span><span style="color: #e7e9db">)</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #06b6ef">dispatch</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;USER_SET&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">user</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">uid</span> <span style="color: #e7e9db">}),</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">});</span>
</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
</span>  <span style="color: #06b6ef">withFirebase</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">connect</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">mapStateToProps</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">mapDispatchToProps</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">),</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">)(</span><span style="color: #06b6ef">UserItem</span><span style="color: #e7e9db">);</span>
</span></code></pre>
              </div>


              <p>Similar to the UserList component, it receives a function that is a dispatchable action that sets a
                user instead of users. Check the user reducer to see what&rsquo;s happening when this action is
                dispatched. The component receives a single user from the Redux store. Because the initial state of
                users in the Redux store is null, we have to conditionally choose an empty object for not running into
                null pointer exceptions.</p>

              <p>Let&rsquo;s make sure the user is fetched from Firebase&rsquo;s realtime database and persisted in the
                Redux store with our new dispatchable action.</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">UserItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">match</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">params</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">id</span><span style="color: #e7e9db">)</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">on</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onSetUser</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">          <span style="color: #06b6ef">snapshot</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">val</span><span style="color: #e7e9db">(),</span>
</span><span style="background-color: #4f424c">          <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">match</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">params</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">id</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">        <span style="color: #e7e9db">);</span>
</span>      <span style="color: #e7e9db">});</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre>
              </div>


              <p>When the component mounts, we register Firebase&rsquo;s listener to the realtime database. Every time
                the user changes, we update it in the Redux store. If there is already a user, we don&rsquo;t show a
                loading indicator. If there is no user, we show it:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">UserItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">super</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">);</span>
</span><span style="background-color: #4f424c">
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">};</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">}</span>
</span>
  <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #5bc4bf">!</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">true</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">}</span>
</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">match</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">params</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">id</span><span style="color: #e7e9db">)</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">on</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onSetUser</span><span style="color: #e7e9db">(</span>
          <span style="color: #06b6ef">snapshot</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">val</span><span style="color: #e7e9db">(),</span>
          <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">match</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">params</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">id</span><span style="color: #e7e9db">,</span>
        <span style="color: #e7e9db">);</span>

<span style="background-color: #4f424c">        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span> <span style="color: #e7e9db">});</span>
</span>      <span style="color: #e7e9db">});</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre>
              </div>


              <p>We render the user and loading state as before, except the user comes from the props:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">UserItem</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">onSendPasswordResetEmail</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">doPasswordReset</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">user</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">email</span><span style="color: #e7e9db">);</span>
</span>  <span style="color: #e7e9db">};</span>

  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">user</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">;</span>
</span>    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">loading</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>

    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">h2</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">User</span> <span style="color: #e7e9db">({</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">match</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">params</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">id</span><span style="color: #e7e9db">})</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/h2&gt;</span>
        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">loading</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Loading</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;}</span>

        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">user</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #e7e9db">(</span> <span style="color: #e7e9db">...</span> <span style="color: #e7e9db">)}</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre>
              </div>


              <p>That&rsquo;s it for the UserItem component. It renders a user, fetches the recent user from Firebase
                with a realtime connection, but stores the result into the Redux store. The advantage of using Redux
                instead of React&rsquo;s local state is a persistent state of users between routes. That means you
                don&rsquo;t need to fetch the users every time you navigate from UserItem to UserList or any other
                route, because they remain in Redux&rsquo;s global state.</p>

              <h3 id="exercises-2">Exercises:</h3>

              <ul>
                <li>Confirm your <a target="_blank" rel="noopener noreferrer" href="http://bit.ly/2VqXuVc">source code
                    for the last section</a>.</li>
              </ul>

              <h2 class="chapter-header" id="message-entities-redux-store">Manage Message Entities in Redux Store</h2>

              <p>We migrated the users and session management from React&rsquo;s local state and React&rsquo;s Context
                as well, which is why we have refactored the session management. What&rsquo;s missing is connecting the
                Messages component to the Redux store too in order to store and get messages in and from the Redux
                state:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">import</span> <span style="color: #06b6ef">React</span><span style="color: #e7e9db">,</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react&#39;</span><span style="color: #e7e9db">;</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">connect</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;react-redux&#39;</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c"><span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">compose</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;recompose&#39;</span><span style="color: #e7e9db">;</span>
</span>
<span style="color: #815ba4">import</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">withFirebase</span> <span style="color: #e7e9db">}</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;../Firebase&#39;</span><span style="color: #e7e9db">;</span>
<span style="color: #815ba4">import</span> <span style="color: #06b6ef">MessageList</span> <span style="color: #06b6ef">from</span> <span style="color: #48b685">&#39;./MessageList&#39;</span><span style="color: #e7e9db">;</span>

<span style="color: #815ba4">class</span> <span style="color: #06b6ef">Messages</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>

<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">mapStateToProps</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">authUser</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">sessionState</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">messages</span><span style="color: #5bc4bf">:</span> <span style="color: #e7e9db">Object.</span><span style="color: #06b6ef">keys</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messageState</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">||</span> <span style="color: #e7e9db">{}).</span><span style="color: #06b6ef">map</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">key</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">      <span style="color: #e7e9db">...</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messageState</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">[</span><span style="color: #06b6ef">key</span><span style="color: #e7e9db">],</span>
</span><span style="background-color: #4f424c">      <span style="color: #06b6ef">uid</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">key</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">}),</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">),</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">limit</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">state</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messageState</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">limit</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">});</span>
</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">const</span> <span style="color: #06b6ef">mapDispatchToProps</span> <span style="color: #5bc4bf">=</span> <span style="color: #06b6ef">dispatch</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">({</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">onSetMessages</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">=&gt;</span>
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">dispatch</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;MESSAGES_SET&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">messages</span> <span style="color: #e7e9db">}),</span>
</span><span style="background-color: #4f424c">  <span style="color: #06b6ef">onSetMessagesLimit</span><span style="color: #5bc4bf">:</span> <span style="color: #06b6ef">limit</span> <span style="color: #5bc4bf">=&gt;</span>
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">dispatch</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;MESSAGES_LIMIT_SET&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">limit</span> <span style="color: #e7e9db">}),</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">});</span>
</span>
<span style="background-color: #4f424c"><span style="color: #815ba4">export</span> <span style="color: #815ba4">default</span> <span style="color: #06b6ef">compose</span><span style="color: #e7e9db">(</span>
</span>  <span style="color: #06b6ef">withFirebase</span><span style="color: #e7e9db">,</span>
<span style="background-color: #4f424c">  <span style="color: #06b6ef">connect</span><span style="color: #e7e9db">(</span>
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">mapStateToProps</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">    <span style="color: #06b6ef">mapDispatchToProps</span><span style="color: #e7e9db">,</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">),</span>
</span><span style="background-color: #4f424c"><span style="color: #e7e9db">)(</span><span style="color: #06b6ef">Messages</span><span style="color: #e7e9db">);</span>
</span></code></pre>
              </div>


              <p>The Messages component has access to the authenticated user, which is used for associating the user to
                the written message, the transformed list of messages and the limit integer for the pagination feature.
                Also it receives functions for dispatching actions that set messages and the limit. Check the
                <em>src/reducers/message.js</em> file again to see how the state and the actions are used there. Because
                we are using lots of things from the Redux store, only a couple of properties are left in the local
                state of the component:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">Messages</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #06b6ef">constructor</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">super</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">);</span>

    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">{</span>
      <span style="color: #06b6ef">text</span><span style="color: #5bc4bf">:</span> <span style="color: #48b685">&#39;&#39;</span><span style="color: #e7e9db">,</span>
      <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span><span style="color: #e7e9db">,</span>
    <span style="color: #e7e9db">};</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre>
              </div>


              <p>The Messages component only deals with the loading indicator and the text for the message that can be
                written from within the component as local state. Everything else will be managed with Redux.</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">Messages</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">componentDidMount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #5bc4bf">!</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">length</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">true</span> <span style="color: #e7e9db">});</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">}</span>
</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onListenForMessages</span><span style="color: #e7e9db">();</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #06b6ef">onListenForMessages</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">()</span>
      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">orderByChild</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;createdAt&#39;</span><span style="color: #e7e9db">)</span>
<span style="background-color: #4f424c">      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">limitToLast</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">limit</span><span style="color: #e7e9db">)</span>
</span>      <span style="color: #e7e9db">.</span><span style="color: #06b6ef">on</span><span style="color: #e7e9db">(</span><span style="color: #48b685">&#39;value&#39;</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">snapshot</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onSetMessages</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">snapshot</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">val</span><span style="color: #e7e9db">());</span>
</span>
<span style="background-color: #4f424c">        <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">setState</span><span style="color: #e7e9db">({</span> <span style="color: #06b6ef">loading</span><span style="color: #5bc4bf">:</span> <span style="color: #815ba4">false</span> <span style="color: #e7e9db">});</span>
</span>      <span style="color: #e7e9db">});</span>
  <span style="color: #e7e9db">};</span>

  <span style="color: #06b6ef">componentWillUnmount</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">firebase</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">messages</span><span style="color: #e7e9db">().</span><span style="color: #06b6ef">off</span><span style="color: #e7e9db">();</span>
  <span style="color: #e7e9db">}</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre>
              </div>


              <p>The other logic for creating, updating, and removing a message stays the same, because it only uses the
                Firebase API. The listener of the Firebase database makes sure to update all messages in the Redux store
                again. Only the class method to update the limit uses the function provided by the Redux store:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">Messages</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">onNextPage</span> <span style="color: #5bc4bf">=</span> <span style="color: #e7e9db">()</span> <span style="color: #5bc4bf">=&gt;</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onSetMessagesLimit</span><span style="color: #e7e9db">(</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">limit</span> <span style="color: #5bc4bf">+</span> <span style="color: #f99b15">5</span><span style="color: #e7e9db">);</span>
</span>  <span style="color: #e7e9db">};</span>

  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre>
              </div>


              <p>Every time this state in the Redux store changes, we receive the new limit in the Messages component as
                props due to the connect higher-order component. If the limit changes, we register a new Firebase
                listener with the new limit:</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">Messages</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

<span style="background-color: #4f424c">  <span style="color: #06b6ef">componentDidUpdate</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">if</span> <span style="color: #e7e9db">(</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">limit</span> <span style="color: #5bc4bf">!==</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">limit</span><span style="color: #e7e9db">)</span> <span style="color: #e7e9db">{</span>
</span><span style="background-color: #4f424c">      <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onListenForMessages</span><span style="color: #e7e9db">();</span>
</span><span style="background-color: #4f424c">    <span style="color: #e7e9db">}</span>
</span><span style="background-color: #4f424c">  <span style="color: #e7e9db">}</span>
</span>
  <span style="color: #e7e9db">...</span>
<span style="color: #e7e9db">}</span>
</code></pre>
              </div>


              <p>The rendering of the component didn&rsquo;t change a lot. It only receives the messages from the props
                instead of the local state.</p>

              <div class="highlight" style="background: #2f1e2e">
                <pre style="line-height: 125%"><code class="language-javascript" data-lang="javascript"><span></span><span style="color: #815ba4">class</span> <span style="color: #06b6ef">Messages</span> <span style="color: #815ba4">extends</span> <span style="color: #06b6ef">Component</span> <span style="color: #e7e9db">{</span>
  <span style="color: #e7e9db">...</span>

  <span style="color: #06b6ef">render</span><span style="color: #e7e9db">()</span> <span style="color: #e7e9db">{</span>
<span style="background-color: #4f424c">    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">messages</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">;</span>
</span><span style="background-color: #4f424c">    <span style="color: #815ba4">const</span> <span style="color: #e7e9db">{</span> <span style="color: #06b6ef">text</span><span style="color: #e7e9db">,</span> <span style="color: #06b6ef">loading</span> <span style="color: #e7e9db">}</span> <span style="color: #5bc4bf">=</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">state</span><span style="color: #e7e9db">;</span>
</span>
    <span style="color: #815ba4">return</span> <span style="color: #e7e9db">(</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span>
        <span style="color: #e7e9db">{</span><span style="color: #5bc4bf">!</span><span style="color: #06b6ef">loading</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #e7e9db">(</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">button</span> <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;button&quot;</span> <span style="color: #06b6ef">onClick</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onNextPage</span><span style="color: #e7e9db">}</span><span style="color: #5bc4bf">&gt;</span>
            <span style="color: #06b6ef">More</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/button&gt;</span>
        <span style="color: #e7e9db">)}</span>

        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">loading</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Loading</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;}</span>

        <span style="color: #e7e9db">{</span><span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #e7e9db">(</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">MessageList</span> <span style="color: #e7e9db">...</span> <span style="color: #5bc4bf">/&gt;</span>
        <span style="color: #e7e9db">)}</span>

        <span style="color: #e7e9db">{</span><span style="color: #5bc4bf">!</span><span style="color: #06b6ef">messages</span> <span style="color: #5bc4bf">&amp;&amp;</span> <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">div</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">There</span> <span style="color: #06b6ef">are</span> <span style="color: #06b6ef">no</span> <span style="color: #06b6ef">messages</span> <span style="color: #e7e9db">...</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;}</span>

        <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">form</span>
          <span style="color: #06b6ef">onSubmit</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">event</span> <span style="color: #5bc4bf">=&gt;</span>
<span style="background-color: #4f424c">            <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onCreateMessage</span><span style="color: #e7e9db">(</span><span style="color: #06b6ef">event</span><span style="color: #e7e9db">,</span> <span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">props</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">authUser</span><span style="color: #e7e9db">)</span>
</span>          <span style="color: #e7e9db">}</span>
        <span style="color: #5bc4bf">&gt;</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">input</span>
            <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;text&quot;</span>
            <span style="color: #06b6ef">value</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #06b6ef">text</span><span style="color: #e7e9db">}</span>
            <span style="color: #06b6ef">onChange</span><span style="color: #5bc4bf">=</span><span style="color: #e7e9db">{</span><span style="color: #815ba4">this</span><span style="color: #e7e9db">.</span><span style="color: #06b6ef">onChangeText</span><span style="color: #e7e9db">}</span>
          <span style="color: #5bc4bf">/&gt;</span>
          <span style="color: #5bc4bf">&lt;</span><span style="color: #06b6ef">button</span> <span style="color: #06b6ef">type</span><span style="color: #5bc4bf">=</span><span style="color: #48b685">&quot;submit&quot;</span><span style="color: #5bc4bf">&gt;</span><span style="color: #06b6ef">Send</span><span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/button&gt;</span>
        <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/form&gt;</span>
      <span style="color: #5bc4bf">&lt;</span><span style="color: #ef6155">/div&gt;</span>
    <span style="color: #e7e9db">);</span>
  <span style="color: #e7e9db">}</span>
<span style="color: #e7e9db">}</span>
</code></pre>
              </div>


              <p>The MessageList and MessageItem components didn&rsquo;t change at all, and only the HomePage and the
                Messages components were connected to the Redux store. They receive the necessary functions to update
                the state in the Redux store, but also the state as props such as users, messages, and limit. Every time
                a Firebase listener that receives the latest entities from the Firebase database is called, it stores
                the result in the Redux store. It happens as well when a user creates, edits, or deletes a message. If
                the limit for the pagination feature changes, the listener is registered with this new limit again.
                Everything else, such as the text of the new message or the loading indicator, is still managed in the
                local state of React.</p>

              <h3 id="exercises-3">Exercises:</h3>

              <ul>
                <li>Confirm your <a target="_blank" rel="noopener noreferrer" href="http://bit.ly/2VoS0dt">source code
                    for the last section</a></li>
              </ul>

              <hr class="section-divider">

              <p>That&rsquo;s it for the React Firebase with Redux tutorial. You have introduced Redux as state
                management library to manage your session, user, and message state. Instead of relying on React&rsquo;s
                context API for the authenticated user object and React&rsquo;s local state for the list of users and
                messages from the Firebase database, you are storing these objects in the Redux store. You can find the
                project in this <a target="_blank" rel="noopener noreferrer"
                  href="https://github.com/the-road-to-react-with-firebase/react-redux-firebase-authentication">GitHub
                  repository</a>.</p>



              



              <div class="box-inline col-md-12">
                <div class="col-md-12 text-center">
                  <h2 class="newsletter">The Road to learn React</h2>

                  <div class="col-md-4">
                    <img class="img-lazy img-responsive" data-lazy-src="//img/page/cover.png">
                  </div>

                  <p class="lead">
                    Build a Hacker News App along the way. No setup configuration. No tooling. No Redux. Plain React in
                    200+ pages of learning material. Learn React like <strong>50.000+ readers</strong>.
                  </p>
                  <a class="btn btn-template-main" href="https://roadtoreact.com" target="_blank"
                    rel="noopener noreferrer">
                    Get the Book for free <i class="fa fa-chevron-right"></i>
                  </a>

                  <div>
                    <a href="https://amzn.to/2QY2ONp" target="_blank" rel="noopener noreferrer">
                      Get it from Amazon
                    </a>
                  </div>

                </div>
              </div>

            </div>



            


          </article>


        </div>


      </div>

    </div>




    <section class="bar background-image-fixed-2 no-mb color-white text-center">
      <div class="dark-mask"></div>
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <h3 class="lead">Never miss an article about web development, JavaScript and self-growth.</h3>
            <h2 class="text-uppercase">Take Part</h2>
          </div>

          <div class="col-md-12 text-center">

            <h3 class="lead"><i class="fa fa-check"></i> Join 30.000&#43; Developers</h3>

            <h3 class="lead"><i class="fa fa-check"></i> Learn Web Development with JavaScript</h3>

            <h3 class="lead"><i class="fa fa-check"></i> Tips and Tricks</h3>

            <h3 class="lead"><i class="fa fa-check"></i> Access Tutorials, eBooks and Courses</h3>

            <h3 class="lead"><i class="fa fa-check"></i> Personal Development as a Software Engineer</h3>

          </div>
          <div class="col-md-12">
            <p class="text-center">
              <div id="mc_embed_signup">
                <form action="https://www.getrevue.co/profile/rwieruch/add_subscriber" method="post" id="revue-form"
                  name="revue-form" target="_blank">
                  <div id="mc_embed_signup_scroll">
                    <input class="email" placeholder="email address" type="email" name="member[email]"
                      id="member_email">
                    <div>
                      <button type="submit" value="Subscribe" name="member[subscribe]" id="member_submit"
                        class="btn btn-template-transparent-black btn-lg">
                        Subscribe
                      </button>
                    </div>
                  </div>
                </form>
              </div>

            </p>
          </div>
        </div>
      </div>
    </section>
    <footer id="subfooter">
      <div class="container">

        <div class="col-md-5 col-sm-6">

          <h4>Recent posts</h4>

          <div class="blog-entries">

            <div class="item same-height-row clearfix">
              <div class="article same-height-always">
                <a href="../redux-vs-usereducer/index.html">

                  <img data-lazy-src="//img/posts/redux-vs-usereducer/banner.jpg" data-is-thumb="is-thumb"
                    class="img-lazy img-responsive" alt="React&#39;s useReducer vs Redux">

                </a>
              </div>
              <div class="name same-height-always">
                <h5><a href="../redux-vs-usereducer/index.html">React&#39;s useReducer vs Redux</a></h5>
              </div>
            </div>

            <div class="item same-height-row clearfix">
              <div class="article same-height-always">
                <a href="../publish-npm-package-node/index.html">

                  <img data-lazy-src="//img/posts/publish-npm-package-node/banner.jpg" data-is-thumb="is-thumb"
                    class="img-lazy img-responsive" alt="How to publish a npm package?">

                </a>
              </div>
              <div class="name same-height-always">
                <h5><a href="../publish-npm-package-node/index.html">How to publish a npm package?</a></h5>
              </div>
            </div>

            <div class="item same-height-row clearfix">
              <div class="article same-height-always">
                <a href="../react-scroll-to-item/index.html">

                  <img data-lazy-src="//img/posts/react-scroll-to-item/banner.jpg" data-is-thumb="is-thumb"
                    class="img-lazy img-responsive" alt="How to Scroll to Item in React?">

                </a>
              </div>
              <div class="name same-height-always">
                <h5><a href="../react-scroll-to-item/index.html">How to Scroll to Item in React?</a></h5>
              </div>
            </div>

          </div>

          <hr class="hidden-md hidden-lg hidden-sm">

        </div>



        <div class="col-md-5 col-md-offset-2 col-sm-6">

          <h4>About Me</h4>

          <div class="blog-entries">
            <div class="item same-height-row clearfix">
              <div class="profile same-height-always">
                <img class="img-lazy img-responsive" data-lazy-src="//img/page/profile.jpg" alt="profile">
              </div>
              <div class="name same-height-always">
                <p>
                  Hi, I'm Chris - a Midvale, Utah-based consulting software developer. Find out more <a
                    href="../about/index.html">about me</a>, <a href="../work-with-me/index.html">work with me</a>, or
                  have a look at my social media profiles below.
                </p>
              </div>
            </div>
          </div>

        </div>



      </div>

    </footer>


    <footer id="copyright">
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <ul class="info list-inline quicklinks pull-left">

              <li> Chris Paul</li>

            </ul>
          </div>
          <div class="col-md-4">
            
          </div>
          <div class="col-md-4">
            <ul class="info list-inline quicklinks pull-right">

              <li><a aria-label="quicklinks" href="../legal/index.html">Legal Notice</a></li>

            </ul>
          </div>
        </div>
      </div>
    </footer>


  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

  <script src="../js/script.js"></script>
</body>

</html>